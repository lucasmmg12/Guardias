module.exports=[99649,80071,21607,a=>{"use strict";var b=a.i(24793),c=a.i(21439),d=a.i(61110),e=a.i(9106),f=a.i(55172),g=a.i(62353),h=a.i(20322);let i=(0,h.default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),j=(0,h.default)("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var k=a.i(5415),l=a.i(19147);function m({data:a,especialidad:h,onCellUpdate:m}){let[n,o]=(0,c.useState)(a.rows),[p,q]=(0,c.useState)({}),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)(!1);(0,c.useEffect)(()=>{if(!h){s([]),u(!1);return}!async function(){try{if(u(!0),!h)return;let{data:a,error:b}=await l.supabase.from("medicos").select("*").eq("especialidad",h).eq("activo",!0);if(b)throw b;s(a||[])}catch(a){console.error("Error loading médicos:",a)}finally{u(!1)}}()},[h]);let v=(0,c.useMemo)(()=>{let a=new Map;return r.forEach(b=>{let c=b.nombre.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();a.set(c,b);let d=b.nombre.split(",").map(a=>a.trim());if(d.length>0){let c=d[0].toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();c&&!a.has(c)&&a.set(c,b)}}),a},[r]),w=(0,c.useCallback)(a=>{if(!a||"string"!=typeof a)return null;let b=a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();if(v.has(b))return v.get(b)||null;for(let[a,c]of v.entries())if(b.includes(a)||a.includes(b))return c;return null},[v]),x=async(b,c,d)=>{let e=`${b}-${c}`;q(a=>({...a,[e]:!0}));try{let a=[...n];a[b]={...a[b],[c]:d},o(a),m&&await m(b,c,d)}catch(b){throw console.error("Error al guardar celda:",b),o(a.rows),b}finally{q(a=>({...a,[e]:!1}))}},y=a=>{let b=a.toLowerCase().trim();return"cliente"===b||"responsable"===b},z=(0,c.useMemo)(()=>{let b=new Set,c=a.headers.findIndex(a=>"cliente"===a.toLowerCase().trim());return -1===c||n.forEach((d,e)=>{let f=d[a.headers[c]];(0,k.esParticular)(f)&&b.add(e)}),b},[n,a.headers]),A=(0,c.useMemo)(()=>{let b=new Set;return n.forEach((c,d)=>{(0,k.tieneHorario)(c,a.headers)||b.add(d)}),b},[n,a.headers]),B=(0,c.useMemo)(()=>(0,k.obtenerIndicesDuplicados)(n,a.headers),[n,a.headers]),C=(0,c.useMemo)(()=>{let b=new Set;if(!h||0===r.length||t)return b;let c=a.headers.findIndex(a=>{let b=a.toLowerCase().trim();return"responsable"===b||b.includes("responsable")||b.includes("medico")}),d=a.headers.findIndex(a=>{let b=a.toLowerCase().trim();return"fecha"===b||b.includes("fecha")||b.includes("fecha visita")}),e=a.headers.findIndex(a=>{let b=a.toLowerCase().trim();return b.includes("hora")||b.includes("horario")||b.includes("inicio")});return -1===c||-1===d||-1===e||n.forEach((f,g)=>{let h=f[a.headers[c]],i=f[a.headers[d]],j=f[a.headers[e]],l=w(h);l&&l.es_residente&&(0,k.esResidenteHorarioFormativo)(i,j,l.es_residente)&&b.add(g)}),b},[n,a.headers,h,r,t,w]),D=z.size,E=A.size,F=B.size,G=C.size,H=(0,c.useCallback)(a=>{confirm("¿Está seguro de que desea eliminar esta fila?")&&o(n.filter((b,c)=>c!==a))},[n]);return(0,b.jsxs)("div",{className:"w-full space-y-4",children:[a.periodo&&(0,b.jsx)("div",{className:"p-4 rounded-xl",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(34, 197, 94, 0.3)"},children:(0,b.jsxs)("div",{className:"flex items-center gap-2 text-green-400",children:[(0,b.jsx)(e.CheckCircle2,{className:"h-5 w-5"}),(0,b.jsx)("span",{className:"font-semibold",children:"Período analizado:"}),(0,b.jsxs)("span",{className:"text-white",children:[a.periodo.desde," - ",a.periodo.hasta]})]})}),D>0&&(0,b.jsx)("div",{className:"p-4 rounded-xl border-2 animate-pulse",style:{background:"rgba(251, 191, 36, 0.15)",backdropFilter:"blur(20px)",borderColor:"rgba(251, 191, 36, 0.5)"},children:(0,b.jsxs)("div",{className:"flex items-center gap-3 text-yellow-400",children:[(0,b.jsx)(f.AlertCircle,{className:"h-6 w-6 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"font-bold text-lg mb-1",children:["⚠️ ",D," registro",D>1?"s":""," sin obra social detectado",D>1?"s":""]}),(0,b.jsxs)("div",{className:"text-sm text-yellow-300",children:['Estos registros deben ser revisados. Si son pacientes particulares, edite la columna "Cliente" y agregue: ',(0,b.jsx)("strong",{children:'"042 - PARTICULARES"'})]})]})]})}),E>0&&(0,b.jsx)("div",{className:"p-4 rounded-xl border-2 animate-pulse",style:{background:"rgba(239, 68, 68, 0.15)",backdropFilter:"blur(20px)",borderColor:"rgba(239, 68, 68, 0.5)"},children:(0,b.jsxs)("div",{className:"flex items-center gap-3 text-red-400",children:[(0,b.jsx)(i,{className:"h-6 w-6 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"font-bold text-lg mb-1",children:["⚠️ ",E," registro",E>1?"s":""," sin horario de inicio detectado",E>1?"s":""]}),(0,b.jsxs)("div",{className:"text-sm text-red-300",children:["Estos registros indican que el paciente ",(0,b.jsx)("strong",{children:"no se atendió"}),". Deben ser eliminados. Use el botón de eliminar en cada fila."]})]})]})}),F>0&&(0,b.jsx)("div",{className:"p-4 rounded-xl border-2 animate-pulse",style:{background:"rgba(168, 85, 247, 0.15)",backdropFilter:"blur(20px)",borderColor:"rgba(168, 85, 247, 0.5)"},children:(0,b.jsxs)("div",{className:"flex items-center gap-3 text-purple-400",children:[(0,b.jsx)(f.AlertCircle,{className:"h-6 w-6 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"font-bold text-lg mb-1",children:["⚠️ ",F," registro",F>1?"s":""," duplicado",F>1?"s":""," detectado",F>1?"s":""]}),(0,b.jsx)("div",{className:"text-sm text-purple-300",children:"Se detectaron filas completamente iguales (misma fecha, misma hora, mismo todo). Revise y elimine los duplicados si es necesario."})]})]})}),G>0&&(0,b.jsx)("div",{className:"p-4 rounded-xl border-2 animate-pulse",style:{background:"rgba(59, 130, 246, 0.15)",backdropFilter:"blur(20px)",borderColor:"rgba(59, 130, 246, 0.5)"},children:(0,b.jsxs)("div",{className:"flex items-center gap-3 text-blue-400",children:[(0,b.jsx)(j,{className:"h-6 w-6 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"font-bold text-lg mb-1",children:["ℹ️ ",G," consulta",G>1?"s":""," de residente",G>1?"s":""," en horario formativo detectada",G>1?"s":""]}),(0,b.jsxs)("div",{className:"text-sm text-blue-300",children:["Estas consultas son de ",(0,b.jsx)("strong",{children:"residentes"})," realizadas entre ",(0,b.jsx)("strong",{children:"lunes a sábado de 07:00 a 15:00"}),". ",(0,b.jsx)("strong",{children:"NO se deben pagar"})," según las reglas del sistema."]})]})]})}),(0,b.jsx)("div",{className:"overflow-x-auto rounded-xl",style:{background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:(0,b.jsxs)("table",{className:"w-full border-collapse text-xs",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-white/10",children:[a.headers.map((a,c)=>(0,b.jsx)("th",{className:"px-2 py-2 text-left text-xs font-semibold text-gray-300 bg-white/5 whitespace-nowrap",style:{position:"sticky",top:0,zIndex:10,minWidth:"120px",maxWidth:"200px"},children:(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)("span",{className:"truncate",children:a}),y(a)&&(0,b.jsx)("span",{className:"text-[10px] text-green-400 bg-green-400/20 px-1.5 py-0.5 rounded flex-shrink-0",children:"Editable"})]})},c)),(0,b.jsx)("th",{className:"px-2 py-2 text-left text-xs font-semibold text-gray-300 bg-white/5 whitespace-nowrap sticky right-0",style:{position:"sticky",top:0,zIndex:11,minWidth:"60px",maxWidth:"60px"},children:"Acciones"})]})}),(0,b.jsx)("tbody",{children:0===n.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:a.headers.length+1,className:"px-4 py-8 text-center text-gray-400 text-sm",children:"No hay datos para mostrar"})}):n.map((c,e)=>{let h=z.has(e),k=A.has(e),l=B.has(e),m=C.has(e),n="border-b transition-colors border-white/5 hover:bg-white/5";return k?n="bg-red-500/20 border-red-500/30 hover:bg-red-500/30 border-b":l?n="bg-purple-500/20 border-purple-500/30 hover:bg-purple-500/30 border-b":m?n="bg-blue-500/20 border-blue-500/30 hover:bg-blue-500/30 border-b":h&&(n="bg-yellow-500/20 border-yellow-500/30 hover:bg-yellow-500/30 border-b"),(0,b.jsxs)("tr",{className:n,children:[a.headers.map((a,g)=>{let i=c[a]??null,j=y(a),k=p[`${e}-${a}`]||!1;return(0,b.jsx)("td",{className:"px-2 py-1.5 text-xs text-gray-300",style:{minWidth:"120px",maxWidth:"200px"},children:j?(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(d.InlineEditCell,{value:i,type:"text",onSave:async b=>{await x(e,a,b)},isEditable:!0,className:k?"opacity-50":"",columnName:a}),h&&"cliente"===a.toLowerCase().trim()&&(0,b.jsx)("div",{className:"absolute -top-1 -right-1",children:(0,b.jsx)(f.AlertCircle,{className:"h-3 w-3 text-yellow-400"})})]}):(0,b.jsx)("div",{className:"px-1 py-0.5 truncate",title:i?String(i):"",children:null===i||""===i?(0,b.jsx)("span",{className:"text-gray-500 italic text-[10px]",children:"-"}):(0,b.jsx)("span",{className:"truncate block",children:String(i)})})},g)}),(0,b.jsx)("td",{className:`px-2 py-1.5 sticky right-0 ${k?"bg-red-500/20":l?"bg-purple-500/20":m?"bg-blue-500/20":h?"bg-yellow-500/20":"bg-white/5"}`,style:{minWidth:"60px",maxWidth:"60px",zIndex:1},children:(0,b.jsxs)("div",{className:"flex items-center justify-center gap-1 relative",children:[(k||l)&&(0,b.jsx)("button",{onClick:()=>H(e),className:"p-1.5 text-red-400 hover:bg-red-500/30 rounded transition-colors",title:"Eliminar fila",children:(0,b.jsx)(g.Trash2,{className:"h-4 w-4"})}),k&&(0,b.jsx)("div",{className:"absolute -top-1 -right-1",children:(0,b.jsx)(i,{className:"h-3 w-3 text-red-400"})}),l&&!k&&(0,b.jsx)("div",{className:"absolute -top-1 -right-1",children:(0,b.jsx)(f.AlertCircle,{className:"h-3 w-3 text-purple-400"})}),m&&!k&&!l&&(0,b.jsx)("div",{className:"absolute -top-1 -right-1",children:(0,b.jsx)(j,{className:"h-3 w-3 text-blue-400"})})]})})]},e)})})]})}),(0,b.jsxs)("div",{className:"text-sm text-gray-400",children:["Total de filas: ",(0,b.jsx)("span",{className:"text-green-400 font-semibold",children:n.length})," • ","Columnas: ",(0,b.jsx)("span",{className:"text-green-400 font-semibold",children:a.headers.length}),D>0&&(0,b.jsxs)(b.Fragment,{children:[" • ","Sin obra social: ",(0,b.jsx)("span",{className:"text-yellow-400 font-semibold",children:D})]}),E>0&&(0,b.jsxs)(b.Fragment,{children:[" • ","Sin horario: ",(0,b.jsx)("span",{className:"text-red-400 font-semibold",children:E})]}),F>0&&(0,b.jsxs)(b.Fragment,{children:[" • ","Duplicados: ",(0,b.jsx)("span",{className:"text-purple-400 font-semibold",children:F})]}),G>0&&(0,b.jsxs)(b.Fragment,{children:[" • ","Residente formativo: ",(0,b.jsx)("span",{className:"text-blue-400 font-semibold",children:G})]})]})]})}a.s(["ExcelDataTable",()=>m],99649);let n=(0,h.default)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);var o=a.i(31976);function p({mes:a,anio:d,especialidad:e}){let[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(!0),[j,k]=(0,c.useState)(0);async function m(){try{i(!0);let{error:b}=await l.supabase.rpc("sincronizar_estadisticas_obra_social",{p_mes:a,p_anio:d,p_especialidad:e});b&&console.error("Error sincronizando estadísticas:",b);let{data:c,error:f}=await l.supabase.from("v_estadisticas_obra_social_consolidado").select("obra_social, cantidad_consultas, porcentaje_del_total, total_consultas_mes").eq("mes",a).eq("anio",d).eq("especialidad",e).order("cantidad_consultas",{ascending:!1});if(f)throw f;c&&c.length>0?(g(c),k(c[0]?.total_consultas_mes||0)):(g([]),k(0))}catch(a){console.error("Error cargando estadísticas:",a)}finally{i(!1)}}if((0,c.useEffect)(()=>{m()},[a,d,e]),h)return(0,b.jsx)("div",{className:"p-6 text-center text-gray-400",children:"Cargando estadísticas..."});if(0===f.length)return(0,b.jsx)("div",{className:"p-6 rounded-xl",style:{background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:(0,b.jsxs)("div",{className:"text-center text-gray-400",children:[(0,b.jsx)(n,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{children:"No hay estadísticas disponibles para este período"})]})});let p=Math.max(...f.map(a=>a.cantidad_consultas));return(0,b.jsxs)("div",{className:"p-6 rounded-xl space-y-4",style:{background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 bg-green-500/20 rounded-lg",children:(0,b.jsx)(n,{className:"h-5 w-5 text-green-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Estadísticas por Obra Social"}),(0,b.jsxs)("p",{className:"text-sm text-gray-400",children:[a,"/",d," - ",e]})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-400",children:j}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:"Total consultas"})]})]}),(0,b.jsx)("div",{className:"space-y-2",children:f.map((a,c)=>{let d=a.porcentaje_del_total||0,e=a.cantidad_consultas/p*100,f=a.obra_social.includes("042")||a.obra_social.includes("PARTICULARES");return(0,b.jsxs)("div",{className:"p-3 rounded-lg",style:{background:f?"rgba(251, 191, 36, 0.1)":"rgba(255, 255, 255, 0.03)",border:f?"1px solid rgba(251, 191, 36, 0.3)":"1px solid rgba(255, 255, 255, 0.05)"},children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,b.jsx)(o.Users,{className:`h-4 w-4 flex-shrink-0 ${f?"text-yellow-400":"text-gray-400"}`}),(0,b.jsx)("span",{className:`font-medium truncate ${f?"text-yellow-300":"text-gray-300"}`,children:a.obra_social})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-shrink-0",children:[(0,b.jsx)("span",{className:"text-sm font-semibold text-green-400",children:a.cantidad_consultas}),(0,b.jsxs)("span",{className:"text-xs text-gray-400 w-12 text-right",children:[d.toFixed(1),"%"]})]})]}),(0,b.jsx)("div",{className:"h-2 bg-gray-800 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full transition-all duration-500",style:{width:`${e}%`,background:f?"linear-gradient(90deg, rgba(251, 191, 36, 0.8), rgba(251, 191, 36, 0.6))":"linear-gradient(90deg, rgba(34, 197, 94, 0.8), rgba(34, 197, 94, 0.6))"}})})]},c)})}),(0,b.jsx)("div",{className:"pt-4 border-t border-white/10",children:(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-lg font-bold text-green-400",children:f.length}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:"Obras Sociales"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-lg font-bold text-blue-400",children:f.filter(a=>a.obra_social.includes("042")||a.obra_social.includes("PARTICULARES")).length}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:"Particulares"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-lg font-bold text-yellow-400",children:f[0]?.cantidad_consultas||0}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:"Mayor cantidad"})]})]})})]})}a.s(["EstadisticasObraSocial",()=>p],80071);var q=a.i(29839);async function r(a){try{let b=await a.arrayBuffer(),c=q.read(b,{type:"array"}),d=c.SheetNames[0];if(!d)throw Error("El archivo Excel no contiene hojas");let e=c.Sheets[d],f=q.utils.decode_range(e["!ref"]||"A1"),g=[];for(let a=0;a<=Math.min(f.e.c,50);a++){let b=e[q.utils.encode_cell({r:1,c:a})];g.push(b?b.v:null)}let h=function(a){if(!a||0===a.length)return null;let b=a.map(a=>String(a||"")).join(" "),c=b.match(/Desde fecha:\s*(\d{1,2}\/\d{1,2}\/\d{4})/i),d=b.match(/Hasta fecha:\s*(\d{1,2}\/\d{1,2}\/\d{4})/i);return c&&d?{desde:c[1],hasta:d[1]}:null}(g),i=[],j=Math.min(f.e.c+1,50),k=-1;for(let a=0;a<j;a++){let b=e[q.utils.encode_cell({r:9,c:a})];if(b&&null!==b.v&&void 0!==b.v){let c=String(b.v).trim();""!==c&&(k=a)}}if(-1===k)throw Error("No se encontraron headers en la fila 10");for(let a=0;a<=k;a++){let b=e[q.utils.encode_cell({r:9,c:a})];if(b&&null!==b.v&&void 0!==b.v){let c=String(b.v).trim();i.push({name:c||`Columna ${a+1}`,colIndex:a})}else i.push({name:`Columna ${a+1}`,colIndex:a})}let l=i.map(a=>a.name).filter(a=>!a.startsWith("Columna")),m=[];for(let a=10;a<=f.e.r;a++){let b={},c=!1;i.forEach(d=>{let f=e[q.utils.encode_cell({r:a,c:d.colIndex})];if(f&&null!==f.v&&void 0!==f.v){let a=f.v;if(d.name.toLowerCase().includes("duración")||d.name.toLowerCase().includes("duracion")){if("number"==typeof a)a=Math.round(a);else if("string"==typeof a){let b=parseFloat(a.replace(",","."));a=isNaN(b)?a:Math.round(b)}}else if("d"===f.t&&a instanceof Date){let b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();a=`${b}/${c}/${d}`}else if("n"===f.t&&"number"==typeof a&&a>1&&a<1e5)try{let b=q.SSF.parse_date_code(a);b&&(a=`${b.d}/${b.m}/${b.y}`)}catch{}d.name.startsWith("Columna")||(b[d.name]=a,c=!0)}else d.name.startsWith("Columna")||(b[d.name]=null)}),c&&m.push(b)}return{periodo:h,headers:l,rows:m}}catch(a){if(a instanceof Error)throw a;throw Error("Error al leer el archivo Excel: "+String(a))}}a.s(["readExcelFile",()=>r],21607)}];

//# sourceMappingURL=3d860_Osde_Liquidaciones_Guardias_components_custom_ExcelDataTable_tsx_fefdfe5e._.js.map