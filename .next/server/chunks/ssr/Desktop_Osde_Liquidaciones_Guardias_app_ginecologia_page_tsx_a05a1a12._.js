module.exports=[7791,a=>{"use strict";var b=a.i(24793),c=a.i(21439),d=a.i(48168),e=a.i(40087),f=a.i(99649),g=a.i(80071),h=a.i(44874),i=a.i(15269);let j=[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiembre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}];function k({isOpen:a,onClose:d,onConfirm:e,mesDetectado:f,anioDetectado:g,mesActual:k,anioActual:l}){let[m,n]=(0,c.useState)(f||k),[o,p]=(0,c.useState)(g||l);return((0,c.useEffect)(()=>{a&&(n(f||k),p(g||l))},[a,f,g,k,l]),a)?(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:d}),(0,b.jsxs)("div",{className:"relative z-10 w-full max-w-md mx-4 rounded-2xl p-6",style:{background:"rgba(17, 24, 39, 0.95)",backdropFilter:"blur(20px)",border:"1px solid rgba(34, 197, 94, 0.3)",boxShadow:"0 8px 32px 0 rgba(34, 197, 94, 0.3)"},children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-green-400",children:"Seleccionar Per√≠odo"}),(0,b.jsx)("button",{onClick:d,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors",children:(0,b.jsx)(i.X,{className:"h-5 w-5"})})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[f&&g&&(0,b.jsxs)("div",{className:"p-4 rounded-lg",style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)"},children:[(0,b.jsx)("p",{className:"text-sm text-green-400 mb-2",children:"‚úì Mes detectado autom√°ticamente"}),(0,b.jsxs)("p",{className:"text-sm text-gray-300",children:[j[f-1].label," ",g]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Mes"}),(0,b.jsx)("select",{value:m,onChange:a=>n(Number(a.target.value)),className:"w-full px-4 py-2 bg-gray-800 border border-green-500/50 rounded-lg text-white focus:border-green-400 focus:outline-none",children:j.map(a=>(0,b.jsx)("option",{value:a.value,children:a.label},a.value))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"A√±o"}),(0,b.jsx)("input",{type:"number",value:o,onChange:a=>p(Number(a.target.value)),min:2020,max:2100,className:"w-full px-4 py-2 bg-gray-800 border border-green-500/50 rounded-lg text-white focus:border-green-400 focus:outline-none"})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,b.jsx)(h.Button,{onClick:d,variant:"outline",className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-700",children:"Cancelar"}),(0,b.jsx)(h.Button,{onClick:()=>{e(m,o),d()},className:"flex-1 bg-green-600 hover:bg-green-500 text-white",children:"Confirmar"})]})]})]})]}):null}var l=a.i(82521),m=a.i(21607),n=a.i(19147),o=a.i(5415);function p(a){return a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()}function q(a,b){let c=Object.keys(a);for(let c of b)if(void 0!==a[c]&&null!==a[c]){let b=a[c];if("string"==typeof b&&""!==b.trim())return b.trim();if("string"!=typeof b)return b}let d=b.map(p);for(let b of c){let c=p(b);if(d.includes(c)){let c=a[b];if(null!=c){if("string"==typeof c&&""!==c.trim())return c.trim();if("string"!=typeof c)return c}}}for(let d of b){let b=p(d).split(/\s+/).filter(a=>a.length>2);for(let d of c){let c=p(d);if(b.every(a=>c.includes(a))){let b=a[d];if(null!=b){if("string"==typeof b&&""!==b.trim())return b.trim();if("string"!=typeof b)return b}}}}return null}async function r(a,b,c,d){let e={liquidacionId:"",totalFilas:0,procesadas:0,errores:[],advertencias:[]};try{let f,{data:g,error:h}=await n.supabase.from("medicos").select("*").eq("especialidad","Ginecolog√≠a").eq("activo",!0);if(h)return e.errores.push(`Error cargando m\xe9dicos: ${h.message}`),e;let i=g||[],{data:j}=await n.supabase.from("valores_consultas_obra_social").select("*").eq("tipo_consulta","CONSULTA GINECOLOGICA").eq("mes",b).eq("anio",c),k=new Map;(j||[]).forEach(a=>{k.set(a.obra_social,a.valor)});let l=(0,o.calcularNumeroLiquidacion)(b,c),{data:m}=await n.supabase.from("liquidaciones_guardia").select("id").eq("especialidad","Ginecolog√≠a").eq("mes",b).eq("anio",c).single();if(m&&m.id)f=m.id,await n.supabase.from("detalle_guardia").delete().eq("liquidacion_id",f);else{let{data:a,error:g}=await n.supabase.from("liquidaciones_guardia").insert({mes:b,anio:c,especialidad:"Ginecolog√≠a",estado:"borrador",total_consultas:0,total_bruto:0,total_retenciones:0,total_adicionales:0,total_neto:0,archivo_nombre:d,numero_liquidacion:l}).select("id").single();if(g||!a)return e.errores.push(`Error creando liquidaci\xf3n: ${g?.message||"Error desconocido"}`),e;f=a.id}e.liquidacionId=f;let p=[];e.totalFilas=a.rows.length;for(let b=0;b<a.rows.length;b++){let c=a.rows[b];try{let a=q(c,["Fecha","fecha","FECHA","Fecha visita","Fecha Visita"]),d=q(c,["Hora","hora","HORA","Horario","horario"]),g=q(c,["Paciente","paciente","PACIENTE","Nombre paciente","Nombre Paciente"]),h=q(c,["Obra Social","obra social","Obra social","ObraSocial","Cliente"]),j=q(c,["Responsable","responsable","M√©dico","medico","MEDICO","Medico","Profesional"]);if(!a){e.advertencias.push(`Fila ${b+1}: Sin fecha, se omite`);continue}let l=function(a){if(!a||"string"!=typeof a)return null;let b=a.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(!b)return null;let c=b[1].padStart(2,"0"),d=b[2].padStart(2,"0"),e=b[3];return`${e}-${d}-${c}`}(a);if(!l){e.advertencias.push(`Fila ${b+1}: Fecha inv\xe1lida (${a}), se omite`);continue}let m=function(a,b){if(!a||"string"!=typeof a)return null;let c=a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();for(let a of b){if(a.nombre.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()===c)return a;let b=a.nombre.split(",").map(a=>a.trim());if(b.length>0){let d=b[0].toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();if(c.includes(d)||d.includes(c))return a}}return null}(j,i),n=m?.es_residente||!1,r=h||"PARTICULARES",s=k.get(r)||0,t=function(a){if(!a)return null;if("string"==typeof a){let b=a.match(/(\d{1,2}):(\d{2})(?::(\d{2}))?/);if(b){let a=b[1].padStart(2,"0"),c=b[2].padStart(2,"0"),d=b[3]||"00";return`${a}:${c}:${d}`}}else if("number"==typeof a){let b=Math.round(86400*a),c=Math.floor(b/3600),d=Math.floor(b%3600/60);return`${String(c).padStart(2,"0")}:${String(d).padStart(2,"0")}:${String(b%60).padStart(2,"0")}`}return null}(d),u=(0,o.esResidenteHorarioFormativo)(l,t,n),v=s,w=s;u&&(v=0,w=0);let x={liquidacion_id:f,medico_id:m?.id||null,fecha:l,hora:t,paciente:g||null,obra_social:r,medico_nombre:j||m?.nombre||"Desconocido",medico_matricula:m?.matricula||null,medico_es_residente:n,monto_facturado:v,porcentaje_retencion:null,monto_retencion:null,monto_adicional:0,importe_calculado:w,aplica_adicional:!1,es_horario_formativo:u,estado_revision:"pendiente",fila_excel:b+1};p.push(x),e.procesadas++}catch(a){e.errores.push(`Fila ${b+1}: ${a.message||"Error desconocido"}`)}}if(p.length>0){let{error:a}=await n.supabase.from("detalle_guardia").insert(p);if(a)return e.errores.push(`Error guardando detalles: ${a.message}`),e}let r=p.length,s=p.reduce((a,b)=>a+(b.monto_facturado||0),0),t=p.reduce((a,b)=>a+(b.importe_calculado||0),0),{error:u}=await n.supabase.from("liquidaciones_guardia").update({total_consultas:r,total_bruto:s,total_neto:t,estado:"finalizada"}).eq("id",f);u&&e.errores.push(`Error actualizando totales: ${u.message}`)}catch(a){e.errores.push(`Error general: ${a.message||"Error desconocido"}`)}return e}var s=a.i(55172),t=a.i(84091),u=a.i(53315),v=a.i(22851);function w(){let a=(0,d.useRouter)(),[i,j]=(0,c.useState)(!1),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(null),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(new Date().getMonth()+1),[E,F]=(0,c.useState)(new Date().getFullYear()),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)({isOpen:!1,type:"info",message:""});function M(a,b,c){L({isOpen:!0,type:a,message:b,title:c}),setTimeout(()=>{L(a=>({...a,isOpen:!1}))},5e3)}let N=async a=>{j(!0),o(null),q(null),z(null),B(null),H(a);try{let b=await (0,m.readExcelFile)(a);o(b);let{mes:c,anio:d}=(a=>{if(a.periodo?.desde){let b=a.periodo.desde.split("/");if(3===b.length){let a=parseInt(b[1],10),c=parseInt(b[2],10);if(a>=1&&a<=12&&c>=2020)return{mes:a,anio:c}}}let b=a.headers.find(a=>a.toLowerCase().includes("fecha")||a.toLowerCase().includes("date"));if(b&&a.rows.length>0){let c=[];if(a.rows.forEach(a=>{let d=a[b];if(d&&"string"==typeof d){let a=d.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(a){let b=parseInt(a[2],10),d=parseInt(a[3],10);b>=1&&b<=12&&d>=2020&&c.push(b)}}}),c.length>0){let d=c[0];if(c.every(a=>a===d)){let c=a.rows[0][b];if("string"==typeof c){let a=c.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(a)return{mes:d,anio:parseInt(a[3],10)}}}}}return{mes:null,anio:null}})(b);c&&d&&(z(c),B(d),D(c),F(d)),x(!0)}catch(a){console.error("Error processing file:",a),q(a.message||"Ocurri√≥ un error inesperado al procesar el archivo.")}finally{j(!1)}},O=async(a,b)=>{if(D(a),F(b),x(!1),n&&G){J(!0);try{let c=await r(n,a,b,G.name);c.errores.length>0?M("error",`Se procesaron ${c.procesadas} filas. Errores: ${c.errores.length}`,"Procesamiento con errores"):c.advertencias.length>0?M("warning",`Se procesaron ${c.procesadas} de ${c.totalFilas} filas. ${c.advertencias.length} advertencias.`,"Procesamiento completado"):M("success",`Se procesaron y guardaron ${c.procesadas} consultas correctamente.`,"Guardado exitoso")}catch(a){console.error("Error guardando datos:",a),M("error",`Error al guardar: ${a.message||"Error desconocido"}`,"Error")}finally{J(!1)}}},P=async(a,b,c)=>{console.log(`Actualizando fila ${a}, columna ${b} con valor:`,c)};return(0,b.jsxs)("div",{className:"min-h-screen relative p-8 pb-20 overflow-hidden",children:[(0,b.jsx)("div",{className:"absolute top-20 left-20 w-96 h-96 bg-green-500/20 rounded-full blur-3xl animate-pulse"}),(0,b.jsx)("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-green-400/20 rounded-full blur-3xl animate-pulse delay-1000"}),(0,b.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8 relative z-10",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsxs)(h.Button,{onClick:()=>a.push("/"),variant:"outline",className:"border-green-500/50 text-green-400 hover:bg-green-500/20",children:[(0,b.jsx)(u.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Volver"]})}),(0,b.jsx)("div",{children:(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,b.jsx)(v.default,{href:"/",className:"hover:opacity-80 transition-opacity",children:(0,b.jsx)("img",{src:"/logogrow.png",alt:"Grow Labs",className:"h-16 w-auto drop-shadow-2xl",style:{filter:"drop-shadow(0 0 20px rgba(34, 197, 94, 0.5))"}})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-4xl font-bold mb-2 tracking-tight",children:(0,b.jsx)("span",{className:"bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent",children:"M√≥dulo Ginecolog√≠a"})}),(0,b.jsxs)("p",{className:"text-gray-400 flex items-center gap-2",children:[(0,b.jsx)(t.Sparkles,{className:"h-4 w-4 text-blue-400"}),"Procesamiento de liquidaciones por hora"]})]})]})})]}),(0,b.jsxs)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:[(0,b.jsx)("div",{className:"absolute inset-0 rounded-2xl",style:{background:"linear-gradient(45deg, transparent, rgba(59, 130, 246, 0.3), transparent)",animation:"borderGlow 3s ease-in-out infinite"}}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-blue-400",children:"üì§ Cargar Liquidaci√≥n"}),(0,b.jsx)(h.Button,{onClick:()=>a.push("/ginecologia/resumenes"),variant:"outline",className:"border-blue-500/50 text-blue-400 hover:bg-blue-500/20",children:"Ver Res√∫menes"})]}),(0,b.jsx)(e.UploadExcel,{onUpload:N,isProcessing:i}),p&&(0,b.jsxs)("div",{className:"mt-6 bg-red-500/10 border border-red-500/30 rounded-lg p-4 flex items-start gap-3 text-red-400",children:[(0,b.jsx)(s.AlertCircle,{className:"w-5 h-5 mt-0.5 shrink-0"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Error de Procesamiento"}),(0,b.jsx)("p",{className:"text-sm opacity-90",children:p})]})]})]})]}),n&&(0,b.jsx)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-blue-400 mb-6",children:"üìä Datos del Excel"}),(0,b.jsx)(f.ExcelDataTable,{data:n,especialidad:"Ginecolog√≠a",onCellUpdate:P})]})}),n&&n.periodo&&(()=>{let{mes:a,anio:c}={mes:C,anio:E};return(0,b.jsx)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:(0,b.jsx)(g.EstadisticasObraSocial,{mes:a,anio:c,especialidad:"Ginecolog√≠a"})})})(),(0,b.jsxs)("div",{className:"p-6 rounded-xl",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.2)"},children:[(0,b.jsx)("h3",{className:"text-xl font-semibold text-gray-200 mb-4",children:"üìã Reglas Vigentes"}),(0,b.jsxs)("div",{className:"space-y-4 text-sm text-gray-300",children:[(0,b.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Pago por Hora"}),(0,b.jsx)("div",{className:"font-semibold text-white",children:"Seg√∫n Tarifa"}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:"Valor hora vigente"})]}),(0,b.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Residentes"}),(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("span",{className:"text-blue-400",children:"07:30 - 15:00"})," = $0"]}),(0,b.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:"Horario formativo"})]}),(0,b.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Planta"}),(0,b.jsx)("div",{className:"text-sm text-green-400",children:"100% Pago"}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:"Sin restricciones horarias"})]})]})]})]}),(0,b.jsx)(k,{isOpen:w,onClose:()=>x(!1),onConfirm:O,mesDetectado:y,anioDetectado:A,mesActual:new Date().getMonth()+1,anioActual:new Date().getFullYear()}),(0,b.jsx)(l.NotificationModal,{isOpen:K.isOpen,onClose:()=>L(a=>({...a,isOpen:!1})),type:K.type,title:K.title,message:K.message}),I&&(0,b.jsx)("div",{className:"fixed bottom-4 right-4 p-4 rounded-lg bg-blue-500/20 border border-blue-500/50 text-blue-400",children:"Guardando datos en la base de datos..."})]})}a.s(["default",()=>w],7791)}];

//# sourceMappingURL=Desktop_Osde_Liquidaciones_Guardias_app_ginecologia_page_tsx_a05a1a12._.js.map