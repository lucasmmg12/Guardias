module.exports=[7791,a=>{"use strict";var b=a.i(24793),c=a.i(21439),d=a.i(48168),e=a.i(40087),f=a.i(99649),g=a.i(80071),h=a.i(44874),i=a.i(15269);let j=[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiembre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}];function k({isOpen:a,onClose:d,onConfirm:e,mesDetectado:f,anioDetectado:g,mesActual:k,anioActual:l}){let[m,n]=(0,c.useState)(f||k),[o,p]=(0,c.useState)(g||l);return((0,c.useEffect)(()=>{a&&(n(f||k),p(g||l))},[a,f,g,k,l]),a)?(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:d}),(0,b.jsxs)("div",{className:"relative z-10 w-full max-w-md mx-4 rounded-2xl p-6",style:{background:"rgba(17, 24, 39, 0.95)",backdropFilter:"blur(20px)",border:"1px solid rgba(34, 197, 94, 0.3)",boxShadow:"0 8px 32px 0 rgba(34, 197, 94, 0.3)"},children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-green-400",children:"Seleccionar Per√≠odo"}),(0,b.jsx)("button",{onClick:d,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors",children:(0,b.jsx)(i.X,{className:"h-5 w-5"})})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[f&&g&&(0,b.jsxs)("div",{className:"p-4 rounded-lg",style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)"},children:[(0,b.jsx)("p",{className:"text-sm text-green-400 mb-2",children:"‚úì Mes detectado autom√°ticamente"}),(0,b.jsxs)("p",{className:"text-sm text-gray-300",children:[j[f-1].label," ",g]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Mes"}),(0,b.jsx)("select",{value:m,onChange:a=>n(Number(a.target.value)),className:"w-full px-4 py-2 bg-gray-800 border border-green-500/50 rounded-lg text-white focus:border-green-400 focus:outline-none",children:j.map(a=>(0,b.jsx)("option",{value:a.value,children:a.label},a.value))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"A√±o"}),(0,b.jsx)("input",{type:"number",value:o,onChange:a=>p(Number(a.target.value)),min:2020,max:2100,className:"w-full px-4 py-2 bg-gray-800 border border-green-500/50 rounded-lg text-white focus:border-green-400 focus:outline-none"})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,b.jsx)(h.Button,{onClick:d,variant:"outline",className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-700",children:"Cancelar"}),(0,b.jsx)(h.Button,{onClick:()=>{e(m,o),d()},className:"flex-1 bg-green-600 hover:bg-green-500 text-white",children:"Confirmar"})]})]})]})]}):null}var l=a.i(82521),m=a.i(19147),n=a.i(61110);let o=(0,a.i(20322).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var p=a.i(55172),q=a.i(9106),r=a.i(56422);let s={borrador:"Borrador",procesando:"Procesando",pendiente_revision:"Pendiente de Revisi√≥n",revisado:"Revisado",listo_para_liquidar:"Listo para Liquidar",finalizada:"Finalizada",error:"Error"};function t({liquidacionId:a,liquidacion:d,onEstadoChange:e}){let[f,g]=(0,c.useState)([]),[i,j]=(0,c.useState)(!0),[k,l]=(0,c.useState)({}),[t,u]=(0,c.useState)("idle"),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)([]),z=(0,c.useRef)(null),A=(0,c.useRef)(new Map),B=(0,c.useRef)(!1),C=(0,c.useCallback)(async()=>{try{j(!0);let{data:b,error:c}=await m.supabase.from("detalle_guardia").select("*").eq("liquidacion_id",a).order("fecha",{ascending:!0}).order("hora",{ascending:!0});if(c)throw c;g(b||[])}catch(a){console.error("Error cargando detalles:",a)}finally{j(!1)}},[a]),D=(0,c.useCallback)(async()=>{try{let{data:a,error:b}=await m.supabase.from("valores_consultas_obra_social").select("obra_social").eq("tipo_consulta","CONSULTA GINECOLOGICA");if(b)throw b;let c=Array.from(new Set((a||[]).map(a=>a.obra_social).filter(Boolean)));y(c.sort())}catch(a){console.error("Error cargando obras sociales:",a)}},[]);(0,c.useEffect)(()=>{C(),D()},[C,D]);let E=(0,c.useCallback)(async(a=!1)=>{if(0===A.current.size)return void u("idle");!a&&z.current&&(clearTimeout(z.current),z.current=null),u("saving");let b=Array.from(A.current.entries());try{let a=b.map(async([a,b])=>{let{error:c}=await m.supabase.from("detalle_guardia").update({...b,updated_at:new Date().toISOString()}).eq("id",a);if(c)throw c});await Promise.all(a),A.current.clear(),u("saved"),w(new Date),await C(),setTimeout(()=>{B.current||u("idle")},2e3)}catch(a){console.error("Error guardando cambios:",a),u("error"),setTimeout(()=>{!B.current&&A.current.size>0&&E(!0)},3e3)}},[C]),F=(0,c.useCallback)((a,b)=>{let c=A.current.get(a)||{};A.current.set(a,{...c,...b}),z.current&&clearTimeout(z.current),z.current=setTimeout(()=>{E(!0)},500)},[E]);(0,c.useEffect)(()=>()=>{B.current=!0,z.current&&clearTimeout(z.current),A.current.size>0&&E(!0)},[E]),(0,c.useEffect)(()=>{let a=a=>{A.current.size>0&&(a.preventDefault(),a.returnValue="Tienes cambios sin guardar. ¬øEst√°s seguro de que quieres salir?",E(!0))};return window.addEventListener("beforeunload",a),()=>window.removeEventListener("beforeunload",a)},[E]),(0,c.useEffect)(()=>{let a=setInterval(()=>{A.current.size>0&&E(!0)},1e4);return()=>clearInterval(a)},[E]);let G=(0,c.useCallback)(async(a,b)=>{g(c=>c.map(c=>c.id===a?{...c,obra_social:b}:c)),F(a,{obra_social:b})},[F]),H=(0,c.useCallback)(async a=>{if(d)try{let{error:b}=await m.supabase.from("liquidaciones_guardia").update({estado:a}).eq("id",d.id);if(b)throw b;e&&e(a)}catch(a){console.error("Error actualizando estado:",a)}},[d,e]),I=a=>a?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:2,maximumFractionDigits:2}).format(a):"$0.00";if(i)return(0,b.jsxs)("div",{className:"text-center py-12 text-gray-400",children:[(0,b.jsx)(r.Clock,{className:"h-8 w-8 mx-auto mb-4 animate-spin"}),"Cargando detalles..."]});if(0===f.length)return(0,b.jsx)("div",{className:"text-center py-12 text-gray-400",children:"No hay detalles para mostrar"});let J=f.filter(a=>!a.obra_social||""===a.obra_social.trim()).length;return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-xl bg-gray-800/50 border border-gray-700",children:[(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:["saving"===t&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.Clock,{className:"h-4 w-4 text-yellow-400 animate-spin"}),(0,b.jsx)("span",{className:"text-sm text-yellow-400",children:"Guardando..."})]}),"saved"===t&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.CheckCircle2,{className:"h-4 w-4 text-green-400"}),(0,b.jsxs)("span",{className:"text-sm text-green-400",children:["Guardado ",v?`a las ${v.toLocaleTimeString("es-AR")}`:""]})]}),"error"===t&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.AlertCircle,{className:"h-4 w-4 text-red-400"}),(0,b.jsx)("span",{className:"text-sm text-red-400",children:"Error al guardar. Reintentando..."})]}),"idle"===t&&A.current.size>0&&(0,b.jsxs)("span",{className:"text-sm text-gray-400",children:[A.current.size," cambio(s) pendiente(s)"]})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[d&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("label",{className:"text-sm text-gray-300",children:"Estado:"}),(0,b.jsx)("select",{value:d.estado,onChange:a=>H(a.target.value),className:"px-3 py-1 bg-gray-700 border border-gray-600 rounded text-white text-sm focus:border-green-400 focus:outline-none",children:Object.entries(s).map(([a,c])=>(0,b.jsx)("option",{value:a,children:c},a))})]}),A.current.size>0&&(0,b.jsxs)(h.Button,{onClick:()=>E(!0),size:"sm",className:"bg-green-600 hover:bg-green-500",children:[(0,b.jsx)(o,{className:"h-4 w-4 mr-2"}),"Guardar ahora"]})]})]}),J>0&&(0,b.jsx)("div",{className:"p-4 rounded-xl bg-yellow-500/20 border border-yellow-500/50",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 text-yellow-400",children:[(0,b.jsx)(p.AlertCircle,{className:"h-5 w-5"}),(0,b.jsxs)("span",{className:"font-semibold",children:[J," fila(s) sin obra social - Requiere revisi√≥n"]})]})}),(0,b.jsx)("div",{className:"overflow-x-auto rounded-xl border border-gray-700",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-gray-800",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-green-400 sticky left-0 bg-gray-800 z-10",children:"Fecha"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-green-400",children:"Hora"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-green-400",children:"M√©dico"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-green-400",children:"Paciente"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-green-400",children:"Obra Social"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right text-sm font-semibold text-green-400",children:"Monto Facturado"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right text-sm font-semibold text-green-400",children:"Importe Calculado"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-sm font-semibold text-green-400",children:"Horario Formativo"})]})}),(0,b.jsx)("tbody",{children:f.map(a=>{var c;let d=!a.obra_social||""===a.obra_social.trim();return(0,b.jsxs)("tr",{className:`border-b border-gray-800 hover:bg-gray-800/50 ${d?"bg-yellow-500/10":""}`,children:[(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-gray-300 sticky left-0 bg-gray-900 z-10",children:(c=a.fecha)?new Date(c).toLocaleDateString("es-AR"):"-"}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-gray-300",children:a.hora||"-"}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-gray-300",children:a.medico_nombre||"-"}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-gray-300",children:a.paciente||"-"}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,b.jsx)(n.InlineEditCell,{value:a.obra_social||"",onSave:b=>G(a.id,"string"==typeof b?b||null:String(b)||null),className:d?"bg-yellow-500/20 border-yellow-500/50":"",columnName:"Obra Social"})}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-gray-300 text-right",children:I(a.monto_facturado)}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-gray-300 text-right font-semibold",children:I(a.importe_calculado)}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:a.es_horario_formativo?(0,b.jsx)("span",{className:"text-yellow-400",children:"S√≠"}):(0,b.jsx)("span",{className:"text-gray-500",children:"No"})})]},a.id)})})]})})]})}var u=a.i(21607),v=a.i(5415);function w(a){return a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()}function x(a,b){let c=Object.keys(a);if(0===c.length)return null;for(let d of b)for(let b of c)if(b.toLowerCase().trim()===d.toLowerCase().trim()){let c=a[b];if(null!=c){if("string"==typeof c&&""!==c.trim())return c.trim();if("string"!=typeof c)return c}}let d=b.map(w);for(let b of c){let c=w(b);if(d.includes(c)){let c=a[b];if(null!=c){if("string"==typeof c&&""!==c.trim())return c.trim();if("string"!=typeof c)return c}}}for(let d of b){let b=w(d).split(/\s+/).filter(a=>a.length>2);if(0!==b.length)for(let d of c){let c=w(d);if(b.every(a=>c.includes(a))){let b=a[d];if(null!=b){if("string"==typeof b&&""!==b.trim())return b.trim();if("string"!=typeof b)return b}}}}return null}function y(a){return a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim()}async function z(a,b,c,d){let e={liquidacionId:"",totalFilas:0,procesadas:0,errores:[],advertencias:[]};try{let f,{data:g,error:h}=await m.supabase.from("medicos").select("*").eq("especialidad","Ginecolog√≠a");if(h)return e.errores.push(`Error cargando m\xe9dicos: ${h.message}`),e;let i=g||[];console.log(`[Ginecolog\xeda] M\xe9dicos cargados: ${i.length}`),console.log(`[Ginecolog\xeda] Residentes: ${i.filter(a=>null===a.matricula_provincial).length}`),console.log(`[Ginecolog\xeda] No residentes: ${i.filter(a=>null!==a.matricula_provincial).length}`),console.log(`[Ginecolog\xeda] Nombres de m\xe9dicos:`,i.map(a=>`${a.nombre} (${null===a.matricula_provincial?"RESIDENTE":"NO RESIDENTE"})`).slice(0,10));let{data:j}=await m.supabase.from("valores_consultas_obra_social").select("*").eq("tipo_consulta","CONSULTA GINECOLOGICA").eq("mes",b).eq("anio",c),k=new Map;(j||[]).forEach(a=>{k.set(a.obra_social,a.valor)});let l=(0,v.calcularNumeroLiquidacion)(b,c),{data:n}=await m.supabase.from("liquidaciones_guardia").select("id").eq("especialidad","Ginecolog√≠a").eq("mes",b).eq("anio",c).single();if(n&&n.id)f=n.id,await m.supabase.from("detalle_guardia").delete().eq("liquidacion_id",f);else{let{data:a,error:g}=await m.supabase.from("liquidaciones_guardia").insert({mes:b,anio:c,especialidad:"Ginecolog√≠a",estado:"borrador",total_consultas:0,total_bruto:0,total_retenciones:0,total_adicionales:0,total_neto:0,archivo_nombre:d,numero_liquidacion:l}).select("id").single();if(g)return e.errores.push(`Error creando liquidaci\xf3n: ${g.message||"Error desconocido"}. Detalles: ${JSON.stringify(g)}`),console.error("Error creando liquidaci√≥n:",g),e;if(!a||!a.id)return e.errores.push(`Error: No se pudo crear la liquidaci\xf3n. Respuesta: ${JSON.stringify(a)}`),console.error("Liquidaci√≥n no creada:",a),e;f=a.id}e.liquidacionId=f;let o=new Set,p=new Map;for(let b of(console.log(`Extrayendo nombres \xfanicos de ${a.rows.length} filas del Excel`),a.rows)){let a=x(b,["Responsable","responsable","RESPONSABLE","M√©dico","medico","MEDICO","Medico","Profesional","profesional","PROFESIONAL","M√©dico responsable","M√©dico Responsable","Medico Responsable","M√âDICO RESPONSABLE"]);if(a&&"string"==typeof a&&""!==a.trim()){let b=y(a.trim());""!==b&&(o.add(b),p.has(b)||p.set(b,a.trim()))}}console.log(`[Mapeo] Nombres \xfanicos encontrados en Excel: ${o.size}`),console.log(`[Mapeo] Nombres \xfanicos:`,Array.from(o).slice(0,10));let q=new Map;for(let a of o){let b=function(a,b){if(!a||"string"!=typeof a)return null;let c=y(a);if(""===c)return null;for(let a of b)if(y(a.nombre)===c)return a;let d=c.split(",").map(a=>a.trim()),e=c.split(/\s+/).filter(a=>a.length>2);for(let a of b){let b=y(a.nombre);b.split(",").map(a=>a.trim());let c=b.split(/\s+/).filter(a=>a.length>2);if(e.length>0&&c.length>0){let b=new Set(e),d=new Set(c);if(b.size===d.size&&Array.from(b).every(a=>d.has(a)))return a}}let f=d.length>1?d[0].trim():e.length>0?e[0]:c,g=null,h=0;for(let a of b){let b=y(a.nombre),c=b.split(",").map(a=>a.trim()),d=b.split(/\s+/).filter(a=>a.length>2);if(f===(c.length>1?c[0].trim():d.length>0?d[0]:b)&&f.length>2){let b=e.filter(a=>d.some(b=>b===a||b.includes(a)||a.includes(b))).length;b>h&&(h=b,g=a)}}if(g&&h>0)return g;for(let a of b){let b=y(a.nombre),c=b.split(",").map(a=>a.trim()),d=b.split(/\s+/).filter(a=>a.length>2),i=c.length>1?c[0].trim():d.length>0?d[0]:b;if(f.length>2&&i.length>2&&(f.includes(i)||i.includes(f))){let b=e.filter(a=>d.some(b=>b===a||b.includes(a)||a.includes(b))).length;b>=h&&(h=b,g=a)}}if(g)return g;if(e.length>0)for(let a of b){let b=y(a.nombre),d=b.split(/\s+/).filter(a=>a.length>2);if(e.every(a=>b.includes(a))||d.length>0&&d.every(a=>c.includes(a)))return a}if(e.length>=2){let a=null,c=0;for(let d of b){let b=y(d.nombre).split(/\s+/).filter(a=>a.length>2),f=e.filter(a=>b.some(b=>b.includes(a)||a.includes(b))).length;f>=2&&f>c&&(c=f,a=d)}if(a)return a}return null}(p.get(a)||a,i);b&&q.set(a,b)}let r=Array.from(q.keys()),s=Array.from(o).filter(a=>!q.has(a));console.log(`[Mapeo] M\xe9dicos encontrados: ${r.length}/${o.size}`),console.log(`[Mapeo] M\xe9dicos NO encontrados: ${s.length}`),r.length>0&&(console.log(`[Mapeo] M\xe9dicos encontrados:`),r.forEach(a=>{let b=q.get(a),c=p.get(a)||a;console.log(`  - "${c}" -> "${b.nombre}" (${null===b.matricula_provincial?"RESIDENTE":"NO RESIDENTE"})`)})),s.length>0&&(console.log(`[Mapeo] M\xe9dicos NO encontrados:`),s.forEach(a=>{let b=p.get(a)||a;console.log(`  - "${b}" (normalizado: "${a}")`)}),e.advertencias.push(`M\xe9dicos no encontrados en BD (${s.length}): ${s.slice(0,5).map(a=>p.get(a)||a).join(", ")}${s.length>5?"...":""}`));let t=[];if(e.totalFilas=a.rows.length,0===a.rows.length)return e.errores.push("El Excel no contiene filas de datos"),e;console.log(`Procesando ${a.rows.length} filas del Excel`),console.log("Headers disponibles:",a.headers);let u=0,w=0,z=0;for(let b=0;b<a.rows.length;b++){let c=a.rows[b];try{let a=x(c,["Fecha","fecha","FECHA","Fecha visita","Fecha Visita","Fecha de visita","Fecha de Visita","Fecha De Visita","Fecha de atenci√≥n","Fecha Atenci√≥n","Fecha de Atenci√≥n","Fecha de la consulta","Fecha Consulta","Fecha de Consulta","FECHA VISITA","FECHA DE VISITA","Fecha Visita","Fecha visita"]),d=x(c,["Hora","hora","HORA","Horario","horario","HORARIO","Hora inicio","Hora Inicio","Hora de inicio","Hora de Inicio","HORA INICIO"]),g=x(c,["Paciente","paciente","PACIENTE","Nombre paciente","Nombre Paciente","Nombre del paciente","NOMBRE PACIENTE"]),h=x(c,["Obra Social","obra social","Obra social","ObraSocial","Cliente","Obra","Obra Social / Cliente","Obra Social/Cliente","OBRA SOCIAL","CLIENTE"]),i=x(c,["Responsable","responsable","RESPONSABLE","M√©dico","medico","MEDICO","Medico","Profesional","profesional","PROFESIONAL","M√©dico responsable","M√©dico Responsable","Medico Responsable","M√âDICO RESPONSABLE"]),j=null;if(a&&!(j=function(a){if(!a)return null;let b=String(a).trim();if(""===b)return null;let c=b.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(c){let a=c[1].padStart(2,"0"),b=c[2].padStart(2,"0"),d=c[3];return`${d}-${b}-${a}`}let d=b.match(/(\d{4})-(\d{1,2})-(\d{1,2})/);if(d){let a=d[1],b=d[2].padStart(2,"0"),c=d[3].padStart(2,"0");return`${a}-${b}-${c}`}try{let a=new Date(b);if(!isNaN(a.getTime())){let b=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0"),d=String(a.getDate()).padStart(2,"0");return`${b}-${c}-${d}`}}catch{}return null}(a)))if(String(a).match(/(\d{4})-(\d{1,2})-(\d{1,2})/))j=a;else try{let b=new Date(a);if(!isNaN(b.getTime())){let a=b.getFullYear(),c=String(b.getMonth()+1).padStart(2,"0"),d=String(b.getDate()).padStart(2,"0");j=`${a}-${c}-${d}`}}catch{}if(!j){u++,e.advertencias.push(`Fila ${b+1}: Sin fecha v\xe1lida (${a||"vac√≠a"}), se omite`);continue}let l=parseInt(j.split("-")[0]);if(l<2020||l>2100){w++,e.advertencias.push(`Fila ${b+1}: Fecha fuera de rango (${j}), se omite`);continue}let m=null;if(i&&"string"==typeof i&&""!==i.trim()){let a=y(i.trim());m=q.get(a)||null}let n=!!m&&null===m.matricula_provincial;if(!m&&i){let a=y(i.trim());q.has(a)}let o=h||null,p=o&&k.get(o)||0;o&&0===p&&e.advertencias.push(`Fila ${b+1}: No hay valor configurado para obra social: ${o}`);let r=function(a){if(!a)return null;if("string"==typeof a){let b=a.match(/(\d{1,2}):(\d{2})(?::(\d{2}))?/);if(b){let a=b[1].padStart(2,"0"),c=b[2].padStart(2,"0"),d=b[3]||"00";return`${a}:${c}:${d}`}}else if("number"==typeof a){let b=Math.round(86400*a),c=Math.floor(b/3600),d=Math.floor(b%3600/60);return`${String(c).padStart(2,"0")}:${String(d).padStart(2,"0")}:${String(b%60).padStart(2,"0")}`}return null}(d),s=(0,v.esResidenteHorarioFormativo)(j,r,n),A=p,B=p;s&&(A=0,B=0);let C={liquidacion_id:f,medico_id:m?.id||null,fecha:j,hora:r,paciente:g||null,obra_social:o,medico_nombre:i||m?.nombre||"Desconocido",medico_matricula:m?.matricula_provincial||null,medico_es_residente:n,monto_facturado:A,porcentaje_retencion:null,monto_retencion:null,monto_adicional:0,importe_calculado:B,aplica_adicional:!1,es_horario_formativo:s,estado_revision:"pendiente",fila_excel:b+1};t.push(C),z++,e.procesadas++}catch(d){let a=d.message||"Error desconocido";e.errores.push(`Fila ${b+1}: ${a}`),console.error(`Error procesando fila ${b+1}:`,d),console.error("Datos de la fila:",c)}}if(console.log(`Resumen: ${z} procesadas, ${u} sin fecha, ${w} fecha inv\xe1lida`),(u>0||w>0)&&e.advertencias.push(`Total omitidas: ${u+w} (${u} sin fecha, ${w} fecha inv\xe1lida)`),0===t.length)return e.errores.push("No se proces√≥ ninguna fila v√°lida. Verifique que el Excel tenga fechas v√°lidas."),e;console.log(`Guardando ${t.length} detalles en la base de datos`);for(let a=0;a<t.length;a+=100){let b=t.slice(a,a+100),{error:c}=await m.supabase.from("detalle_guardia").insert(b);if(c)return e.errores.push(`Error guardando detalles (lote ${Math.floor(a/100)+1}): ${c.message}. Detalles: ${JSON.stringify(c)}`),console.error("Error guardando detalles:",c),console.error("Primer detalle del lote:",b[0]),e}let A=t.length,B=t.reduce((a,b)=>a+(b.monto_facturado||0),0),C=t.reduce((a,b)=>a+(b.importe_calculado||0),0),{error:D}=await m.supabase.from("liquidaciones_guardia").update({total_consultas:A,total_bruto:B,total_neto:C,estado:"pendiente_revision"}).eq("id",f);D&&e.errores.push(`Error actualizando totales: ${D.message}`)}catch(a){e.errores.push(`Error general: ${a.message||"Error desconocido"}`)}return e}var A=a.i(84091),B=a.i(53315),C=a.i(22851);function D(){let a=(0,d.useRouter)(),[i,j]=(0,c.useState)(!1),[n,o]=(0,c.useState)(null),[q,r]=(0,c.useState)(null),[s,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(null),[y,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(new Date().getMonth()+1),[G,H]=(0,c.useState)(new Date().getFullYear()),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(null),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)({isOpen:!1,type:"info",message:""});function S(a,b,c){R({isOpen:!0,type:a,message:b,title:c}),setTimeout(()=>{R(a=>({...a,isOpen:!1}))},5e3)}let T=async a=>{j(!0),o(null),r(null),x(null),D(null),J(a);try{let b=await (0,u.readExcelFile)(a);o(b);let{mes:c,anio:d}=(a=>{if(a.periodo?.desde){let b=a.periodo.desde.split("/");if(3===b.length){let a=parseInt(b[1],10),c=parseInt(b[2],10);if(a>=1&&a<=12&&c>=2020)return{mes:a,anio:c}}}let b=a.headers.find(a=>a.toLowerCase().includes("fecha")||a.toLowerCase().includes("date"));if(b&&a.rows.length>0){let c=[];if(a.rows.forEach(a=>{let d=a[b];if(d&&"string"==typeof d){let a=d.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(a){let b=parseInt(a[2],10),d=parseInt(a[3],10);b>=1&&b<=12&&d>=2020&&c.push(b)}}}),c.length>0){let d=c[0];if(c.every(a=>a===d)){let c=a.rows[0][b];if("string"==typeof c){let a=c.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(a)return{mes:d,anio:parseInt(a[3],10)}}}}}return{mes:null,anio:null}})(b);c&&d&&(x(c),D(d),F(c),H(d)),v(!0)}catch(a){console.error("Error processing file:",a),r(a.message||"Ocurri√≥ un error inesperado al procesar el archivo.")}finally{j(!1)}},U=async(a,b)=>{if(F(a),H(b),v(!1),n&&I){L(!0);try{let c=await z(n,a,b,I.name);if(c.errores.length>0){let a=c.errores.length>0?`Se procesaron ${c.procesadas} filas. Errores: ${c.errores.slice(0,3).join("; ")}${c.errores.length>3?"...":""}`:`Se procesaron ${c.procesadas} filas. Errores: ${c.errores.length}`;S("error",a,"Procesamiento con errores"),console.error("Errores completos:",c.errores)}else{if(c.liquidacionId){let{data:a}=await m.supabase.from("liquidaciones_guardia").select("*").eq("id",c.liquidacionId).single();a&&(N(a),P(!0))}c.advertencias.length>0?S("warning",`Se procesaron ${c.procesadas} de ${c.totalFilas} filas. ${c.advertencias.length} advertencias. Revisa los datos guardados.`,"Procesamiento completado"):S("success",`Se procesaron y guardaron ${c.procesadas} consultas. Revisa y edita los datos antes de liquidar.`,"Guardado exitoso")}}catch(a){console.error("Error guardando datos:",a),S("error",`Error al guardar: ${a.message||"Error desconocido"}`,"Error")}finally{L(!1)}}};(0,c.useEffect)(()=>{!async function(){try{let{data:a,error:b}=await m.supabase.from("liquidaciones_guardia").select("*").eq("especialidad","Ginecolog√≠a").in("estado",["pendiente_revision","revisado","listo_para_liquidar"]).order("created_at",{ascending:!1}).limit(1).single();if(b&&"PGRST116"!==b.code)return void console.error("Error cargando liquidaci√≥n:",b);a&&(N(a),P(!0),F(a.mes),H(a.anio))}catch(a){console.error("Error cargando liquidaci√≥n:",a)}}()},[]);let V=async(a,b,c)=>{console.log(`Actualizando fila ${a}, columna ${b} con valor:`,c)};return(0,b.jsxs)("div",{className:"min-h-screen relative p-8 pb-20 overflow-hidden",children:[(0,b.jsx)("div",{className:"absolute top-20 left-20 w-96 h-96 bg-green-500/20 rounded-full blur-3xl animate-pulse"}),(0,b.jsx)("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-green-400/20 rounded-full blur-3xl animate-pulse delay-1000"}),(0,b.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8 relative z-10",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsxs)(h.Button,{onClick:()=>a.push("/"),variant:"outline",className:"border-green-500/50 text-green-400 hover:bg-green-500/20",children:[(0,b.jsx)(B.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Volver"]})}),(0,b.jsx)("div",{children:(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,b.jsx)(C.default,{href:"/",className:"hover:opacity-80 transition-opacity",children:(0,b.jsx)("img",{src:"/logogrow.png",alt:"Grow Labs",className:"h-16 w-auto drop-shadow-2xl",style:{filter:"drop-shadow(0 0 20px rgba(34, 197, 94, 0.5))"}})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-4xl font-bold mb-2 tracking-tight",children:(0,b.jsx)("span",{className:"bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent",children:"M√≥dulo Ginecolog√≠a"})}),(0,b.jsxs)("p",{className:"text-gray-400 flex items-center gap-2",children:[(0,b.jsx)(A.Sparkles,{className:"h-4 w-4 text-blue-400"}),"Procesamiento de liquidaciones por hora"]})]})]})})]}),(0,b.jsxs)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:[(0,b.jsx)("div",{className:"absolute inset-0 rounded-2xl",style:{background:"linear-gradient(45deg, transparent, rgba(59, 130, 246, 0.3), transparent)",animation:"borderGlow 3s ease-in-out infinite"}}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-blue-400",children:"üì§ Cargar Liquidaci√≥n"}),(0,b.jsx)(h.Button,{onClick:()=>a.push("/ginecologia/resumenes"),variant:"outline",className:"border-blue-500/50 text-blue-400 hover:bg-blue-500/20",children:"Ver Res√∫menes"})]}),(0,b.jsx)(e.UploadExcel,{onUpload:T,isProcessing:i}),q&&(0,b.jsxs)("div",{className:"mt-6 bg-red-500/10 border border-red-500/30 rounded-lg p-4 flex items-start gap-3 text-red-400",children:[(0,b.jsx)(p.AlertCircle,{className:"w-5 h-5 mt-0.5 shrink-0"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Error de Procesamiento"}),(0,b.jsx)("p",{className:"text-sm opacity-90",children:q})]})]})]})]}),O&&M&&(0,b.jsx)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-blue-400",children:"üìä Detalles Guardados - Revisi√≥n y Edici√≥n"}),(0,b.jsx)(h.Button,{onClick:()=>{P(!1),N(null),o(null)},variant:"outline",className:"border-blue-500/50 text-blue-400 hover:bg-blue-500/20",children:"Cargar Nuevo Excel"})]}),(0,b.jsx)(t,{liquidacionId:M.id,liquidacion:M,onEstadoChange:a=>{N(b=>b?{...b,estado:a}:null)}})]})}),n&&!O&&(0,b.jsx)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-blue-400 mb-6",children:"üìä Vista Previa del Excel"}),(0,b.jsx)("p",{className:"text-gray-400 mb-4 text-sm",children:"Esta es una vista previa. Los datos se guardar√°n despu√©s de confirmar el mes y a√±o."}),(0,b.jsx)(f.ExcelDataTable,{data:n,especialidad:"Ginecolog√≠a",onCellUpdate:V})]})}),n&&n.periodo&&(()=>{let{mes:a,anio:c}={mes:E,anio:G};return(0,b.jsx)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:(0,b.jsx)(g.EstadisticasObraSocial,{mes:a,anio:c,especialidad:"Ginecolog√≠a"})})})(),(0,b.jsxs)("div",{className:"p-6 rounded-xl",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.2)"},children:[(0,b.jsx)("h3",{className:"text-xl font-semibold text-gray-200 mb-4",children:"üìã Reglas Vigentes"}),(0,b.jsxs)("div",{className:"space-y-4 text-sm text-gray-300",children:[(0,b.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Pago por Hora"}),(0,b.jsx)("div",{className:"font-semibold text-white",children:"Seg√∫n Tarifa"}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:"Valor hora vigente por obra social"})]}),(0,b.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"üë®‚Äç‚öïÔ∏è Regla de Residentes en Horario Formativo"}),(0,b.jsxs)("div",{className:"text-sm mt-2 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-red-400 font-semibold",children:"NO SE PAGA"}),(0,b.jsx)("span",{className:"text-xs text-gray-400",children:"si se cumplen todas las condiciones:"})]}),(0,b.jsxs)("ul",{className:"text-xs space-y-1 ml-2 text-gray-300",children:[(0,b.jsxs)("li",{className:"flex items-start gap-2",children:[(0,b.jsx)("span",{className:"text-blue-400",children:"‚Ä¢"}),(0,b.jsxs)("span",{children:["M√©dico es ",(0,b.jsx)("strong",{children:"RESIDENTE"})," (verificado en BD)"]})]}),(0,b.jsxs)("li",{className:"flex items-start gap-2",children:[(0,b.jsx)("span",{className:"text-blue-400",children:"‚Ä¢"}),(0,b.jsxs)("span",{children:["D√≠a: ",(0,b.jsx)("strong",{children:"Lunes a S√°bado"})," (no domingo)"]})]}),(0,b.jsxs)("li",{className:"flex items-start gap-2",children:[(0,b.jsx)("span",{className:"text-blue-400",children:"‚Ä¢"}),(0,b.jsxs)("span",{children:["Horario: ",(0,b.jsx)("strong",{className:"text-blue-400",children:"07:00 a 15:00"})]})]}),(0,b.jsx)("li",{className:"text-xs text-gray-400 mt-1 ml-4",children:"(Incluye 07:00, excluye 15:00)"})]})]})]}),(0,b.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"‚úÖ Casos que S√ç se Pagan"}),(0,b.jsxs)("ul",{className:"text-xs space-y-1 mt-2 text-gray-300",children:[(0,b.jsxs)("li",{className:"flex items-start gap-2",children:[(0,b.jsx)("span",{className:"text-green-400",children:"‚úì"}),(0,b.jsx)("span",{children:"Residente fuera del horario formativo (ej: 16:00, 20:00)"})]}),(0,b.jsxs)("li",{className:"flex items-start gap-2",children:[(0,b.jsx)("span",{className:"text-green-400",children:"‚úì"}),(0,b.jsxs)("span",{children:["Residente en ",(0,b.jsx)("strong",{children:"Domingo"})," (cualquier hora)"]})]}),(0,b.jsxs)("li",{className:"flex items-start gap-2",children:[(0,b.jsx)("span",{className:"text-green-400",children:"‚úì"}),(0,b.jsxs)("span",{children:["M√©dico de ",(0,b.jsx)("strong",{children:"Planta"})," (no residente) - siempre se paga"]})]})]})]}),(0,b.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"üìä Ejemplos de Horarios"}),(0,b.jsxs)("div",{className:"text-xs space-y-1 mt-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-300",children:"07:00 (Residente, L-S)"}),(0,b.jsx)("span",{className:"text-red-400",children:"$0"})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-300",children:"14:59 (Residente, L-S)"}),(0,b.jsx)("span",{className:"text-red-400",children:"$0"})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-300",children:"15:00 (Residente, L-S)"}),(0,b.jsx)("span",{className:"text-green-400",children:"Se paga"})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-300",children:"10:00 (Residente, Domingo)"}),(0,b.jsx)("span",{className:"text-green-400",children:"Se paga"})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-300",children:"10:00 (Planta, cualquier d√≠a)"}),(0,b.jsx)("span",{className:"text-green-400",children:"Se paga"})]})]})]})]})]})]}),(0,b.jsx)(k,{isOpen:s,onClose:()=>v(!1),onConfirm:U,mesDetectado:w,anioDetectado:y,mesActual:new Date().getMonth()+1,anioActual:new Date().getFullYear()}),(0,b.jsx)(l.NotificationModal,{isOpen:Q.isOpen,onClose:()=>R(a=>({...a,isOpen:!1})),type:Q.type,title:Q.title,message:Q.message}),K&&(0,b.jsx)("div",{className:"fixed bottom-4 right-4 p-4 rounded-lg bg-blue-500/20 border border-blue-500/50 text-blue-400",children:"Guardando datos en la base de datos..."})]})}a.s(["default",()=>D],7791)}];

//# sourceMappingURL=Desktop_Osde_Liquidaciones_Guardias_app_ginecologia_page_tsx_a05a1a12._.js.map