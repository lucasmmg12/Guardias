{"version":3,"sources":["../../../../../../../../Desktop/Osde/Liquidaciones/Guardias/components/custom/MesSelectorModal.tsx","../../../../../../../../Desktop/Osde/Liquidaciones/Guardias/components/custom/DetalleGuardiaTable.tsx","../../../../../../../../Desktop/Osde/Liquidaciones/Guardias/app/ginecologia/page.tsx","../../../../../../../../Desktop/Osde/Liquidaciones/Guardias/lib/ginecologia-processor.ts","../../../../../../../../Desktop/Osde/Liquidaciones/Guardias/node_modules/lucide-react/src/icons/save.ts"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { Button } from '@/components/ui/button'\r\nimport { X } from 'lucide-react'\r\n\r\ninterface MesSelectorModalProps {\r\n  isOpen: boolean\r\n  onClose: () => void\r\n  onConfirm: (mes: number, anio: number) => void\r\n  mesDetectado: number | null\r\n  anioDetectado: number | null\r\n  mesActual: number\r\n  anioActual: number\r\n}\r\n\r\nconst MESES = [\r\n  { value: 1, label: 'Enero' },\r\n  { value: 2, label: 'Febrero' },\r\n  { value: 3, label: 'Marzo' },\r\n  { value: 4, label: 'Abril' },\r\n  { value: 5, label: 'Mayo' },\r\n  { value: 6, label: 'Junio' },\r\n  { value: 7, label: 'Julio' },\r\n  { value: 8, label: 'Agosto' },\r\n  { value: 9, label: 'Septiembre' },\r\n  { value: 10, label: 'Octubre' },\r\n  { value: 11, label: 'Noviembre' },\r\n  { value: 12, label: 'Diciembre' },\r\n]\r\n\r\nexport function MesSelectorModal({\r\n  isOpen,\r\n  onClose,\r\n  onConfirm,\r\n  mesDetectado,\r\n  anioDetectado,\r\n  mesActual,\r\n  anioActual\r\n}: MesSelectorModalProps) {\r\n  const [mes, setMes] = useState(mesDetectado || mesActual)\r\n  const [anio, setAnio] = useState(anioDetectado || anioActual)\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setMes(mesDetectado || mesActual)\r\n      setAnio(anioDetectado || anioActual)\r\n    }\r\n  }, [isOpen, mesDetectado, anioDetectado, mesActual, anioActual])\r\n\r\n  if (!isOpen) return null\r\n\r\n  const handleConfirm = () => {\r\n    onConfirm(mes, anio)\r\n    onClose()\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\r\n      {/* Backdrop */}\r\n      <div \r\n        className=\"absolute inset-0 bg-black/70 backdrop-blur-sm\"\r\n        onClick={onClose}\r\n      />\r\n      \r\n      {/* Modal */}\r\n      <div \r\n        className=\"relative z-10 w-full max-w-md mx-4 rounded-2xl p-6\"\r\n        style={{\r\n          background: 'rgba(17, 24, 39, 0.95)',\r\n          backdropFilter: 'blur(20px)',\r\n          border: '1px solid rgba(34, 197, 94, 0.3)',\r\n          boxShadow: '0 8px 32px 0 rgba(34, 197, 94, 0.3)',\r\n        }}\r\n      >\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <h2 className=\"text-2xl font-bold text-green-400\">\r\n            Seleccionar Per√≠odo\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors\"\r\n          >\r\n            <X className=\"h-5 w-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Contenido */}\r\n        <div className=\"space-y-6\">\r\n          {/* Detecci√≥n autom√°tica */}\r\n          {mesDetectado && anioDetectado && (\r\n            <div \r\n              className=\"p-4 rounded-lg\"\r\n              style={{\r\n                background: 'rgba(34, 197, 94, 0.1)',\r\n                border: '1px solid rgba(34, 197, 94, 0.3)',\r\n              }}\r\n            >\r\n              <p className=\"text-sm text-green-400 mb-2\">\r\n                ‚úì Mes detectado autom√°ticamente\r\n              </p>\r\n              <p className=\"text-sm text-gray-300\">\r\n                {MESES[mesDetectado - 1].label} {anioDetectado}\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n          {/* Selector de Mes */}\r\n          <div>\r\n            <label className=\"block text-sm font-semibold text-gray-300 mb-2\">\r\n              Mes\r\n            </label>\r\n            <select\r\n              value={mes}\r\n              onChange={(e) => setMes(Number(e.target.value))}\r\n              className=\"w-full px-4 py-2 bg-gray-800 border border-green-500/50 rounded-lg text-white focus:border-green-400 focus:outline-none\"\r\n            >\r\n              {MESES.map(m => (\r\n                <option key={m.value} value={m.value}>\r\n                  {m.label}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          {/* Selector de A√±o */}\r\n          <div>\r\n            <label className=\"block text-sm font-semibold text-gray-300 mb-2\">\r\n              A√±o\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              value={anio}\r\n              onChange={(e) => setAnio(Number(e.target.value))}\r\n              min={2020}\r\n              max={2100}\r\n              className=\"w-full px-4 py-2 bg-gray-800 border border-green-500/50 rounded-lg text-white focus:border-green-400 focus:outline-none\"\r\n            />\r\n          </div>\r\n\r\n          {/* Botones */}\r\n          <div className=\"flex gap-3 pt-4\">\r\n            <Button\r\n              onClick={onClose}\r\n              variant=\"outline\"\r\n              className=\"flex-1 border-gray-600 text-gray-300 hover:bg-gray-700\"\r\n            >\r\n              Cancelar\r\n            </Button>\r\n            <Button\r\n              onClick={handleConfirm}\r\n              className=\"flex-1 bg-green-600 hover:bg-green-500 text-white\"\r\n            >\r\n              Confirmar\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n","'use client'\r\n\r\nimport { useState, useEffect, useCallback, useRef } from 'react'\r\nimport { supabase } from '@/lib/supabase/client'\r\nimport { DetalleGuardia, LiquidacionGuardia, EstadoLiquidacion } from '@/lib/types'\r\nimport { InlineEditCell } from './InlineEditCell'\r\nimport { Save, AlertCircle, CheckCircle2, Clock } from 'lucide-react'\r\nimport { Button } from '@/components/ui/button'\r\n\r\ninterface DetalleGuardiaTableProps {\r\n  liquidacionId: string\r\n  liquidacion: LiquidacionGuardia | null\r\n  onEstadoChange?: (nuevoEstado: EstadoLiquidacion) => void\r\n}\r\n\r\n// Mapa de estados a etiquetas\r\nconst ESTADOS_LABEL: Record<EstadoLiquidacion, string> = {\r\n  'borrador': 'Borrador',\r\n  'procesando': 'Procesando',\r\n  'pendiente_revision': 'Pendiente de Revisi√≥n',\r\n  'revisado': 'Revisado',\r\n  'listo_para_liquidar': 'Listo para Liquidar',\r\n  'finalizada': 'Finalizada',\r\n  'error': 'Error'\r\n}\r\n\r\nexport function DetalleGuardiaTable({ liquidacionId, liquidacion, onEstadoChange }: DetalleGuardiaTableProps) {\r\n  const [detalles, setDetalles] = useState<DetalleGuardia[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [saving, setSaving] = useState<{ [key: string]: boolean }>({})\r\n  const [saveStatus, setSaveStatus] = useState<'idle' | 'saving' | 'saved' | 'error'>('idle')\r\n  const [lastSaved, setLastSaved] = useState<Date | null>(null)\r\n  const [obrasSociales, setObrasSociales] = useState<string[]>([])\r\n  \r\n  // Debounce timer para guardado autom√°tico\r\n  const saveTimerRef = useRef<NodeJS.Timeout | null>(null)\r\n  const pendingChangesRef = useRef<Map<string, Partial<DetalleGuardia>>>(new Map())\r\n  const isUnmountingRef = useRef(false)\r\n\r\n  // Cargar detalles desde la BD\r\n  const cargarDetalles = useCallback(async () => {\r\n    try {\r\n      setLoading(true)\r\n      const { data, error } = await supabase\r\n        .from('detalle_guardia')\r\n        .select('*')\r\n        .eq('liquidacion_id', liquidacionId)\r\n        .order('fecha', { ascending: true })\r\n        .order('hora', { ascending: true })\r\n\r\n      if (error) throw error\r\n      setDetalles((data as DetalleGuardia[]) || [])\r\n    } catch (error) {\r\n      console.error('Error cargando detalles:', error)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }, [liquidacionId])\r\n\r\n  // Cargar obras sociales disponibles\r\n  const cargarObrasSociales = useCallback(async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('valores_consultas_obra_social')\r\n        .select('obra_social')\r\n        .eq('tipo_consulta', 'CONSULTA GINECOLOGICA')\r\n\r\n      if (error) throw error\r\n      \r\n      const obrasUnicas = Array.from(new Set((data || []).map((v: any) => v.obra_social).filter(Boolean)))\r\n      setObrasSociales(obrasUnicas.sort())\r\n    } catch (error) {\r\n      console.error('Error cargando obras sociales:', error)\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    cargarDetalles()\r\n    cargarObrasSociales()\r\n  }, [cargarDetalles, cargarObrasSociales])\r\n\r\n  // Guardar cambios pendientes\r\n  const guardarCambios = useCallback(async (force = false) => {\r\n    if (pendingChangesRef.current.size === 0) {\r\n      setSaveStatus('idle')\r\n      return\r\n    }\r\n\r\n    // Si no es forzado y hay un timer activo, cancelarlo\r\n    if (!force && saveTimerRef.current) {\r\n      clearTimeout(saveTimerRef.current)\r\n      saveTimerRef.current = null\r\n    }\r\n\r\n    setSaveStatus('saving')\r\n    const cambios = Array.from(pendingChangesRef.current.entries())\r\n\r\n    try {\r\n      // Guardar todos los cambios en paralelo\r\n      const promesas = cambios.map(async ([id, cambios]) => {\r\n        const { error } = await supabase\r\n          .from('detalle_guardia')\r\n          // @ts-ignore\r\n          .update({\r\n            ...cambios,\r\n            updated_at: new Date().toISOString()\r\n          })\r\n          .eq('id', id)\r\n\r\n        if (error) throw error\r\n      })\r\n\r\n      await Promise.all(promesas)\r\n\r\n      // Limpiar cambios pendientes\r\n      pendingChangesRef.current.clear()\r\n      setSaveStatus('saved')\r\n      setLastSaved(new Date())\r\n\r\n      // Actualizar estado local\r\n      await cargarDetalles()\r\n\r\n      // Resetear estado despu√©s de 2 segundos\r\n      setTimeout(() => {\r\n        if (!isUnmountingRef.current) {\r\n          setSaveStatus('idle')\r\n        }\r\n      }, 2000)\r\n    } catch (error) {\r\n      console.error('Error guardando cambios:', error)\r\n      setSaveStatus('error')\r\n      \r\n      // Reintentar despu√©s de 3 segundos\r\n      setTimeout(() => {\r\n        if (!isUnmountingRef.current && pendingChangesRef.current.size > 0) {\r\n          guardarCambios(true)\r\n        }\r\n      }, 3000)\r\n    }\r\n  }, [cargarDetalles])\r\n\r\n  // Programar guardado autom√°tico con debounce\r\n  const programarGuardado = useCallback((detalleId: string, cambios: Partial<DetalleGuardia>) => {\r\n    // Agregar a cambios pendientes\r\n    const cambiosExistentes = pendingChangesRef.current.get(detalleId) || {}\r\n    pendingChangesRef.current.set(detalleId, { ...cambiosExistentes, ...cambios })\r\n\r\n    // Cancelar timer anterior\r\n    if (saveTimerRef.current) {\r\n      clearTimeout(saveTimerRef.current)\r\n    }\r\n\r\n    // Programar nuevo guardado (500ms de debounce)\r\n    saveTimerRef.current = setTimeout(() => {\r\n      guardarCambios(true)\r\n    }, 500)\r\n  }, [guardarCambios])\r\n\r\n  // Guardar antes de desmontar\r\n  useEffect(() => {\r\n    return () => {\r\n      isUnmountingRef.current = true\r\n      if (saveTimerRef.current) {\r\n        clearTimeout(saveTimerRef.current)\r\n      }\r\n      // Guardar cambios pendientes antes de desmontar\r\n      if (pendingChangesRef.current.size > 0) {\r\n        guardarCambios(true)\r\n      }\r\n    }\r\n  }, [guardarCambios])\r\n\r\n  // Guardar antes de cerrar/recargar p√°gina\r\n  useEffect(() => {\r\n    const handleBeforeUnload = (e: BeforeUnloadEvent) => {\r\n      if (pendingChangesRef.current.size > 0) {\r\n        e.preventDefault()\r\n        e.returnValue = 'Tienes cambios sin guardar. ¬øEst√°s seguro de que quieres salir?'\r\n        // Intentar guardar sincr√≥nicamente (limitado por navegador)\r\n        guardarCambios(true)\r\n      }\r\n    }\r\n\r\n    window.addEventListener('beforeunload', handleBeforeUnload)\r\n    return () => window.removeEventListener('beforeunload', handleBeforeUnload)\r\n  }, [guardarCambios])\r\n\r\n  // Guardado peri√≥dico cada 10 segundos\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      if (pendingChangesRef.current.size > 0) {\r\n        guardarCambios(true)\r\n      }\r\n    }, 10000)\r\n\r\n    return () => clearInterval(interval)\r\n  }, [guardarCambios])\r\n\r\n  const handleObraSocialUpdate = useCallback(async (detalleId: string, nuevaObraSocial: string | null) => {\r\n    // Actualizar estado local inmediatamente\r\n    setDetalles(prev => prev.map(d => \r\n      d.id === detalleId ? { ...d, obra_social: nuevaObraSocial } : d\r\n    ))\r\n\r\n    // Programar guardado autom√°tico\r\n    programarGuardado(detalleId, { obra_social: nuevaObraSocial })\r\n  }, [programarGuardado])\r\n\r\n  const handleEstadoChange = useCallback(async (nuevoEstado: EstadoLiquidacion) => {\r\n    if (!liquidacion) return\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from('liquidaciones_guardia')\r\n        // @ts-ignore\r\n        .update({ estado: nuevoEstado })\r\n        .eq('id', liquidacion.id)\r\n\r\n      if (error) throw error\r\n      \r\n      if (onEstadoChange) {\r\n        onEstadoChange(nuevoEstado)\r\n      }\r\n    } catch (error) {\r\n      console.error('Error actualizando estado:', error)\r\n    }\r\n  }, [liquidacion, onEstadoChange])\r\n\r\n  const formatearMoneda = (valor: number | null): string => {\r\n    if (!valor) return '$0.00'\r\n    return new Intl.NumberFormat('es-AR', {\r\n      style: 'currency',\r\n      currency: 'ARS',\r\n      minimumFractionDigits: 2,\r\n      maximumFractionDigits: 2\r\n    }).format(valor)\r\n  }\r\n\r\n  const formatearFecha = (fecha: string | null): string => {\r\n    if (!fecha) return '-'\r\n    return new Date(fecha).toLocaleDateString('es-AR')\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"text-center py-12 text-gray-400\">\r\n        <Clock className=\"h-8 w-8 mx-auto mb-4 animate-spin\" />\r\n        Cargando detalles...\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (detalles.length === 0) {\r\n    return (\r\n      <div className=\"text-center py-12 text-gray-400\">\r\n        No hay detalles para mostrar\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const filasSinObraSocial = detalles.filter(d => !d.obra_social || d.obra_social.trim() === '').length\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Barra de estado y controles */}\r\n      <div className=\"flex items-center justify-between p-4 rounded-xl bg-gray-800/50 border border-gray-700\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <div className=\"flex items-center gap-2\">\r\n            {saveStatus === 'saving' && (\r\n              <>\r\n                <Clock className=\"h-4 w-4 text-yellow-400 animate-spin\" />\r\n                <span className=\"text-sm text-yellow-400\">Guardando...</span>\r\n              </>\r\n            )}\r\n            {saveStatus === 'saved' && (\r\n              <>\r\n                <CheckCircle2 className=\"h-4 w-4 text-green-400\" />\r\n                <span className=\"text-sm text-green-400\">\r\n                  Guardado {lastSaved ? `a las ${lastSaved.toLocaleTimeString('es-AR')}` : ''}\r\n                </span>\r\n              </>\r\n            )}\r\n            {saveStatus === 'error' && (\r\n              <>\r\n                <AlertCircle className=\"h-4 w-4 text-red-400\" />\r\n                <span className=\"text-sm text-red-400\">Error al guardar. Reintentando...</span>\r\n              </>\r\n            )}\r\n            {saveStatus === 'idle' && pendingChangesRef.current.size > 0 && (\r\n              <span className=\"text-sm text-gray-400\">\r\n                {pendingChangesRef.current.size} cambio(s) pendiente(s)\r\n              </span>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-4\">\r\n          {liquidacion && (\r\n            <div className=\"flex items-center gap-2\">\r\n              <label className=\"text-sm text-gray-300\">Estado:</label>\r\n              <select\r\n                value={liquidacion.estado}\r\n                onChange={(e) => handleEstadoChange(e.target.value as EstadoLiquidacion)}\r\n                className=\"px-3 py-1 bg-gray-700 border border-gray-600 rounded text-white text-sm focus:border-green-400 focus:outline-none\"\r\n              >\r\n                {Object.entries(ESTADOS_LABEL).map(([value, label]) => (\r\n                  <option key={value} value={value}>{label}</option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          )}\r\n          \r\n          {pendingChangesRef.current.size > 0 && (\r\n            <Button\r\n              onClick={() => guardarCambios(true)}\r\n              size=\"sm\"\r\n              className=\"bg-green-600 hover:bg-green-500\"\r\n            >\r\n              <Save className=\"h-4 w-4 mr-2\" />\r\n              Guardar ahora\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Alerta de filas sin obra social */}\r\n      {filasSinObraSocial > 0 && (\r\n        <div className=\"p-4 rounded-xl bg-yellow-500/20 border border-yellow-500/50\">\r\n          <div className=\"flex items-center gap-2 text-yellow-400\">\r\n            <AlertCircle className=\"h-5 w-5\" />\r\n            <span className=\"font-semibold\">\r\n              {filasSinObraSocial} fila(s) sin obra social - Requiere revisi√≥n\r\n            </span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Tabla de detalles */}\r\n      <div className=\"overflow-x-auto rounded-xl border border-gray-700\">\r\n        <table className=\"w-full\">\r\n          <thead className=\"bg-gray-800\">\r\n            <tr>\r\n              <th className=\"px-4 py-3 text-left text-sm font-semibold text-green-400 sticky left-0 bg-gray-800 z-10\">Fecha</th>\r\n              <th className=\"px-4 py-3 text-left text-sm font-semibold text-green-400\">Hora</th>\r\n              <th className=\"px-4 py-3 text-left text-sm font-semibold text-green-400\">M√©dico</th>\r\n              <th className=\"px-4 py-3 text-left text-sm font-semibold text-green-400\">Paciente</th>\r\n              <th className=\"px-4 py-3 text-left text-sm font-semibold text-green-400\">Obra Social</th>\r\n              <th className=\"px-4 py-3 text-right text-sm font-semibold text-green-400\">Monto Facturado</th>\r\n              <th className=\"px-4 py-3 text-right text-sm font-semibold text-green-400\">Importe Calculado</th>\r\n              <th className=\"px-4 py-3 text-center text-sm font-semibold text-green-400\">Horario Formativo</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {detalles.map((detalle) => {\r\n              const sinObraSocial = !detalle.obra_social || detalle.obra_social.trim() === ''\r\n              \r\n              return (\r\n                <tr\r\n                  key={detalle.id}\r\n                  className={`border-b border-gray-800 hover:bg-gray-800/50 ${\r\n                    sinObraSocial ? 'bg-yellow-500/10' : ''\r\n                  }`}\r\n                >\r\n                  <td className=\"px-4 py-3 text-sm text-gray-300 sticky left-0 bg-gray-900 z-10\">\r\n                    {formatearFecha(detalle.fecha)}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-sm text-gray-300\">\r\n                    {detalle.hora || '-'}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-sm text-gray-300\">\r\n                    {detalle.medico_nombre || '-'}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-sm text-gray-300\">\r\n                    {detalle.paciente || '-'}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-sm\">\r\n                    <InlineEditCell\r\n                      value={detalle.obra_social || ''}\r\n                      onSave={(newValue) => handleObraSocialUpdate(detalle.id, typeof newValue === 'string' ? (newValue || null) : String(newValue) || null)}\r\n                      className={sinObraSocial ? 'bg-yellow-500/20 border-yellow-500/50' : ''}\r\n                      columnName=\"Obra Social\"\r\n                    />\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-sm text-gray-300 text-right\">\r\n                    {formatearMoneda(detalle.monto_facturado)}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-sm text-gray-300 text-right font-semibold\">\r\n                    {formatearMoneda(detalle.importe_calculado)}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-sm text-center\">\r\n                    {detalle.es_horario_formativo ? (\r\n                      <span className=\"text-yellow-400\">S√≠</span>\r\n                    ) : (\r\n                      <span className=\"text-gray-500\">No</span>\r\n                    )}\r\n                  </td>\r\n                </tr>\r\n              )\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n","'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { useRouter } from 'next/navigation'\r\nimport { UploadExcel } from '@/components/custom/UploadExcel'\r\nimport { ExcelDataTable } from '@/components/custom/ExcelDataTable'\r\nimport { EstadisticasObraSocial } from '@/components/custom/EstadisticasObraSocial'\r\nimport { MesSelectorModal } from '@/components/custom/MesSelectorModal'\r\nimport { NotificationModal, NotificationType } from '@/components/custom/NotificationModal'\r\nimport { DetalleGuardiaTable } from '@/components/custom/DetalleGuardiaTable'\r\nimport { readExcelFile, ExcelData } from '@/lib/excel-reader'\r\nimport { procesarExcelGinecologia } from '@/lib/ginecologia-processor'\r\nimport { supabase } from '@/lib/supabase/client'\r\nimport { LiquidacionGuardia, EstadoLiquidacion } from '@/lib/types'\r\nimport { AlertCircle, CheckCircle2, Sparkles, ArrowLeft } from 'lucide-react'\r\nimport Link from 'next/link'\r\nimport { Button } from '@/components/ui/button'\r\n\r\nexport default function GinecologiaPage() {\r\n    const router = useRouter()\r\n    const [isProcessing, setIsProcessing] = useState(false)\r\n    const [excelData, setExcelData] = useState<ExcelData | null>(null)\r\n    const [error, setError] = useState<string | null>(null)\r\n    const [showMesSelector, setShowMesSelector] = useState(false)\r\n    const [mesDetectado, setMesDetectado] = useState<number | null>(null)\r\n    const [anioDetectado, setAnioDetectado] = useState<number | null>(null)\r\n    const [mesSeleccionado, setMesSeleccionado] = useState(new Date().getMonth() + 1)\r\n    const [anioSeleccionado, setAnioSeleccionado] = useState(new Date().getFullYear())\r\n    const [archivoActual, setArchivoActual] = useState<File | null>(null)\r\n    const [isGuardando, setIsGuardando] = useState(false)\r\n    const [liquidacionActual, setLiquidacionActual] = useState<LiquidacionGuardia | null>(null)\r\n    const [mostrarTablaDetalles, setMostrarTablaDetalles] = useState(false)\r\n    const [notification, setNotification] = useState<{\r\n        isOpen: boolean\r\n        type: NotificationType\r\n        title?: string\r\n        message: string\r\n    }>({\r\n        isOpen: false,\r\n        type: 'info',\r\n        message: ''\r\n    })\r\n\r\n    function showNotification(type: NotificationType, message: string, title?: string) {\r\n        setNotification({\r\n            isOpen: true,\r\n            type,\r\n            message,\r\n            title\r\n        })\r\n        setTimeout(() => {\r\n            setNotification(prev => ({ ...prev, isOpen: false }))\r\n        }, 5000)\r\n    }\r\n\r\n    // Funci√≥n para detectar mes y a√±o desde las fechas del Excel\r\n    const detectarMesAnio = (data: ExcelData): { mes: number | null; anio: number | null } => {\r\n        // Primero intentar desde el per√≠odo\r\n        if (data.periodo?.desde) {\r\n            const partes = data.periodo.desde.split('/')\r\n            if (partes.length === 3) {\r\n                const mes = parseInt(partes[1], 10)\r\n                const anio = parseInt(partes[2], 10)\r\n                if (mes >= 1 && mes <= 12 && anio >= 2020) {\r\n                    return { mes, anio }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Si no hay per√≠odo, buscar en las fechas de las filas\r\n        const fechaColumn = data.headers.find(h => \r\n            h.toLowerCase().includes('fecha') || \r\n            h.toLowerCase().includes('date')\r\n        )\r\n\r\n        if (fechaColumn && data.rows.length > 0) {\r\n            const fechas: number[] = []\r\n            data.rows.forEach(row => {\r\n                const fechaStr = row[fechaColumn]\r\n                if (fechaStr) {\r\n                    // Intentar parsear fecha en formato DD/MM/YYYY\r\n                    if (typeof fechaStr === 'string') {\r\n                        const match = fechaStr.match(/(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})/)\r\n                        if (match) {\r\n                            const mes = parseInt(match[2], 10)\r\n                            const anio = parseInt(match[3], 10)\r\n                            if (mes >= 1 && mes <= 12 && anio >= 2020) {\r\n                                fechas.push(mes)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n\r\n            // Si todas las fechas son del mismo mes, usar ese mes\r\n            if (fechas.length > 0) {\r\n                const mesComun = fechas[0]\r\n                const todasIguales = fechas.every(m => m === mesComun)\r\n                if (todasIguales) {\r\n                    // Obtener a√±o de la primera fecha\r\n                    const primeraFecha = data.rows[0][fechaColumn]\r\n                    if (typeof primeraFecha === 'string') {\r\n                        const match = primeraFecha.match(/(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})/)\r\n                        if (match) {\r\n                            return { mes: mesComun, anio: parseInt(match[3], 10) }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return { mes: null, anio: null }\r\n    }\r\n\r\n    const handleUpload = async (file: File) => {\r\n        setIsProcessing(true)\r\n        setExcelData(null)\r\n        setError(null)\r\n        setMesDetectado(null)\r\n        setAnioDetectado(null)\r\n        setArchivoActual(file)\r\n\r\n        try {\r\n            const data = await readExcelFile(file)\r\n            setExcelData(data)\r\n            \r\n            // Detectar mes y a√±o autom√°ticamente\r\n            const { mes, anio } = detectarMesAnio(data)\r\n            if (mes && anio) {\r\n                setMesDetectado(mes)\r\n                setAnioDetectado(anio)\r\n                setMesSeleccionado(mes)\r\n                setAnioSeleccionado(anio)\r\n                // Mostrar modal para confirmar\r\n                setShowMesSelector(true)\r\n            } else {\r\n                // Si no se detect√≥, mostrar modal para seleccionar manualmente\r\n                setShowMesSelector(true)\r\n            }\r\n        } catch (err: any) {\r\n            console.error('Error processing file:', err)\r\n            setError(err.message || 'Ocurri√≥ un error inesperado al procesar el archivo.')\r\n        } finally {\r\n            setIsProcessing(false)\r\n        }\r\n    }\r\n\r\n    const handleMesConfirmado = async (mes: number, anio: number) => {\r\n        setMesSeleccionado(mes)\r\n        setAnioSeleccionado(anio)\r\n        setShowMesSelector(false)\r\n\r\n        // Si hay datos del Excel, procesar y guardar\r\n        if (excelData && archivoActual) {\r\n            setIsGuardando(true)\r\n            try {\r\n                const resultado = await procesarExcelGinecologia(\r\n                    excelData,\r\n                    mes,\r\n                    anio,\r\n                    archivoActual.name\r\n                )\r\n\r\n                if (resultado.errores.length > 0) {\r\n                    const mensajeError = resultado.errores.length > 0 \r\n                        ? `Se procesaron ${resultado.procesadas} filas. Errores: ${resultado.errores.slice(0, 3).join('; ')}${resultado.errores.length > 3 ? '...' : ''}`\r\n                        : `Se procesaron ${resultado.procesadas} filas. Errores: ${resultado.errores.length}`\r\n                    showNotification(\r\n                        'error',\r\n                        mensajeError,\r\n                        'Procesamiento con errores'\r\n                    )\r\n                    console.error('Errores completos:', resultado.errores)\r\n                } else {\r\n                    // Cargar la liquidaci√≥n guardada\r\n                    if (resultado.liquidacionId) {\r\n                        const { data: liquidacionData } = await supabase\r\n                            .from('liquidaciones_guardia')\r\n                            .select('*')\r\n                            .eq('id', resultado.liquidacionId)\r\n                            .single()\r\n                        \r\n                        if (liquidacionData) {\r\n                            setLiquidacionActual(liquidacionData as LiquidacionGuardia)\r\n                            setMostrarTablaDetalles(true)\r\n                        }\r\n                    }\r\n\r\n                    if (resultado.advertencias.length > 0) {\r\n                        showNotification(\r\n                            'warning',\r\n                            `Se procesaron ${resultado.procesadas} de ${resultado.totalFilas} filas. ${resultado.advertencias.length} advertencias. Revisa los datos guardados.`,\r\n                            'Procesamiento completado'\r\n                        )\r\n                    } else {\r\n                        showNotification(\r\n                            'success',\r\n                            `Se procesaron y guardaron ${resultado.procesadas} consultas. Revisa y edita los datos antes de liquidar.`,\r\n                            'Guardado exitoso'\r\n                        )\r\n                    }\r\n                }\r\n            } catch (err: any) {\r\n                console.error('Error guardando datos:', err)\r\n                showNotification(\r\n                    'error',\r\n                    `Error al guardar: ${err.message || 'Error desconocido'}`,\r\n                    'Error'\r\n                )\r\n            } finally {\r\n                setIsGuardando(false)\r\n            }\r\n        }\r\n    }\r\n\r\n    // Cargar liquidaci√≥n existente al montar (si hay una en progreso)\r\n    useEffect(() => {\r\n        async function cargarLiquidacionEnProgreso() {\r\n            try {\r\n                const { data, error } = await supabase\r\n                    .from('liquidaciones_guardia')\r\n                    .select('*')\r\n                    .eq('especialidad', 'Ginecolog√≠a')\r\n                    .in('estado', ['pendiente_revision', 'revisado', 'listo_para_liquidar'])\r\n                    .order('created_at', { ascending: false })\r\n                    .limit(1)\r\n                    .single()\r\n\r\n                if (error && error.code !== 'PGRST116') { // PGRST116 = no rows returned\r\n                    console.error('Error cargando liquidaci√≥n:', error)\r\n                    return\r\n                }\r\n\r\n                if (data) {\r\n                    const liquidacion = data as LiquidacionGuardia\r\n                    setLiquidacionActual(liquidacion)\r\n                    setMostrarTablaDetalles(true)\r\n                    setMesSeleccionado(liquidacion.mes)\r\n                    setAnioSeleccionado(liquidacion.anio)\r\n                }\r\n            } catch (error) {\r\n                console.error('Error cargando liquidaci√≥n:', error)\r\n            }\r\n        }\r\n\r\n        cargarLiquidacionEnProgreso()\r\n    }, [])\r\n\r\n    // Extraer mes y a√±o del per√≠odo del Excel (usar el seleccionado)\r\n    const obtenerMesAnio = () => {\r\n        return { mes: mesSeleccionado, anio: anioSeleccionado }\r\n    }\r\n\r\n    const handleCellUpdate = async (rowIndex: number, column: string, newValue: any) => {\r\n        // Aqu√≠ puedes guardar los cambios en la base de datos o en el estado\r\n        console.log(`Actualizando fila ${rowIndex}, columna ${column} con valor:`, newValue)\r\n        // TODO: Implementar guardado en base de datos si es necesario\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen relative p-8 pb-20 overflow-hidden\">\r\n            {/* Efectos de luz verde */}\r\n            <div className=\"absolute top-20 left-20 w-96 h-96 bg-green-500/20 rounded-full blur-3xl animate-pulse\"></div>\r\n            <div className=\"absolute bottom-20 right-20 w-96 h-96 bg-green-400/20 rounded-full blur-3xl animate-pulse delay-1000\"></div>\r\n\r\n            <div className=\"max-w-6xl mx-auto space-y-8 relative z-10\">\r\n                {/* Header con Logo */}\r\n                <div className=\"flex items-center justify-between mb-8\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <Button\r\n                            onClick={() => router.push('/')}\r\n                            variant=\"outline\"\r\n                            className=\"border-green-500/50 text-green-400 hover:bg-green-500/20\"\r\n                        >\r\n                            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n                            Volver\r\n                        </Button>\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"flex items-center gap-4 mb-4\">\r\n                            <Link href=\"/\" className=\"hover:opacity-80 transition-opacity\">\r\n                                <img \r\n                                    src=\"/logogrow.png\" \r\n                                    alt=\"Grow Labs\" \r\n                                    className=\"h-16 w-auto drop-shadow-2xl\"\r\n                                    style={{\r\n                                        filter: 'drop-shadow(0 0 20px rgba(34, 197, 94, 0.5))'\r\n                                    }}\r\n                                />\r\n                            </Link>\r\n                            <div>\r\n                                <h1 className=\"text-4xl font-bold mb-2 tracking-tight\">\r\n                                    <span className=\"bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent\">\r\n                                        M√≥dulo Ginecolog√≠a\r\n                                    </span>\r\n                                </h1>\r\n                                <p className=\"text-gray-400 flex items-center gap-2\">\r\n                                    <Sparkles className=\"h-4 w-4 text-blue-400\" />\r\n                                    Procesamiento de liquidaciones por hora\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Upload Excel Card */}\r\n                <div \r\n                    className=\"relative rounded-2xl shadow-2xl overflow-hidden p-8\"\r\n                    style={{\r\n                        background: 'rgba(255, 255, 255, 0.1)',\r\n                        backdropFilter: 'blur(20px)',\r\n                        border: '1px solid rgba(59, 130, 246, 0.3)',\r\n                        boxShadow: '0 8px 32px 0 rgba(59, 130, 246, 0.3)',\r\n                    }}\r\n                >\r\n                    {/* Borde brillante animado */}\r\n                    <div \r\n                        className=\"absolute inset-0 rounded-2xl\"\r\n                        style={{\r\n                            background: 'linear-gradient(45deg, transparent, rgba(59, 130, 246, 0.3), transparent)',\r\n                            animation: 'borderGlow 3s ease-in-out infinite',\r\n                        }}\r\n                    ></div>\r\n                    <div className=\"relative\">\r\n                        <div className=\"flex items-center justify-between mb-6\">\r\n                            <h2 className=\"text-2xl font-bold text-blue-400\">\r\n                                üì§ Cargar Liquidaci√≥n\r\n                            </h2>\r\n                            <Button\r\n                                onClick={() => router.push('/ginecologia/resumenes')}\r\n                                variant=\"outline\"\r\n                                className=\"border-blue-500/50 text-blue-400 hover:bg-blue-500/20\"\r\n                            >\r\n                                Ver Res√∫menes\r\n                            </Button>\r\n                        </div>\r\n\r\n                    <UploadExcel onUpload={handleUpload} isProcessing={isProcessing} />\r\n\r\n                    {/* Mensaje de error */}\r\n                    {error && (\r\n                        <div className=\"mt-6 bg-red-500/10 border border-red-500/30 rounded-lg p-4 flex items-start gap-3 text-red-400\">\r\n                            <AlertCircle className=\"w-5 h-5 mt-0.5 shrink-0\" />\r\n                            <div>\r\n                                <h3 className=\"font-semibold\">Error de Procesamiento</h3>\r\n                                <p className=\"text-sm opacity-90\">{error}</p>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Tabla de detalles guardados (si hay liquidaci√≥n) */}\r\n                {mostrarTablaDetalles && liquidacionActual && (\r\n                    <div \r\n                        className=\"relative rounded-2xl shadow-2xl overflow-hidden p-8\"\r\n                        style={{\r\n                            background: 'rgba(255, 255, 255, 0.1)',\r\n                            backdropFilter: 'blur(20px)',\r\n                            border: '1px solid rgba(59, 130, 246, 0.3)',\r\n                            boxShadow: '0 8px 32px 0 rgba(59, 130, 246, 0.3)',\r\n                        }}\r\n                    >\r\n                        <div className=\"relative\">\r\n                            <div className=\"flex items-center justify-between mb-6\">\r\n                                <h2 className=\"text-2xl font-bold text-blue-400\">\r\n                                    üìä Detalles Guardados - Revisi√≥n y Edici√≥n\r\n                                </h2>\r\n                                <Button\r\n                                    onClick={() => {\r\n                                        setMostrarTablaDetalles(false)\r\n                                        setLiquidacionActual(null)\r\n                                        setExcelData(null)\r\n                                    }}\r\n                                    variant=\"outline\"\r\n                                    className=\"border-blue-500/50 text-blue-400 hover:bg-blue-500/20\"\r\n                                >\r\n                                    Cargar Nuevo Excel\r\n                                </Button>\r\n                            </div>\r\n                            <DetalleGuardiaTable\r\n                                liquidacionId={liquidacionActual.id}\r\n                                liquidacion={liquidacionActual}\r\n                                onEstadoChange={(nuevoEstado) => {\r\n                                    setLiquidacionActual(prev => prev ? { ...prev, estado: nuevoEstado } : null)\r\n                                }}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Tabla de datos del Excel (solo si no hay liquidaci√≥n guardada) */}\r\n                {excelData && !mostrarTablaDetalles && (\r\n                    <div \r\n                        className=\"relative rounded-2xl shadow-2xl overflow-hidden p-8\"\r\n                        style={{\r\n                            background: 'rgba(255, 255, 255, 0.1)',\r\n                            backdropFilter: 'blur(20px)',\r\n                            border: '1px solid rgba(59, 130, 246, 0.3)',\r\n                            boxShadow: '0 8px 32px 0 rgba(59, 130, 246, 0.3)',\r\n                        }}\r\n                    >\r\n                        <div className=\"relative\">\r\n                            <h2 className=\"text-2xl font-bold text-blue-400 mb-6\">\r\n                                üìä Vista Previa del Excel\r\n                            </h2>\r\n                            <p className=\"text-gray-400 mb-4 text-sm\">\r\n                                Esta es una vista previa. Los datos se guardar√°n despu√©s de confirmar el mes y a√±o.\r\n                            </p>\r\n                            <ExcelDataTable\r\n                                data={excelData}\r\n                                especialidad=\"Ginecolog√≠a\"\r\n                                onCellUpdate={handleCellUpdate}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Estad√≠sticas por Obra Social */}\r\n                {excelData && excelData.periodo && (() => {\r\n                    const { mes, anio } = obtenerMesAnio()\r\n                    return (\r\n                        <div \r\n                            className=\"relative rounded-2xl shadow-2xl overflow-hidden p-8\"\r\n                            style={{\r\n                                background: 'rgba(255, 255, 255, 0.1)',\r\n                                backdropFilter: 'blur(20px)',\r\n                                border: '1px solid rgba(59, 130, 246, 0.3)',\r\n                                boxShadow: '0 8px 32px 0 rgba(59, 130, 246, 0.3)',\r\n                            }}\r\n                        >\r\n                            <EstadisticasObraSocial\r\n                                mes={mes}\r\n                                anio={anio}\r\n                                especialidad=\"Ginecolog√≠a\"\r\n                            />\r\n                        </div>\r\n                    )\r\n                })()}\r\n\r\n                {/* Reglas de Negocio */}\r\n                <div \r\n                    className=\"p-6 rounded-xl\"\r\n                    style={{\r\n                        background: 'rgba(255, 255, 255, 0.1)',\r\n                        backdropFilter: 'blur(20px)',\r\n                        border: '1px solid rgba(255, 255, 255, 0.2)',\r\n                        boxShadow: '0 8px 32px 0 rgba(59, 130, 246, 0.2)',\r\n                    }}\r\n                >\r\n                        <h3 className=\"text-xl font-semibold text-gray-200 mb-4\">\r\n                            üìã Reglas Vigentes\r\n                        </h3>\r\n                        <div className=\"space-y-4 text-sm text-gray-300\">\r\n                            <div className=\"p-3 bg-white/5 rounded-lg border border-white/5\">\r\n                                <div className=\"text-xs text-gray-500 uppercase tracking-wider mb-1\">Pago por Hora</div>\r\n                                <div className=\"font-semibold text-white\">Seg√∫n Tarifa</div>\r\n                                <div className=\"text-xs text-gray-400\">Valor hora vigente por obra social</div>\r\n                            </div>\r\n\r\n                            <div className=\"p-3 bg-white/5 rounded-lg border border-white/5\">\r\n                                <div className=\"text-xs text-gray-500 uppercase tracking-wider mb-1\">üë®‚Äç‚öïÔ∏è Regla de Residentes en Horario Formativo</div>\r\n                                <div className=\"text-sm mt-2 space-y-2\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <span className=\"text-red-400 font-semibold\">NO SE PAGA</span>\r\n                                        <span className=\"text-xs text-gray-400\">si se cumplen todas las condiciones:</span>\r\n                                    </div>\r\n                                    <ul className=\"text-xs space-y-1 ml-2 text-gray-300\">\r\n                                        <li className=\"flex items-start gap-2\">\r\n                                            <span className=\"text-blue-400\">‚Ä¢</span>\r\n                                            <span>M√©dico es <strong>RESIDENTE</strong> (verificado en BD)</span>\r\n                                        </li>\r\n                                        <li className=\"flex items-start gap-2\">\r\n                                            <span className=\"text-blue-400\">‚Ä¢</span>\r\n                                            <span>D√≠a: <strong>Lunes a S√°bado</strong> (no domingo)</span>\r\n                                        </li>\r\n                                        <li className=\"flex items-start gap-2\">\r\n                                            <span className=\"text-blue-400\">‚Ä¢</span>\r\n                                            <span>Horario: <strong className=\"text-blue-400\">07:00 a 15:00</strong></span>\r\n                                        </li>\r\n                                        <li className=\"text-xs text-gray-400 mt-1 ml-4\">\r\n                                            (Incluye 07:00, excluye 15:00)\r\n                                        </li>\r\n                                    </ul>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"p-3 bg-white/5 rounded-lg border border-white/5\">\r\n                                <div className=\"text-xs text-gray-500 uppercase tracking-wider mb-1\">‚úÖ Casos que S√ç se Pagan</div>\r\n                                <ul className=\"text-xs space-y-1 mt-2 text-gray-300\">\r\n                                    <li className=\"flex items-start gap-2\">\r\n                                        <span className=\"text-green-400\">‚úì</span>\r\n                                        <span>Residente fuera del horario formativo (ej: 16:00, 20:00)</span>\r\n                                    </li>\r\n                                    <li className=\"flex items-start gap-2\">\r\n                                        <span className=\"text-green-400\">‚úì</span>\r\n                                        <span>Residente en <strong>Domingo</strong> (cualquier hora)</span>\r\n                                    </li>\r\n                                    <li className=\"flex items-start gap-2\">\r\n                                        <span className=\"text-green-400\">‚úì</span>\r\n                                        <span>M√©dico de <strong>Planta</strong> (no residente) - siempre se paga</span>\r\n                                    </li>\r\n                                </ul>\r\n                            </div>\r\n\r\n                            <div className=\"p-3 bg-white/5 rounded-lg border border-white/5\">\r\n                                <div className=\"text-xs text-gray-500 uppercase tracking-wider mb-1\">üìä Ejemplos de Horarios</div>\r\n                                <div className=\"text-xs space-y-1 mt-2\">\r\n                                    <div className=\"flex justify-between\">\r\n                                        <span className=\"text-gray-300\">07:00 (Residente, L-S)</span>\r\n                                        <span className=\"text-red-400\">$0</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between\">\r\n                                        <span className=\"text-gray-300\">14:59 (Residente, L-S)</span>\r\n                                        <span className=\"text-red-400\">$0</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between\">\r\n                                        <span className=\"text-gray-300\">15:00 (Residente, L-S)</span>\r\n                                        <span className=\"text-green-400\">Se paga</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between\">\r\n                                        <span className=\"text-gray-300\">10:00 (Residente, Domingo)</span>\r\n                                        <span className=\"text-green-400\">Se paga</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between\">\r\n                                        <span className=\"text-gray-300\">10:00 (Planta, cualquier d√≠a)</span>\r\n                                        <span className=\"text-green-400\">Se paga</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n            </div>\r\n\r\n            {/* Modal de selecci√≥n de mes */}\r\n            <MesSelectorModal\r\n                isOpen={showMesSelector}\r\n                onClose={() => setShowMesSelector(false)}\r\n                onConfirm={handleMesConfirmado}\r\n                mesDetectado={mesDetectado}\r\n                anioDetectado={anioDetectado}\r\n                mesActual={new Date().getMonth() + 1}\r\n                anioActual={new Date().getFullYear()}\r\n            />\r\n\r\n            {/* Notificaci√≥n */}\r\n            <NotificationModal\r\n                isOpen={notification.isOpen}\r\n                onClose={() => setNotification(prev => ({ ...prev, isOpen: false }))}\r\n                type={notification.type}\r\n                title={notification.title}\r\n                message={notification.message}\r\n            />\r\n\r\n            {/* Indicador de guardado */}\r\n            {isGuardando && (\r\n                <div className=\"fixed bottom-4 right-4 p-4 rounded-lg bg-blue-500/20 border border-blue-500/50 text-blue-400\">\r\n                    Guardando datos en la base de datos...\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","import { supabase } from './supabase/client'\r\nimport { ExcelData, ExcelRow } from './excel-reader'\r\nimport { Medico, DetalleGuardiaInsert, LiquidacionGuardiaInsert, ValorConsultaObraSocial } from './types'\r\nimport { esResidenteHorarioFormativo, horaAMinutos } from './utils'\r\nimport { calcularNumeroLiquidacion } from './utils'\r\n\r\ninterface ProcesamientoResult {\r\n  liquidacionId: string\r\n  totalFilas: number\r\n  procesadas: number\r\n  errores: string[]\r\n  advertencias: string[]\r\n}\r\n\r\n/**\r\n * Normaliza el nombre de una columna para b√∫squeda flexible\r\n */\r\nfunction normalizarColumna(nombre: string): string {\r\n  return nombre\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '')\r\n    .trim()\r\n}\r\n\r\n/**\r\n * Busca un valor en una fila por variaciones del nombre de columna\r\n */\r\nfunction buscarValor(row: ExcelRow, variaciones: string[]): any {\r\n  const keys = Object.keys(row)\r\n  \r\n  // Si no hay keys, retornar null\r\n  if (keys.length === 0) return null\r\n  \r\n  // Buscar coincidencia exacta (case-insensitive)\r\n  for (const variacion of variaciones) {\r\n    for (const key of keys) {\r\n      if (key.toLowerCase().trim() === variacion.toLowerCase().trim()) {\r\n        const valor = row[key]\r\n        if (valor !== undefined && valor !== null) {\r\n          if (typeof valor === 'string' && valor.trim() !== '') return valor.trim()\r\n          if (typeof valor !== 'string') return valor\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Buscar coincidencia normalizada (sin acentos, espacios)\r\n  const normalizadas = variaciones.map(normalizarColumna)\r\n  for (const key of keys) {\r\n    const keyNormalizada = normalizarColumna(key)\r\n    if (normalizadas.includes(keyNormalizada)) {\r\n      const valor = row[key]\r\n      if (valor !== undefined && valor !== null) {\r\n        if (typeof valor === 'string' && valor.trim() !== '') return valor.trim()\r\n        if (typeof valor !== 'string') return valor\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Buscar coincidencia parcial (contiene palabras clave)\r\n  for (const variacion of variaciones) {\r\n    const palabras = normalizarColumna(variacion).split(/\\s+/).filter(p => p.length > 2)\r\n    if (palabras.length === 0) continue\r\n    \r\n    for (const key of keys) {\r\n      const keyNormalizada = normalizarColumna(key)\r\n      // Verificar que todas las palabras importantes est√©n presentes\r\n      const todasPalabrasPresentes = palabras.every(p => keyNormalizada.includes(p))\r\n      if (todasPalabrasPresentes) {\r\n        const valor = row[key]\r\n        if (valor !== undefined && valor !== null) {\r\n          if (typeof valor === 'string' && valor.trim() !== '') return valor.trim()\r\n          if (typeof valor !== 'string') return valor\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  return null\r\n}\r\n\r\n/**\r\n * Busca un m√©dico por nombre en la lista de m√©dicos\r\n */\r\n/**\r\n * Normaliza un nombre para b√∫squeda (sin acentos, min√∫sculas, sin espacios extra)\r\n */\r\nfunction normalizarNombre(nombre: string): string {\r\n  return nombre\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '')\r\n    .replace(/\\s+/g, ' ')\r\n    .trim()\r\n}\r\n\r\n/**\r\n * Busca un m√©dico por nombre en la lista de m√©dicos\r\n * B√∫squeda muy flexible con m√∫ltiples estrategias\r\n */\r\nfunction buscarMedico(nombre: string | null, medicos: Medico[]): Medico | null {\r\n  if (!nombre || typeof nombre !== 'string') return null\r\n  \r\n  const nombreNormalizado = normalizarNombre(nombre)\r\n  if (nombreNormalizado === '') return null\r\n  \r\n  // Estrategia 1: Coincidencia exacta (despu√©s de normalizar)\r\n  for (const medico of medicos) {\r\n    const medicoNombreNormalizado = normalizarNombre(medico.nombre)\r\n    if (medicoNombreNormalizado === nombreNormalizado) {\r\n      return medico\r\n    }\r\n  }\r\n  \r\n  // Estrategia 2: Coincidencia exacta sin considerar orden (si uno tiene coma y otro no)\r\n  // Ejemplo: \"Garc√≠a, Juan\" vs \"Juan Garc√≠a\"\r\n  const partesNombre = nombreNormalizado.split(',').map(p => p.trim())\r\n  const palabrasNombre = nombreNormalizado.split(/\\s+/).filter(p => p.length > 2)\r\n  \r\n  for (const medico of medicos) {\r\n    const medicoNombreNormalizado = normalizarNombre(medico.nombre)\r\n    const partesMedico = medicoNombreNormalizado.split(',').map(p => p.trim())\r\n    const palabrasMedico = medicoNombreNormalizado.split(/\\s+/).filter(p => p.length > 2)\r\n    \r\n    // Si ambos tienen las mismas palabras (sin importar orden)\r\n    if (palabrasNombre.length > 0 && palabrasMedico.length > 0) {\r\n      const palabrasNombreSet = new Set(palabrasNombre)\r\n      const palabrasMedicoSet = new Set(palabrasMedico)\r\n      \r\n      if (palabrasNombreSet.size === palabrasMedicoSet.size &&\r\n          Array.from(palabrasNombreSet).every(p => palabrasMedicoSet.has(p))) {\r\n        return medico\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Estrategia 3: Buscar por apellido (primera parte antes de la coma o primera palabra)\r\n  const apellidoNombre = partesNombre.length > 1 \r\n    ? partesNombre[0].trim()\r\n    : (palabrasNombre.length > 0 ? palabrasNombre[0] : nombreNormalizado)\r\n  \r\n  // Primero buscar coincidencia exacta de apellido\r\n  let mejorCoincidenciaApellido: Medico | null = null\r\n  let mejorPuntuacionApellido = 0\r\n  \r\n  for (const medico of medicos) {\r\n    const medicoNombreNormalizado = normalizarNombre(medico.nombre)\r\n    const partesMedico = medicoNombreNormalizado.split(',').map(p => p.trim())\r\n    const palabrasMedico = medicoNombreNormalizado.split(/\\s+/).filter(p => p.length > 2)\r\n    \r\n    const apellidoMedico = partesMedico.length > 1\r\n      ? partesMedico[0].trim()\r\n      : (palabrasMedico.length > 0 ? palabrasMedico[0] : medicoNombreNormalizado)\r\n    \r\n    // Coincidencia exacta de apellido (prioridad m√°xima)\r\n    if (apellidoNombre === apellidoMedico && apellidoNombre.length > 2) {\r\n      // Si hay coincidencia exacta, verificar si tambi√©n coinciden m√°s palabras\r\n      const palabrasCoincidentes = palabrasNombre.filter(p => \r\n        palabrasMedico.some(m => m === p || m.includes(p) || p.includes(m))\r\n      ).length\r\n      \r\n      if (palabrasCoincidentes > mejorPuntuacionApellido) {\r\n        mejorPuntuacionApellido = palabrasCoincidentes\r\n        mejorCoincidenciaApellido = medico\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Si encontramos coincidencia exacta de apellido con buena puntuaci√≥n, retornarla\r\n  if (mejorCoincidenciaApellido && mejorPuntuacionApellido > 0) {\r\n    return mejorCoincidenciaApellido\r\n  }\r\n  \r\n  // Si no, buscar coincidencia parcial de apellido\r\n  for (const medico of medicos) {\r\n    const medicoNombreNormalizado = normalizarNombre(medico.nombre)\r\n    const partesMedico = medicoNombreNormalizado.split(',').map(p => p.trim())\r\n    const palabrasMedico = medicoNombreNormalizado.split(/\\s+/).filter(p => p.length > 2)\r\n    \r\n    const apellidoMedico = partesMedico.length > 1\r\n      ? partesMedico[0].trim()\r\n      : (palabrasMedico.length > 0 ? palabrasMedico[0] : medicoNombreNormalizado)\r\n    \r\n    // Coincidencia parcial de apellido (uno contiene al otro)\r\n    if (apellidoNombre.length > 2 && apellidoMedico.length > 2) {\r\n      if (apellidoNombre.includes(apellidoMedico) || apellidoMedico.includes(apellidoNombre)) {\r\n        // Verificar tambi√©n cu√°ntas palabras coinciden\r\n        const palabrasCoincidentes = palabrasNombre.filter(p => \r\n          palabrasMedico.some(m => m === p || m.includes(p) || p.includes(m))\r\n        ).length\r\n        \r\n        if (palabrasCoincidentes >= mejorPuntuacionApellido) {\r\n          mejorPuntuacionApellido = palabrasCoincidentes\r\n          mejorCoincidenciaApellido = medico\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  if (mejorCoincidenciaApellido) {\r\n    return mejorCoincidenciaApellido\r\n  }\r\n  \r\n  // Estrategia 4: Buscar por todas las palabras importantes (todas deben estar presentes)\r\n  if (palabrasNombre.length > 0) {\r\n    for (const medico of medicos) {\r\n      const medicoNombreNormalizado = normalizarNombre(medico.nombre)\r\n      const palabrasMedico = medicoNombreNormalizado.split(/\\s+/).filter(p => p.length > 2)\r\n      \r\n      // Si todas las palabras del nombre est√°n en el nombre del m√©dico\r\n      if (palabrasNombre.every(p => medicoNombreNormalizado.includes(p))) {\r\n        return medico\r\n      }\r\n      \r\n      // Si todas las palabras del m√©dico est√°n en el nombre\r\n      if (palabrasMedico.length > 0 && palabrasMedico.every(p => nombreNormalizado.includes(p))) {\r\n        return medico\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Estrategia 5: B√∫squeda por similitud (al menos 2 palabras coinciden)\r\n  if (palabrasNombre.length >= 2) {\r\n    let mejorCoincidencia: Medico | null = null\r\n    let mejorPuntuacion = 0\r\n    \r\n    for (const medico of medicos) {\r\n      const medicoNombreNormalizado = normalizarNombre(medico.nombre)\r\n      const palabrasMedico = medicoNombreNormalizado.split(/\\s+/).filter(p => p.length > 2)\r\n      \r\n      // Contar cu√°ntas palabras coinciden\r\n      const palabrasCoincidentes = palabrasNombre.filter(p => \r\n        palabrasMedico.some(m => m.includes(p) || p.includes(m))\r\n      ).length\r\n      \r\n      if (palabrasCoincidentes >= 2 && palabrasCoincidentes > mejorPuntuacion) {\r\n        mejorPuntuacion = palabrasCoincidentes\r\n        mejorCoincidencia = medico\r\n      }\r\n    }\r\n    \r\n    if (mejorCoincidencia) {\r\n      return mejorCoincidencia\r\n    }\r\n  }\r\n  \r\n  return null\r\n}\r\n\r\n/**\r\n * Convierte una fecha en m√∫ltiples formatos a ISO (YYYY-MM-DD)\r\n */\r\nfunction convertirFechaISO(fecha: string | null | undefined): string | null {\r\n  if (!fecha) return null\r\n  \r\n  const fechaStr = String(fecha).trim()\r\n  if (fechaStr === '') return null\r\n  \r\n  // Intentar formato DD/MM/YYYY\r\n  const matchDDMMYYYY = fechaStr.match(/(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})/)\r\n  if (matchDDMMYYYY) {\r\n    const dia = matchDDMMYYYY[1].padStart(2, '0')\r\n    const mes = matchDDMMYYYY[2].padStart(2, '0')\r\n    const anio = matchDDMMYYYY[3]\r\n    return `${anio}-${mes}-${dia}`\r\n  }\r\n  \r\n  // Intentar formato YYYY-MM-DD (ya est√° en ISO)\r\n  const matchISO = fechaStr.match(/(\\d{4})-(\\d{1,2})-(\\d{1,2})/)\r\n  if (matchISO) {\r\n    const anio = matchISO[1]\r\n    const mes = matchISO[2].padStart(2, '0')\r\n    const dia = matchISO[3].padStart(2, '0')\r\n    return `${anio}-${mes}-${dia}`\r\n  }\r\n  \r\n  // Intentar parsear como Date object\r\n  try {\r\n    const dateObj = new Date(fechaStr)\r\n    if (!isNaN(dateObj.getTime())) {\r\n      const year = dateObj.getFullYear()\r\n      const month = String(dateObj.getMonth() + 1).padStart(2, '0')\r\n      const day = String(dateObj.getDate()).padStart(2, '0')\r\n      return `${year}-${month}-${day}`\r\n    }\r\n  } catch {\r\n    // Ignorar error\r\n  }\r\n  \r\n  return null\r\n}\r\n\r\n/**\r\n * Convierte una hora a formato HH:MM:SS\r\n */\r\nfunction convertirHora(hora: any): string | null {\r\n  if (!hora) return null\r\n  \r\n  if (typeof hora === 'string') {\r\n    // Ya es string, verificar formato\r\n    const match = hora.match(/(\\d{1,2}):(\\d{2})(?::(\\d{2}))?/)\r\n    if (match) {\r\n      const h = match[1].padStart(2, '0')\r\n      const m = match[2].padStart(2, '0')\r\n      const s = match[3] || '00'\r\n      return `${h}:${m}:${s}`\r\n    }\r\n  } else if (typeof hora === 'number') {\r\n    // Es un n√∫mero (serial de Excel), convertir a tiempo\r\n    const totalSegundos = Math.round(hora * 86400) // Excel almacena d√≠as como fracci√≥n\r\n    const horas = Math.floor(totalSegundos / 3600)\r\n    const minutos = Math.floor((totalSegundos % 3600) / 60)\r\n    const segundos = totalSegundos % 60\r\n    return `${String(horas).padStart(2, '0')}:${String(minutos).padStart(2, '0')}:${String(segundos).padStart(2, '0')}`\r\n  }\r\n  \r\n  return null\r\n}\r\n\r\n/**\r\n * Procesa un Excel de ginecolog√≠a y lo guarda en la base de datos\r\n */\r\nexport async function procesarExcelGinecologia(\r\n  excelData: ExcelData,\r\n  mes: number,\r\n  anio: number,\r\n  archivoNombre: string\r\n): Promise<ProcesamientoResult> {\r\n  const resultado: ProcesamientoResult = {\r\n    liquidacionId: '',\r\n    totalFilas: 0,\r\n    procesadas: 0,\r\n    errores: [],\r\n    advertencias: []\r\n  }\r\n\r\n  try {\r\n    // 1. Cargar TODOS los m√©dicos de ginecolog√≠a (activos e inactivos)\r\n    const { data: medicosData, error: errorMedicos } = await supabase\r\n      .from('medicos')\r\n      .select('*')\r\n      .eq('especialidad', 'Ginecolog√≠a') as { data: Medico[] | null; error: any }\r\n\r\n    if (errorMedicos) {\r\n      resultado.errores.push(`Error cargando m√©dicos: ${errorMedicos.message}`)\r\n      return resultado\r\n    }\r\n\r\n    const medicos = medicosData || []\r\n    \r\n    // Log para debugging: mostrar cantidad de m√©dicos cargados\r\n    console.log(`[Ginecolog√≠a] M√©dicos cargados: ${medicos.length}`)\r\n    console.log(`[Ginecolog√≠a] Residentes: ${medicos.filter(m => m.matricula_provincial === null).length}`)\r\n    console.log(`[Ginecolog√≠a] No residentes: ${medicos.filter(m => m.matricula_provincial !== null).length}`)\r\n    console.log(`[Ginecolog√≠a] Nombres de m√©dicos:`, medicos.map(m => `${m.nombre} (${m.matricula_provincial === null ? 'RESIDENTE' : 'NO RESIDENTE'})`).slice(0, 10))\r\n\r\n    // 2. Cargar valores de consultas ginecol√≥gicas\r\n    const { data: valoresData } = await supabase\r\n      .from('valores_consultas_obra_social')\r\n      .select('*')\r\n      .eq('tipo_consulta', 'CONSULTA GINECOLOGICA')\r\n      .eq('mes', mes)\r\n      .eq('anio', anio) as { data: ValorConsultaObraSocial[] | null }\r\n\r\n    const valoresConsultas = valoresData || []\r\n    const valoresPorObraSocial = new Map<string, number>()\r\n    valoresConsultas.forEach(v => {\r\n      valoresPorObraSocial.set(v.obra_social, v.valor)\r\n    })\r\n\r\n    // 3. Crear o obtener liquidaci√≥n\r\n    const numeroLiquidacion = calcularNumeroLiquidacion(mes, anio)\r\n    \r\n    // Verificar si ya existe\r\n    const { data: liquidacionExistente } = await supabase\r\n      .from('liquidaciones_guardia')\r\n      .select('id')\r\n      .eq('especialidad', 'Ginecolog√≠a')\r\n      .eq('mes', mes)\r\n      .eq('anio', anio)\r\n      .single()\r\n\r\n    let liquidacionId: string\r\n\r\n    if (liquidacionExistente && (liquidacionExistente as any).id) {\r\n      // Ya existe, usar la existente\r\n      liquidacionId = (liquidacionExistente as any).id\r\n      \r\n      // Eliminar detalles existentes\r\n      await supabase\r\n        .from('detalle_guardia')\r\n        .delete()\r\n        .eq('liquidacion_id', liquidacionId)\r\n    } else {\r\n      // Crear nueva liquidaci√≥n\r\n      const nuevaLiquidacion: LiquidacionGuardiaInsert = {\r\n        mes,\r\n        anio,\r\n        especialidad: 'Ginecolog√≠a',\r\n        estado: 'borrador',\r\n        total_consultas: 0,\r\n        total_bruto: 0,\r\n        total_retenciones: 0,\r\n        total_adicionales: 0,\r\n        total_neto: 0,\r\n        archivo_nombre: archivoNombre,\r\n        numero_liquidacion: numeroLiquidacion\r\n      }\r\n\r\n      const { data: liquidacionCreada, error: errorLiquidacion } = await supabase\r\n        .from('liquidaciones_guardia')\r\n        // @ts-ignore - La tabla no est√° en los tipos generados de Supabase a√∫n\r\n        .insert(nuevaLiquidacion)\r\n        .select('id')\r\n        .single()\r\n\r\n      if (errorLiquidacion) {\r\n        resultado.errores.push(`Error creando liquidaci√≥n: ${errorLiquidacion.message || 'Error desconocido'}. Detalles: ${JSON.stringify(errorLiquidacion)}`)\r\n        console.error('Error creando liquidaci√≥n:', errorLiquidacion)\r\n        return resultado\r\n      }\r\n\r\n      if (!liquidacionCreada || !(liquidacionCreada as any).id) {\r\n        resultado.errores.push(`Error: No se pudo crear la liquidaci√≥n. Respuesta: ${JSON.stringify(liquidacionCreada)}`)\r\n        console.error('Liquidaci√≥n no creada:', liquidacionCreada)\r\n        return resultado\r\n      }\r\n\r\n      liquidacionId = (liquidacionCreada as any).id\r\n    }\r\n\r\n    resultado.liquidacionId = liquidacionId\r\n\r\n    // 4. Extraer todos los nombres √∫nicos de \"Responsable\" del Excel\r\n    const nombresUnicos = new Set<string>()\r\n    const nombresOriginales = new Map<string, string>() // nombre normalizado -> nombre original\r\n    \r\n    console.log(`Extrayendo nombres √∫nicos de ${excelData.rows.length} filas del Excel`)\r\n    \r\n    for (const row of excelData.rows) {\r\n      const medicoNombre = buscarValor(row, [\r\n        'Responsable', 'responsable', 'RESPONSABLE',\r\n        'M√©dico', 'medico', 'MEDICO', 'Medico',\r\n        'Profesional', 'profesional', 'PROFESIONAL',\r\n        'M√©dico responsable', 'M√©dico Responsable', 'Medico Responsable',\r\n        'M√âDICO RESPONSABLE'\r\n      ])\r\n      \r\n      if (medicoNombre && typeof medicoNombre === 'string' && medicoNombre.trim() !== '') {\r\n        const nombreNormalizado = normalizarNombre(medicoNombre.trim())\r\n        if (nombreNormalizado !== '') {\r\n          nombresUnicos.add(nombreNormalizado)\r\n          // Guardar el nombre original (el primero que encontramos)\r\n          if (!nombresOriginales.has(nombreNormalizado)) {\r\n            nombresOriginales.set(nombreNormalizado, medicoNombre.trim())\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    console.log(`[Mapeo] Nombres √∫nicos encontrados en Excel: ${nombresUnicos.size}`)\r\n    console.log(`[Mapeo] Nombres √∫nicos:`, Array.from(nombresUnicos).slice(0, 10))\r\n    \r\n    // 5. Buscar cada nombre √∫nico en la BD y crear mapa\r\n    const mapaNombresMedicos = new Map<string, Medico>() // nombre normalizado -> m√©dico\r\n    \r\n    for (const nombreNormalizado of nombresUnicos) {\r\n      const medico = buscarMedico(nombresOriginales.get(nombreNormalizado) || nombreNormalizado, medicos)\r\n      if (medico) {\r\n        mapaNombresMedicos.set(nombreNormalizado, medico)\r\n      }\r\n    }\r\n    \r\n    // Logging detallado del mapeo\r\n    const nombresEncontrados = Array.from(mapaNombresMedicos.keys())\r\n    const nombresNoEncontrados = Array.from(nombresUnicos).filter(n => !mapaNombresMedicos.has(n))\r\n    \r\n    console.log(`[Mapeo] M√©dicos encontrados: ${nombresEncontrados.length}/${nombresUnicos.size}`)\r\n    console.log(`[Mapeo] M√©dicos NO encontrados: ${nombresNoEncontrados.length}`)\r\n    \r\n    if (nombresEncontrados.length > 0) {\r\n      console.log(`[Mapeo] M√©dicos encontrados:`)\r\n      nombresEncontrados.forEach(nombreNorm => {\r\n        const medico = mapaNombresMedicos.get(nombreNorm)!\r\n        const nombreOriginal = nombresOriginales.get(nombreNorm) || nombreNorm\r\n        console.log(`  - \"${nombreOriginal}\" -> \"${medico.nombre}\" (${medico.matricula_provincial === null ? 'RESIDENTE' : 'NO RESIDENTE'})`)\r\n      })\r\n    }\r\n    \r\n    if (nombresNoEncontrados.length > 0) {\r\n      console.log(`[Mapeo] M√©dicos NO encontrados:`)\r\n      nombresNoEncontrados.forEach(nombreNorm => {\r\n        const nombreOriginal = nombresOriginales.get(nombreNorm) || nombreNorm\r\n        console.log(`  - \"${nombreOriginal}\" (normalizado: \"${nombreNorm}\")`)\r\n      })\r\n      resultado.advertencias.push(`M√©dicos no encontrados en BD (${nombresNoEncontrados.length}): ${nombresNoEncontrados.slice(0, 5).map(n => nombresOriginales.get(n) || n).join(', ')}${nombresNoEncontrados.length > 5 ? '...' : ''}`)\r\n    }\r\n    \r\n    // 6. Procesar cada fila del Excel usando el mapa\r\n    const detalles: DetalleGuardiaInsert[] = []\r\n    resultado.totalFilas = excelData.rows.length\r\n\r\n    if (excelData.rows.length === 0) {\r\n      resultado.errores.push('El Excel no contiene filas de datos')\r\n      return resultado\r\n    }\r\n\r\n    console.log(`Procesando ${excelData.rows.length} filas del Excel`)\r\n    console.log('Headers disponibles:', excelData.headers)\r\n\r\n    // Contadores para debugging\r\n    let filasSinFecha = 0\r\n    let filasFechaInvalida = 0\r\n    let filasProcesadas = 0\r\n\r\n    for (let i = 0; i < excelData.rows.length; i++) {\r\n      const row = excelData.rows[i]\r\n      \r\n      try {\r\n        // Extraer datos de la fila - AUMENTAR VARIACIONES DE B√öSQUEDA\r\n        const fechaStr = buscarValor(row, [\r\n          'Fecha', 'fecha', 'FECHA', \r\n          'Fecha visita', 'Fecha Visita', 'Fecha de visita',\r\n          'Fecha de Visita', 'Fecha De Visita',\r\n          'Fecha de atenci√≥n', 'Fecha Atenci√≥n', 'Fecha de Atenci√≥n',\r\n          'Fecha de la consulta', 'Fecha Consulta', 'Fecha de Consulta',\r\n          'FECHA VISITA', 'FECHA DE VISITA',\r\n          'Fecha Visita', 'Fecha visita'\r\n        ])\r\n        const hora = buscarValor(row, [\r\n          'Hora', 'hora', 'HORA', \r\n          'Horario', 'horario', 'HORARIO',\r\n          'Hora inicio', 'Hora Inicio', 'Hora de inicio',\r\n          'Hora de Inicio', 'HORA INICIO'\r\n        ])\r\n        const paciente = buscarValor(row, [\r\n          'Paciente', 'paciente', 'PACIENTE', \r\n          'Nombre paciente', 'Nombre Paciente', 'Nombre del paciente',\r\n          'NOMBRE PACIENTE'\r\n        ])\r\n        const obraSocial = buscarValor(row, [\r\n          'Obra Social', 'obra social', 'Obra social', \r\n          'ObraSocial', 'Cliente', 'Obra', \r\n          'Obra Social / Cliente', 'Obra Social/Cliente',\r\n          'OBRA SOCIAL', 'CLIENTE'\r\n        ])\r\n        const medicoNombre = buscarValor(row, [\r\n          'Responsable', 'responsable', 'RESPONSABLE',\r\n          'M√©dico', 'medico', 'MEDICO', 'Medico',\r\n          'Profesional', 'profesional', 'PROFESIONAL',\r\n          'M√©dico responsable', 'M√©dico Responsable', 'Medico Responsable',\r\n          'M√âDICO RESPONSABLE'\r\n        ])\r\n        \r\n        // MEJORAR: Intentar m√∫ltiples formatos de fecha\r\n        let fecha: string | null = null\r\n        \r\n        if (fechaStr) {\r\n          // Intentar formato DD/MM/YYYY\r\n          fecha = convertirFechaISO(fechaStr)\r\n          \r\n          // Si falla, intentar otros formatos\r\n          if (!fecha) {\r\n            // Intentar formato YYYY-MM-DD\r\n            const matchISO = String(fechaStr).match(/(\\d{4})-(\\d{1,2})-(\\d{1,2})/)\r\n            if (matchISO) {\r\n              fecha = fechaStr // Ya est√° en formato ISO\r\n            } else {\r\n              // Intentar parsear como Date object\r\n              try {\r\n                const dateObj = new Date(fechaStr)\r\n                if (!isNaN(dateObj.getTime())) {\r\n                  const year = dateObj.getFullYear()\r\n                  const month = String(dateObj.getMonth() + 1).padStart(2, '0')\r\n                  const day = String(dateObj.getDate()).padStart(2, '0')\r\n                  fecha = `${year}-${month}-${day}`\r\n                }\r\n              } catch {\r\n                // Ignorar error\r\n              }\r\n            }\r\n          }\r\n        }\r\n        \r\n        // Validar datos m√≠nimos - PERMITIR FILAS SIN FECHA PERO REGISTRAR ADVERTENCIA\r\n        if (!fecha) {\r\n          filasSinFecha++\r\n          resultado.advertencias.push(`Fila ${i + 1}: Sin fecha v√°lida (${fechaStr || 'vac√≠a'}), se omite`)\r\n          continue\r\n        }\r\n\r\n        // Validar que la fecha sea razonable (entre 2020 y 2100)\r\n        const fechaAnio = parseInt(fecha.split('-')[0])\r\n        if (fechaAnio < 2020 || fechaAnio > 2100) {\r\n          filasFechaInvalida++\r\n          resultado.advertencias.push(`Fila ${i + 1}: Fecha fuera de rango (${fecha}), se omite`)\r\n          continue\r\n        }\r\n\r\n        // Buscar m√©dico en el mapa (ya pre-calculado)\r\n        let medico: Medico | null = null\r\n        if (medicoNombre && typeof medicoNombre === 'string' && medicoNombre.trim() !== '') {\r\n          const nombreNormalizado = normalizarNombre(medicoNombre.trim())\r\n          medico = mapaNombresMedicos.get(nombreNormalizado) || null\r\n        }\r\n        \r\n        // Determinar si es residente: matricula_provincial IS NULL = residente\r\n        const esResidente = medico ? (medico.matricula_provincial === null) : false\r\n\r\n        // Si no se encuentra el m√©dico, registrar advertencia pero continuar (solo una vez por nombre √∫nico)\r\n        if (!medico && medicoNombre) {\r\n          // Solo registrar advertencia si es la primera vez que vemos este nombre\r\n          const nombreNormalizado = normalizarNombre(medicoNombre.trim())\r\n          if (!mapaNombresMedicos.has(nombreNormalizado)) {\r\n            // Ya se registr√≥ en el mapeo inicial, no duplicar\r\n          }\r\n        }\r\n\r\n        // Obtener valor de consulta\r\n        // NO asignar 'PARTICULARES' autom√°ticamente - el usuario debe editarlo manualmente\r\n        const obraSocialFinal = obraSocial || null // Dejar null si no hay obra social\r\n        const valorUnitario = obraSocialFinal ? (valoresPorObraSocial.get(obraSocialFinal) || 0) : 0\r\n\r\n        // Si no hay valor para la obra social, registrar advertencia (solo si hay obra social)\r\n        if (obraSocialFinal && valorUnitario === 0) {\r\n          resultado.advertencias.push(`Fila ${i + 1}: No hay valor configurado para obra social: ${obraSocialFinal}`)\r\n        }\r\n\r\n        // Aplicar regla de residentes\r\n        const horaFormato = convertirHora(hora)\r\n        const esHorarioFormativo = esResidenteHorarioFormativo(fecha, horaFormato, esResidente)\r\n        \r\n        let montoFacturado = valorUnitario\r\n        let importeCalculado = valorUnitario\r\n\r\n        if (esHorarioFormativo) {\r\n          // Residente en horario formativo: no se paga\r\n          montoFacturado = 0\r\n          importeCalculado = 0\r\n        }\r\n\r\n        // Crear detalle\r\n        const detalle: DetalleGuardiaInsert = {\r\n          liquidacion_id: liquidacionId,\r\n          medico_id: medico?.id || null,\r\n          fecha,\r\n          hora: horaFormato,\r\n          paciente: paciente || null,\r\n          obra_social: obraSocialFinal, // Puede ser null si no hay obra social\r\n          medico_nombre: medicoNombre || medico?.nombre || 'Desconocido',\r\n          medico_matricula: medico?.matricula_provincial || null,\r\n          medico_es_residente: esResidente,\r\n          monto_facturado: montoFacturado,\r\n          porcentaje_retencion: null, // Ginecolog√≠a no tiene retenci√≥n del 30%\r\n          monto_retencion: null,\r\n          monto_adicional: 0,\r\n          importe_calculado: importeCalculado,\r\n          aplica_adicional: false,\r\n          es_horario_formativo: esHorarioFormativo,\r\n          estado_revision: 'pendiente',\r\n          fila_excel: i + 1\r\n        }\r\n\r\n        detalles.push(detalle)\r\n        filasProcesadas++\r\n        resultado.procesadas++\r\n\r\n      } catch (error: any) {\r\n        const errorMsg = error.message || 'Error desconocido'\r\n        resultado.errores.push(`Fila ${i + 1}: ${errorMsg}`)\r\n        console.error(`Error procesando fila ${i + 1}:`, error)\r\n        console.error('Datos de la fila:', row)\r\n      }\r\n    }\r\n\r\n    // Agregar resumen de advertencias al final\r\n    console.log(`Resumen: ${filasProcesadas} procesadas, ${filasSinFecha} sin fecha, ${filasFechaInvalida} fecha inv√°lida`)\r\n    if (filasSinFecha > 0 || filasFechaInvalida > 0) {\r\n      resultado.advertencias.push(`Total omitidas: ${filasSinFecha + filasFechaInvalida} (${filasSinFecha} sin fecha, ${filasFechaInvalida} fecha inv√°lida)`)\r\n    }\r\n\r\n    // 5. Guardar detalles en la base de datos\r\n    if (detalles.length === 0) {\r\n      resultado.errores.push('No se proces√≥ ninguna fila v√°lida. Verifique que el Excel tenga fechas v√°lidas.')\r\n      return resultado\r\n    }\r\n\r\n    console.log(`Guardando ${detalles.length} detalles en la base de datos`)\r\n    \r\n    // Insertar en lotes de 100 para evitar problemas de tama√±o\r\n    const batchSize = 100\r\n    for (let i = 0; i < detalles.length; i += batchSize) {\r\n      const batch = detalles.slice(i, i + batchSize)\r\n      const { error: errorDetalles } = await supabase\r\n        .from('detalle_guardia')\r\n        // @ts-ignore - La tabla no est√° en los tipos generados de Supabase a√∫n\r\n        .insert(batch)\r\n\r\n      if (errorDetalles) {\r\n        resultado.errores.push(`Error guardando detalles (lote ${Math.floor(i / batchSize) + 1}): ${errorDetalles.message}. Detalles: ${JSON.stringify(errorDetalles)}`)\r\n        console.error('Error guardando detalles:', errorDetalles)\r\n        console.error('Primer detalle del lote:', batch[0])\r\n        return resultado\r\n      }\r\n    }\r\n\r\n    // 6. Actualizar totales de la liquidaci√≥n\r\n    const totalConsultas = detalles.length\r\n    const totalBruto = detalles.reduce((sum, d) => sum + (d.monto_facturado || 0), 0)\r\n    const totalNeto = detalles.reduce((sum, d) => sum + (d.importe_calculado || 0), 0)\r\n\r\n    const { error: errorUpdate } = await supabase\r\n      .from('liquidaciones_guardia')\r\n      // @ts-ignore - La tabla no est√° en los tipos generados de Supabase a√∫n\r\n      .update({\r\n        total_consultas: totalConsultas,\r\n        total_bruto: totalBruto,\r\n        total_neto: totalNeto,\r\n        estado: 'pendiente_revision' // Estado inicial: pendiente de revisi√≥n\r\n      })\r\n      .eq('id', liquidacionId)\r\n\r\n    if (errorUpdate) {\r\n      resultado.errores.push(`Error actualizando totales: ${errorUpdate.message}`)\r\n    }\r\n\r\n  } catch (error: any) {\r\n    resultado.errores.push(`Error general: ${error.message || 'Error desconocido'}`)\r\n  }\r\n\r\n  return resultado\r\n}\r\n\r\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z',\n      key: '1c8476',\n    },\n  ],\n  ['path', { d: 'M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7', key: '1ydtos' }],\n  ['path', { d: 'M7 3v4a1 1 0 0 0 1 1h7', key: 't51u73' }],\n];\n\n/**\n * @component @name Save\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTUuMiAzYTIgMiAwIDAgMSAxLjQuNmwzLjggMy44YTIgMiAwIDAgMSAuNiAxLjRWMTlhMiAyIDAgMCAxLTIgMkg1YTIgMiAwIDAgMS0yLTJWNWEyIDIgMCAwIDEgMi0yeiIgLz4KICA8cGF0aCBkPSJNMTcgMjF2LTdhMSAxIDAgMCAwLTEtMUg4YTEgMSAwIDAgMC0xIDF2NyIgLz4KICA8cGF0aCBkPSJNNyAzdjRhMSAxIDAgMCAwIDEgMWg3IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/save\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Save = createLucideIcon('save', __iconNode);\n\nexport default Save;\n"],"names":[],"mappings":"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","ignoreList":[4]}