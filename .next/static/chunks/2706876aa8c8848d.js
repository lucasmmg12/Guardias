(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,74841,e=>{"use strict";var a=e.i(9964),r=e.i(87312),t=e.i(7735),s=e.i(8674),l=e.i(87914),i=e.i(80694),o=e.i(83643),n=e.i(68499);let c=[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiembre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}];function d({isOpen:e,onClose:t,onConfirm:s,mesDetectado:l,anioDetectado:i,mesActual:d,anioActual:u}){let[x,m]=(0,r.useState)(l||d),[g,h]=(0,r.useState)(i||u);return((0,r.useEffect)(()=>{e&&(m(l||d),h(i||u))},[e,l,i,d,u]),e)?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:t}),(0,a.jsxs)("div",{className:"relative z-10 w-full max-w-md mx-4 rounded-2xl p-6",style:{background:"rgba(17, 24, 39, 0.95)",backdropFilter:"blur(20px)",border:"1px solid rgba(34, 197, 94, 0.3)",boxShadow:"0 8px 32px 0 rgba(34, 197, 94, 0.3)"},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-green-400",children:"Seleccionar Per√≠odo"}),(0,a.jsx)("button",{onClick:t,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors",children:(0,a.jsx)(n.X,{className:"h-5 w-5"})})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[l&&i&&(0,a.jsxs)("div",{className:"p-4 rounded-lg",style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)"},children:[(0,a.jsx)("p",{className:"text-sm text-green-400 mb-2",children:"‚úì Mes detectado autom√°ticamente"}),(0,a.jsxs)("p",{className:"text-sm text-gray-300",children:[c[l-1].label," ",i]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Mes"}),(0,a.jsx)("select",{value:x,onChange:e=>m(Number(e.target.value)),className:"w-full px-4 py-2 bg-gray-800 border border-green-500/50 rounded-lg text-white focus:border-green-400 focus:outline-none",children:c.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"A√±o"}),(0,a.jsx)("input",{type:"number",value:g,onChange:e=>h(Number(e.target.value)),min:2020,max:2100,className:"w-full px-4 py-2 bg-gray-800 border border-green-500/50 rounded-lg text-white focus:border-green-400 focus:outline-none"})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)(o.Button,{onClick:t,variant:"outline",className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-700",children:"Cancelar"}),(0,a.jsx)(o.Button,{onClick:()=>{s(x,g),t()},className:"flex-1 bg-green-600 hover:bg-green-500 text-white",children:"Confirmar"})]})]})]})]}):null}var u=e.i(23229),x=e.i(74786),m=e.i(41253);let g=(0,e.i(71434).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var h=e.i(58427),p=e.i(19029),f=e.i(95325);let b={borrador:"Borrador",procesando:"Procesando",pendiente_revision:"Pendiente de Revisi√≥n",revisado:"Revisado",listo_para_liquidar:"Listo para Liquidar",finalizada:"Finalizada",error:"Error"};function N({liquidacionId:e,liquidacion:t,onEstadoChange:s}){let[l,i]=(0,r.useState)([]),[n,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)({}),[N,v]=(0,r.useState)("idle"),[j,y]=(0,r.useState)(null),[w,S]=(0,r.useState)([]),E=(0,r.useRef)(null),$=(0,r.useRef)(new Map),_=(0,r.useRef)(!1),C=(0,r.useCallback)(async()=>{try{c(!0);let{data:a,error:r}=await x.supabase.from("detalle_guardia").select("*").eq("liquidacion_id",e).order("fecha",{ascending:!0}).order("hora",{ascending:!0});if(r)throw r;i(a||[])}catch(e){console.error("Error cargando detalles:",e)}finally{c(!1)}},[e]),O=(0,r.useCallback)(async()=>{try{let{data:e,error:a}=await x.supabase.from("valores_consultas_obra_social").select("obra_social").eq("tipo_consulta","CONSULTA GINECOLOGICA");if(a)throw a;let r=Array.from(new Set((e||[]).map(e=>e.obra_social).filter(Boolean)));S(r.sort())}catch(e){console.error("Error cargando obras sociales:",e)}},[]);(0,r.useEffect)(()=>{C(),O()},[C,O]);let R=(0,r.useCallback)(async(e=!1)=>{if(0===$.current.size)return void v("idle");!e&&E.current&&(clearTimeout(E.current),E.current=null),v("saving");let a=Array.from($.current.entries());try{let e=a.map(async([e,a])=>{let{error:r}=await x.supabase.from("detalle_guardia").update({...a,updated_at:new Date().toISOString()}).eq("id",e);if(r)throw r});await Promise.all(e),$.current.clear(),v("saved"),y(new Date),await C(),setTimeout(()=>{_.current||v("idle")},2e3)}catch(e){console.error("Error guardando cambios:",e),v("error"),setTimeout(()=>{!_.current&&$.current.size>0&&R(!0)},3e3)}},[C]),F=(0,r.useCallback)((e,a)=>{let r=$.current.get(e)||{};$.current.set(e,{...r,...a}),E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{R(!0)},500)},[R]);(0,r.useEffect)(()=>()=>{_.current=!0,E.current&&clearTimeout(E.current),$.current.size>0&&R(!0)},[R]),(0,r.useEffect)(()=>{let e=e=>{$.current.size>0&&(e.preventDefault(),e.returnValue="Tienes cambios sin guardar. ¬øEst√°s seguro de que quieres salir?",R(!0))};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[R]),(0,r.useEffect)(()=>{let e=setInterval(()=>{$.current.size>0&&R(!0)},1e4);return()=>clearInterval(e)},[R]);let q=(0,r.useCallback)(async(e,a)=>{i(r=>r.map(r=>r.id===e?{...r,obra_social:a}:r)),F(e,{obra_social:a})},[F]),M=(0,r.useCallback)(async e=>{if(t)try{let{error:a}=await x.supabase.from("liquidaciones_guardia").update({estado:e}).eq("id",t.id);if(a)throw a;s&&s(e)}catch(e){console.error("Error actualizando estado:",e)}},[t,s]),k=e=>e?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:2,maximumFractionDigits:2}).format(e):"$0.00";if(n)return(0,a.jsxs)("div",{className:"text-center py-12 text-gray-400",children:[(0,a.jsx)(f.Clock,{className:"h-8 w-8 mx-auto mb-4 animate-spin"}),"Cargando detalles..."]});if(0===l.length)return(0,a.jsx)("div",{className:"text-center py-12 text-gray-400",children:"No hay detalles para mostrar"});let A=l.filter(e=>!e.obra_social||""===e.obra_social.trim()).length;return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-xl bg-gray-800/50 border border-gray-700",children:[(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["saving"===N&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.Clock,{className:"h-4 w-4 text-yellow-400 animate-spin"}),(0,a.jsx)("span",{className:"text-sm text-yellow-400",children:"Guardando..."})]}),"saved"===N&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.CheckCircle2,{className:"h-4 w-4 text-green-400"}),(0,a.jsxs)("span",{className:"text-sm text-green-400",children:["Guardado ",j?`a las ${j.toLocaleTimeString("es-AR")}`:""]})]}),"error"===N&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.AlertCircle,{className:"h-4 w-4 text-red-400"}),(0,a.jsx)("span",{className:"text-sm text-red-400",children:"Error al guardar. Reintentando..."})]}),"idle"===N&&$.current.size>0&&(0,a.jsxs)("span",{className:"text-sm text-gray-400",children:[$.current.size," cambio(s) pendiente(s)"]})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[t&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{className:"text-sm text-gray-300",children:"Estado:"}),(0,a.jsx)("select",{value:t.estado,onChange:e=>M(e.target.value),className:"px-3 py-1 bg-gray-700 border border-gray-600 rounded text-white text-sm focus:border-green-400 focus:outline-none",children:Object.entries(b).map(([e,r])=>(0,a.jsx)("option",{value:e,children:r},e))})]}),$.current.size>0&&(0,a.jsxs)(o.Button,{onClick:()=>R(!0),size:"sm",className:"bg-green-600 hover:bg-green-500",children:[(0,a.jsx)(g,{className:"h-4 w-4 mr-2"}),"Guardar ahora"]})]})]}),A>0&&(0,a.jsx)("div",{className:"p-4 rounded-xl bg-yellow-500/20 border border-yellow-500/50",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-yellow-400",children:[(0,a.jsx)(h.AlertCircle,{className:"h-5 w-5"}),(0,a.jsxs)("span",{className:"font-semibold",children:[A," fila(s) sin obra social - Requiere revisi√≥n"]})]})}),(0,a.jsx)("div",{className:"overflow-x-auto rounded-xl border border-gray-700",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-800",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-green-400 sticky left-0 bg-gray-800 z-10",children:"Fecha"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-green-400",children:"Hora"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-green-400",children:"M√©dico"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-green-400",children:"Paciente"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-green-400",children:"Obra Social"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-sm font-semibold text-green-400",children:"Monto Facturado"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-sm font-semibold text-green-400",children:"Importe Calculado"}),(0,a.jsx)("th",{className:"px-4 py-3 text-center text-sm font-semibold text-green-400",children:"Horario Formativo"})]})}),(0,a.jsx)("tbody",{children:l.map(e=>{var r;let t=!e.obra_social||""===e.obra_social.trim();return(0,a.jsxs)("tr",{className:`border-b border-gray-800 hover:bg-gray-800/50 ${t?"bg-yellow-500/10":""}`,children:[(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-300 sticky left-0 bg-gray-900 z-10",children:(r=e.fecha)?new Date(r).toLocaleDateString("es-AR"):"-"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-300",children:e.hora||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-300",children:e.medico_nombre||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-300",children:e.paciente||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,a.jsx)(m.InlineEditCell,{value:e.obra_social||"",onSave:a=>q(e.id,"string"==typeof a?a||null:String(a)||null),className:t?"bg-yellow-500/20 border-yellow-500/50":"",columnName:"Obra Social"})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-300 text-right",children:k(e.monto_facturado)}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-300 text-right font-semibold",children:k(e.importe_calculado)}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:e.es_horario_formativo?(0,a.jsx)("span",{className:"text-yellow-400",children:"S√≠"}):(0,a.jsx)("span",{className:"text-gray-500",children:"No"})})]},e.id)})})]})})]})}var v=e.i(28661),j=e.i(97451);function y(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()}function w(e,a){let r=Object.keys(e);if(0===r.length)return null;for(let t of a)for(let a of r)if(a.toLowerCase().trim()===t.toLowerCase().trim()){let r=e[a];if(null!=r){if("string"==typeof r&&""!==r.trim())return r.trim();if("string"!=typeof r)return r}}let t=a.map(y);for(let a of r){let r=y(a);if(t.includes(r)){let r=e[a];if(null!=r){if("string"==typeof r&&""!==r.trim())return r.trim();if("string"!=typeof r)return r}}}for(let t of a){let a=y(t).split(/\s+/).filter(e=>e.length>2);if(0!==a.length)for(let t of r){let r=y(t);if(a.every(e=>r.includes(e))){let a=e[t];if(null!=a){if("string"==typeof a&&""!==a.trim())return a.trim();if("string"!=typeof a)return a}}}}return null}function S(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim()}async function E(e,a,r,t){let s={liquidacionId:"",totalFilas:0,procesadas:0,errores:[],advertencias:[]};try{let l,{data:i,error:o}=await x.supabase.from("medicos").select("*").eq("especialidad","Ginecolog√≠a");if(o)return s.errores.push(`Error cargando m\xe9dicos: ${o.message}`),s;let n=i||[];console.log(`[Ginecolog\xeda] M\xe9dicos cargados: ${n.length}`),console.log(`[Ginecolog\xeda] Residentes: ${n.filter(e=>null===e.matricula_provincial).length}`),console.log(`[Ginecolog\xeda] No residentes: ${n.filter(e=>null!==e.matricula_provincial).length}`),console.log(`[Ginecolog\xeda] Nombres de m\xe9dicos:`,n.map(e=>`${e.nombre} (${null===e.matricula_provincial?"RESIDENTE":"NO RESIDENTE"})`).slice(0,10));let{data:c}=await x.supabase.from("valores_consultas_obra_social").select("*").eq("tipo_consulta","CONSULTA GINECOLOGICA").eq("mes",a).eq("anio",r),d=new Map;(c||[]).forEach(e=>{d.set(e.obra_social,e.valor)});let u=(0,j.calcularNumeroLiquidacion)(a,r),{data:m}=await x.supabase.from("liquidaciones_guardia").select("id").eq("especialidad","Ginecolog√≠a").eq("mes",a).eq("anio",r).single();if(m&&m.id)l=m.id,await x.supabase.from("detalle_guardia").delete().eq("liquidacion_id",l);else{let{data:e,error:i}=await x.supabase.from("liquidaciones_guardia").insert({mes:a,anio:r,especialidad:"Ginecolog√≠a",estado:"borrador",total_consultas:0,total_bruto:0,total_retenciones:0,total_adicionales:0,total_neto:0,archivo_nombre:t,numero_liquidacion:u}).select("id").single();if(i)return s.errores.push(`Error creando liquidaci\xf3n: ${i.message||"Error desconocido"}. Detalles: ${JSON.stringify(i)}`),console.error("Error creando liquidaci√≥n:",i),s;if(!e||!e.id)return s.errores.push(`Error: No se pudo crear la liquidaci\xf3n. Respuesta: ${JSON.stringify(e)}`),console.error("Liquidaci√≥n no creada:",e),s;l=e.id}s.liquidacionId=l;let g=new Set,h=new Map;for(let a of(console.log(`Extrayendo nombres \xfanicos de ${e.rows.length} filas del Excel`),e.rows)){let e=w(a,["Responsable","responsable","RESPONSABLE","M√©dico","medico","MEDICO","Medico","Profesional","profesional","PROFESIONAL","M√©dico responsable","M√©dico Responsable","Medico Responsable","M√âDICO RESPONSABLE"]);if(e&&"string"==typeof e&&""!==e.trim()){let a=S(e.trim());""!==a&&(g.add(a),h.has(a)||h.set(a,e.trim()))}}console.log(`[Mapeo] Nombres \xfanicos encontrados en Excel: ${g.size}`),console.log(`[Mapeo] Nombres \xfanicos:`,Array.from(g).slice(0,10));let p=new Map;for(let e of g){let a=function(e,a){if(!e||"string"!=typeof e)return null;let r=S(e);if(""===r)return null;for(let e of a)if(S(e.nombre)===r)return e;let t=r.split(",").map(e=>e.trim()),s=r.split(/\s+/).filter(e=>e.length>2);for(let e of a){let a=S(e.nombre);a.split(",").map(e=>e.trim());let r=a.split(/\s+/).filter(e=>e.length>2);if(s.length>0&&r.length>0){let a=new Set(s),t=new Set(r);if(a.size===t.size&&Array.from(a).every(e=>t.has(e)))return e}}let l=t.length>1?t[0].trim():s.length>0?s[0]:r,i=null,o=0;for(let e of a){let a=S(e.nombre),r=a.split(",").map(e=>e.trim()),t=a.split(/\s+/).filter(e=>e.length>2);if(l===(r.length>1?r[0].trim():t.length>0?t[0]:a)&&l.length>2){let a=s.filter(e=>t.some(a=>a===e||a.includes(e)||e.includes(a))).length;a>o&&(o=a,i=e)}}if(i&&o>0)return i;for(let e of a){let a=S(e.nombre),r=a.split(",").map(e=>e.trim()),t=a.split(/\s+/).filter(e=>e.length>2),n=r.length>1?r[0].trim():t.length>0?t[0]:a;if(l.length>2&&n.length>2&&(l.includes(n)||n.includes(l))){let a=s.filter(e=>t.some(a=>a===e||a.includes(e)||e.includes(a))).length;a>=o&&(o=a,i=e)}}if(i)return i;if(s.length>0)for(let e of a){let a=S(e.nombre),t=a.split(/\s+/).filter(e=>e.length>2);if(s.every(e=>a.includes(e))||t.length>0&&t.every(e=>r.includes(e)))return e}if(s.length>=2){let e=null,r=0;for(let t of a){let a=S(t.nombre).split(/\s+/).filter(e=>e.length>2),l=s.filter(e=>a.some(a=>a.includes(e)||e.includes(a))).length;l>=2&&l>r&&(r=l,e=t)}if(e)return e}return null}(h.get(e)||e,n);a&&p.set(e,a)}let f=Array.from(p.keys()),b=Array.from(g).filter(e=>!p.has(e));console.log(`[Mapeo] M\xe9dicos encontrados: ${f.length}/${g.size}`),console.log(`[Mapeo] M\xe9dicos NO encontrados: ${b.length}`),f.length>0&&(console.log(`[Mapeo] M\xe9dicos encontrados:`),f.forEach(e=>{let a=p.get(e),r=h.get(e)||e;console.log(`  - "${r}" -> "${a.nombre}" (${null===a.matricula_provincial?"RESIDENTE":"NO RESIDENTE"})`)})),b.length>0&&(console.log(`[Mapeo] M\xe9dicos NO encontrados:`),b.forEach(e=>{let a=h.get(e)||e;console.log(`  - "${a}" (normalizado: "${e}")`)}),s.advertencias.push(`M\xe9dicos no encontrados en BD (${b.length}): ${b.slice(0,5).map(e=>h.get(e)||e).join(", ")}${b.length>5?"...":""}`));let N=[];if(s.totalFilas=e.rows.length,0===e.rows.length)return s.errores.push("El Excel no contiene filas de datos"),s;console.log(`Procesando ${e.rows.length} filas del Excel`),console.log("Headers disponibles:",e.headers);let v=0,y=0,E=0;for(let a=0;a<e.rows.length;a++){let r=e.rows[a];try{let e=w(r,["Fecha","fecha","FECHA","Fecha visita","Fecha Visita","Fecha de visita","Fecha de Visita","Fecha De Visita","Fecha de atenci√≥n","Fecha Atenci√≥n","Fecha de Atenci√≥n","Fecha de la consulta","Fecha Consulta","Fecha de Consulta","FECHA VISITA","FECHA DE VISITA","Fecha Visita","Fecha visita"]),t=w(r,["Hora","hora","HORA","Horario","horario","HORARIO","Hora inicio","Hora Inicio","Hora de inicio","Hora de Inicio","HORA INICIO"]),i=w(r,["Paciente","paciente","PACIENTE","Nombre paciente","Nombre Paciente","Nombre del paciente","NOMBRE PACIENTE"]),o=w(r,["Obra Social","obra social","Obra social","ObraSocial","Cliente","Obra","Obra Social / Cliente","Obra Social/Cliente","OBRA SOCIAL","CLIENTE"]),n=w(r,["Responsable","responsable","RESPONSABLE","M√©dico","medico","MEDICO","Medico","Profesional","profesional","PROFESIONAL","M√©dico responsable","M√©dico Responsable","Medico Responsable","M√âDICO RESPONSABLE"]),c=null;if(e&&!(c=function(e){if(!e)return null;let a=String(e).trim();if(""===a)return null;let r=a.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(r){let e=r[1].padStart(2,"0"),a=r[2].padStart(2,"0"),t=r[3];return`${t}-${a}-${e}`}let t=a.match(/(\d{4})-(\d{1,2})-(\d{1,2})/);if(t){let e=t[1],a=t[2].padStart(2,"0"),r=t[3].padStart(2,"0");return`${e}-${a}-${r}`}try{let e=new Date(a);if(!isNaN(e.getTime())){let a=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0");return`${a}-${r}-${t}`}}catch{}return null}(e)))if(String(e).match(/(\d{4})-(\d{1,2})-(\d{1,2})/))c=e;else try{let a=new Date(e);if(!isNaN(a.getTime())){let e=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,"0"),t=String(a.getDate()).padStart(2,"0");c=`${e}-${r}-${t}`}}catch{}if(!c){v++,s.advertencias.push(`Fila ${a+1}: Sin fecha v\xe1lida (${e||"vac√≠a"}), se omite`);continue}let u=parseInt(c.split("-")[0]);if(u<2020||u>2100){y++,s.advertencias.push(`Fila ${a+1}: Fecha fuera de rango (${c}), se omite`);continue}let x=null;if(n&&"string"==typeof n&&""!==n.trim()){let e=S(n.trim());x=p.get(e)||null}let m=!!x&&null===x.matricula_provincial;if(!x&&n){let e=S(n.trim());p.has(e)}let g=o||null,h=g&&d.get(g)||0;g&&0===h&&s.advertencias.push(`Fila ${a+1}: No hay valor configurado para obra social: ${g}`);let f=function(e){if(!e)return null;if("string"==typeof e){let a=e.match(/(\d{1,2}):(\d{2})(?::(\d{2}))?/);if(a){let e=a[1].padStart(2,"0"),r=a[2].padStart(2,"0"),t=a[3]||"00";return`${e}:${r}:${t}`}}else if("number"==typeof e){let a=Math.round(86400*e),r=Math.floor(a/3600),t=Math.floor(a%3600/60);return`${String(r).padStart(2,"0")}:${String(t).padStart(2,"0")}:${String(a%60).padStart(2,"0")}`}return null}(t),b=(0,j.esResidenteHorarioFormativo)(c,f,m),$=h,_=h;b&&($=0,_=0);let C={liquidacion_id:l,medico_id:x?.id||null,fecha:c,hora:f,paciente:i||null,obra_social:g,medico_nombre:n||x?.nombre||"Desconocido",medico_matricula:x?.matricula_provincial||null,medico_es_residente:m,monto_facturado:$,porcentaje_retencion:null,monto_retencion:null,monto_adicional:0,importe_calculado:_,aplica_adicional:!1,es_horario_formativo:b,estado_revision:"pendiente",fila_excel:a+1};N.push(C),E++,s.procesadas++}catch(t){let e=t.message||"Error desconocido";s.errores.push(`Fila ${a+1}: ${e}`),console.error(`Error procesando fila ${a+1}:`,t),console.error("Datos de la fila:",r)}}if(console.log(`Resumen: ${E} procesadas, ${v} sin fecha, ${y} fecha inv\xe1lida`),(v>0||y>0)&&s.advertencias.push(`Total omitidas: ${v+y} (${v} sin fecha, ${y} fecha inv\xe1lida)`),0===N.length)return s.errores.push("No se proces√≥ ninguna fila v√°lida. Verifique que el Excel tenga fechas v√°lidas."),s;console.log(`Guardando ${N.length} detalles en la base de datos`);for(let e=0;e<N.length;e+=100){let a=N.slice(e,e+100),{error:r}=await x.supabase.from("detalle_guardia").insert(a);if(r)return s.errores.push(`Error guardando detalles (lote ${Math.floor(e/100)+1}): ${r.message}. Detalles: ${JSON.stringify(r)}`),console.error("Error guardando detalles:",r),console.error("Primer detalle del lote:",a[0]),s}let $=N.length,_=N.reduce((e,a)=>e+(a.monto_facturado||0),0),C=N.reduce((e,a)=>e+(a.importe_calculado||0),0),{error:O}=await x.supabase.from("liquidaciones_guardia").update({total_consultas:$,total_bruto:_,total_neto:C,estado:"pendiente_revision"}).eq("id",l);O&&s.errores.push(`Error actualizando totales: ${O.message}`)}catch(e){s.errores.push(`Error general: ${e.message||"Error desconocido"}`)}return s}var $=e.i(27214),_=e.i(34754),C=e.i(44176);function O(){let e=(0,t.useRouter)(),[n,c]=(0,r.useState)(!1),[m,g]=(0,r.useState)(null),[p,f]=(0,r.useState)(null),[b,j]=(0,r.useState)(!1),[y,w]=(0,r.useState)(null),[S,O]=(0,r.useState)(null),[R,F]=(0,r.useState)(new Date().getMonth()+1),[q,M]=(0,r.useState)(new Date().getFullYear()),[k,A]=(0,r.useState)(null),[I,D]=(0,r.useState)(!1),[L,P]=(0,r.useState)(null),[T,z]=(0,r.useState)(!1),[G,H]=(0,r.useState)({isOpen:!1,type:"info",message:""});function B(e,a,r){H({isOpen:!0,type:e,message:a,title:r}),setTimeout(()=>{H(e=>({...e,isOpen:!1}))},5e3)}let V=async e=>{c(!0),g(null),f(null),w(null),O(null),A(e);try{let a=await (0,v.readExcelFile)(e);g(a);let{mes:r,anio:t}=(e=>{if(e.periodo?.desde){let a=e.periodo.desde.split("/");if(3===a.length){let e=parseInt(a[1],10),r=parseInt(a[2],10);if(e>=1&&e<=12&&r>=2020)return{mes:e,anio:r}}}let a=e.headers.find(e=>e.toLowerCase().includes("fecha")||e.toLowerCase().includes("date"));if(a&&e.rows.length>0){let r=[];if(e.rows.forEach(e=>{let t=e[a];if(t&&"string"==typeof t){let e=t.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(e){let a=parseInt(e[2],10),t=parseInt(e[3],10);a>=1&&a<=12&&t>=2020&&r.push(a)}}}),r.length>0){let t=r[0];if(r.every(e=>e===t)){let r=e.rows[0][a];if("string"==typeof r){let e=r.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(e)return{mes:t,anio:parseInt(e[3],10)}}}}}return{mes:null,anio:null}})(a);r&&t&&(w(r),O(t),F(r),M(t)),j(!0)}catch(e){console.error("Error processing file:",e),f(e.message||"Ocurri√≥ un error inesperado al procesar el archivo.")}finally{c(!1)}},U=async(e,a)=>{if(F(e),M(a),j(!1),m&&k){D(!0);try{let r=await E(m,e,a,k.name);if(r.errores.length>0){let e=r.errores.length>0?`Se procesaron ${r.procesadas} filas. Errores: ${r.errores.slice(0,3).join("; ")}${r.errores.length>3?"...":""}`:`Se procesaron ${r.procesadas} filas. Errores: ${r.errores.length}`;B("error",e,"Procesamiento con errores"),console.error("Errores completos:",r.errores)}else{if(r.liquidacionId){let{data:e}=await x.supabase.from("liquidaciones_guardia").select("*").eq("id",r.liquidacionId).single();e&&(P(e),z(!0))}r.advertencias.length>0?B("warning",`Se procesaron ${r.procesadas} de ${r.totalFilas} filas. ${r.advertencias.length} advertencias. Revisa los datos guardados.`,"Procesamiento completado"):B("success",`Se procesaron y guardaron ${r.procesadas} consultas. Revisa y edita los datos antes de liquidar.`,"Guardado exitoso")}}catch(e){console.error("Error guardando datos:",e),B("error",`Error al guardar: ${e.message||"Error desconocido"}`,"Error")}finally{D(!1)}}};(0,r.useEffect)(()=>{!async function(){try{let{data:e,error:a}=await x.supabase.from("liquidaciones_guardia").select("*").eq("especialidad","Ginecolog√≠a").in("estado",["pendiente_revision","revisado","listo_para_liquidar"]).order("created_at",{ascending:!1}).limit(1).single();if(a&&"PGRST116"!==a.code)return void console.error("Error cargando liquidaci√≥n:",a);e&&(P(e),z(!0),F(e.mes),M(e.anio))}catch(e){console.error("Error cargando liquidaci√≥n:",e)}}()},[]);let J=async(e,a,r)=>{console.log(`Actualizando fila ${e}, columna ${a} con valor:`,r)};return(0,a.jsxs)("div",{className:"min-h-screen relative p-8 pb-20 overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute top-20 left-20 w-96 h-96 bg-green-500/20 rounded-full blur-3xl animate-pulse"}),(0,a.jsx)("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-green-400/20 rounded-full blur-3xl animate-pulse delay-1000"}),(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8 relative z-10",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsxs)(o.Button,{onClick:()=>e.push("/"),variant:"outline",className:"border-green-500/50 text-green-400 hover:bg-green-500/20",children:[(0,a.jsx)(_.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Volver"]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsx)(C.default,{href:"/",className:"hover:opacity-80 transition-opacity",children:(0,a.jsx)("img",{src:"/logogrow.png",alt:"Grow Labs",className:"h-16 w-auto drop-shadow-2xl",style:{filter:"drop-shadow(0 0 20px rgba(34, 197, 94, 0.5))"}})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-4xl font-bold mb-2 tracking-tight",children:(0,a.jsx)("span",{className:"bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent",children:"M√≥dulo Ginecolog√≠a"})}),(0,a.jsxs)("p",{className:"text-gray-400 flex items-center gap-2",children:[(0,a.jsx)($.Sparkles,{className:"h-4 w-4 text-blue-400"}),"Procesamiento de liquidaciones por hora"]})]})]})})]}),(0,a.jsxs)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-2xl",style:{background:"linear-gradient(45deg, transparent, rgba(59, 130, 246, 0.3), transparent)",animation:"borderGlow 3s ease-in-out infinite"}}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-blue-400",children:"üì§ Cargar Liquidaci√≥n"}),(0,a.jsx)(o.Button,{onClick:()=>e.push("/ginecologia/resumenes"),variant:"outline",className:"border-blue-500/50 text-blue-400 hover:bg-blue-500/20",children:"Ver Res√∫menes"})]}),(0,a.jsx)(s.UploadExcel,{onUpload:V,isProcessing:n}),p&&(0,a.jsxs)("div",{className:"mt-6 bg-red-500/10 border border-red-500/30 rounded-lg p-4 flex items-start gap-3 text-red-400",children:[(0,a.jsx)(h.AlertCircle,{className:"w-5 h-5 mt-0.5 shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold",children:"Error de Procesamiento"}),(0,a.jsx)("p",{className:"text-sm opacity-90",children:p})]})]})]})]}),T&&L&&(0,a.jsx)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-blue-400",children:"üìä Detalles Guardados - Revisi√≥n y Edici√≥n"}),(0,a.jsx)(o.Button,{onClick:()=>{z(!1),P(null),g(null)},variant:"outline",className:"border-blue-500/50 text-blue-400 hover:bg-blue-500/20",children:"Cargar Nuevo Excel"})]}),(0,a.jsx)(N,{liquidacionId:L.id,liquidacion:L,onEstadoChange:e=>{P(a=>a?{...a,estado:e}:null)}})]})}),m&&!T&&(0,a.jsx)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-blue-400 mb-6",children:"üìä Vista Previa del Excel"}),(0,a.jsx)("p",{className:"text-gray-400 mb-4 text-sm",children:"Esta es una vista previa. Los datos se guardar√°n despu√©s de confirmar el mes y a√±o."}),(0,a.jsx)(l.ExcelDataTable,{data:m,especialidad:"Ginecolog√≠a",onCellUpdate:J})]})}),m&&m.periodo&&(()=>{let{mes:e,anio:r}={mes:R,anio:q};return(0,a.jsx)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:(0,a.jsx)(i.EstadisticasObraSocial,{mes:e,anio:r,especialidad:"Ginecolog√≠a"})})})(),(0,a.jsxs)("div",{className:"p-6 rounded-xl",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.2)"},children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-200 mb-4",children:"üìã Reglas Vigentes"}),(0,a.jsxs)("div",{className:"space-y-4 text-sm text-gray-300",children:[(0,a.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Pago por Hora"}),(0,a.jsx)("div",{className:"font-semibold text-white",children:"Seg√∫n Tarifa"}),(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Valor hora vigente por obra social"})]}),(0,a.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"üë®‚Äç‚öïÔ∏è Regla de Residentes en Horario Formativo"}),(0,a.jsxs)("div",{className:"text-sm mt-2 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-red-400 font-semibold",children:"NO SE PAGA"}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"si se cumplen todas las condiciones:"})]}),(0,a.jsxs)("ul",{className:"text-xs space-y-1 ml-2 text-gray-300",children:[(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-blue-400",children:"‚Ä¢"}),(0,a.jsxs)("span",{children:["M√©dico es ",(0,a.jsx)("strong",{children:"RESIDENTE"})," (verificado en BD)"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-blue-400",children:"‚Ä¢"}),(0,a.jsxs)("span",{children:["D√≠a: ",(0,a.jsx)("strong",{children:"Lunes a S√°bado"})," (no domingo)"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-blue-400",children:"‚Ä¢"}),(0,a.jsxs)("span",{children:["Horario: ",(0,a.jsx)("strong",{className:"text-blue-400",children:"07:00 a 15:00"})]})]}),(0,a.jsx)("li",{className:"text-xs text-gray-400 mt-1 ml-4",children:"(Incluye 07:00, excluye 15:00)"})]})]})]}),(0,a.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"‚úÖ Casos que S√ç se Pagan"}),(0,a.jsxs)("ul",{className:"text-xs space-y-1 mt-2 text-gray-300",children:[(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-green-400",children:"‚úì"}),(0,a.jsx)("span",{children:"Residente fuera del horario formativo (ej: 16:00, 20:00)"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-green-400",children:"‚úì"}),(0,a.jsxs)("span",{children:["Residente en ",(0,a.jsx)("strong",{children:"Domingo"})," (cualquier hora)"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-green-400",children:"‚úì"}),(0,a.jsxs)("span",{children:["M√©dico de ",(0,a.jsx)("strong",{children:"Planta"})," (no residente) - siempre se paga"]})]})]})]}),(0,a.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"üìä Ejemplos de Horarios"}),(0,a.jsxs)("div",{className:"text-xs space-y-1 mt-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-300",children:"07:00 (Residente, L-S)"}),(0,a.jsx)("span",{className:"text-red-400",children:"$0"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-300",children:"14:59 (Residente, L-S)"}),(0,a.jsx)("span",{className:"text-red-400",children:"$0"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-300",children:"15:00 (Residente, L-S)"}),(0,a.jsx)("span",{className:"text-green-400",children:"Se paga"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-300",children:"10:00 (Residente, Domingo)"}),(0,a.jsx)("span",{className:"text-green-400",children:"Se paga"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-300",children:"10:00 (Planta, cualquier d√≠a)"}),(0,a.jsx)("span",{className:"text-green-400",children:"Se paga"})]})]})]})]})]})]}),(0,a.jsx)(d,{isOpen:b,onClose:()=>j(!1),onConfirm:U,mesDetectado:y,anioDetectado:S,mesActual:new Date().getMonth()+1,anioActual:new Date().getFullYear()}),(0,a.jsx)(u.NotificationModal,{isOpen:G.isOpen,onClose:()=>H(e=>({...e,isOpen:!1})),type:G.type,title:G.title,message:G.message}),I&&(0,a.jsx)("div",{className:"fixed bottom-4 right-4 p-4 rounded-lg bg-blue-500/20 border border-blue-500/50 text-blue-400",children:"Guardando datos en la base de datos..."})]})}e.s(["default",()=>O],74841)}]);