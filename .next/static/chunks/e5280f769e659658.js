(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32600,(e,r,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},23229,e=>{"use strict";var r=e.i(9964),t=e.i(87312),a=e.i(71375),s=e.i(68499),l=e.i(58427);let n=(0,e.i(71434).default)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var i=e.i(60554),o=e.i(83643);function c({isOpen:e,onClose:c,title:d,message:u,type:h="info",duration:x=0}){return((0,t.useEffect)(()=>{if(e&&x>0){let e=setTimeout(()=>{c()},x);return()=>clearTimeout(e)}},[e,x,c]),e)?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"},onClick:c,children:(0,r.jsxs)("div",{className:"relative w-full max-w-md rounded-2xl p-6 shadow-2xl",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:`1px solid ${(()=>{switch(h){case"success":return"border-green-500/50";case"error":return"border-red-500/50";case"warning":return"border-yellow-500/50";default:return"border-blue-500/50"}})().replace("/50","/30")}`,boxShadow:"0 8px 32px 0 rgba(34, 197, 94, 0.3)",animation:"fadeIn 0.2s ease-in-out"},onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("button",{onClick:c,className:"absolute top-4 right-4 p-2 rounded-lg hover:bg-white/10 transition-colors text-gray-400 hover:text-white",children:(0,r.jsx)(s.X,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-1",children:(()=>{switch(h){case"success":return(0,r.jsx)(a.CheckCircle,{className:"h-6 w-6 text-green-400"});case"error":return(0,r.jsx)(l.AlertCircle,{className:"h-6 w-6 text-red-400"});case"warning":return(0,r.jsx)(i.AlertTriangle,{className:"h-6 w-6 text-yellow-400"});default:return(0,r.jsx)(n,{className:"h-6 w-6 text-blue-400"})}})()}),(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[d&&(0,r.jsx)("h3",{className:`text-lg font-semibold ${(()=>{switch(h){case"success":return"text-green-400";case"error":return"text-red-400";case"warning":return"text-yellow-400";default:return"text-blue-400"}})()}`,children:d}),(0,r.jsx)("p",{className:"text-gray-300 text-sm leading-relaxed",children:u})]})]}),(0,r.jsx)("div",{className:"mt-6 flex justify-end",children:(0,r.jsx)(o.Button,{onClick:c,className:`${"success"===h?"bg-green-600 hover:bg-green-500":"error"===h?"bg-red-600 hover:bg-red-500":"warning"===h?"bg-yellow-600 hover:bg-yellow-500":"bg-blue-600 hover:bg-blue-500"} text-white`,children:"Aceptar"})})]})}):null}e.s(["NotificationModal",()=>c],23229)},81377,(e,r,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={assign:function(){return o},searchParamsToUrlQuery:function(){return l},urlQueryToSearchParams:function(){return i}};for(var s in a)Object.defineProperty(t,s,{enumerable:!0,get:a[s]});function l(e){let r={};for(let[t,a]of e.entries()){let e=r[t];void 0===e?r[t]=a:Array.isArray(e)?e.push(a):r[t]=[e,a]}return r}function n(e){return"string"==typeof e?e:("number"!=typeof e||isNaN(e))&&"boolean"!=typeof e?"":String(e)}function i(e){let r=new URLSearchParams;for(let[t,a]of Object.entries(e))if(Array.isArray(a))for(let e of a)r.append(t,n(e));else r.set(t,n(a));return r}function o(e,...r){for(let t of r){for(let r of t.keys())e.delete(r);for(let[r,a]of t.entries())e.append(r,a)}return e}},58393,(e,r,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={formatUrl:function(){return i},formatWithValidation:function(){return c},urlObjectKeys:function(){return o}};for(var s in a)Object.defineProperty(t,s,{enumerable:!0,get:a[s]});let l=e.r(5691)._(e.r(81377)),n=/https?|ftp|gopher|file/;function i(e){let{auth:r,hostname:t}=e,a=e.protocol||"",s=e.pathname||"",i=e.hash||"",o=e.query||"",c=!1;r=r?encodeURIComponent(r).replace(/%3A/i,":")+"@":"",e.host?c=r+e.host:t&&(c=r+(~t.indexOf(":")?`[${t}]`:t),e.port&&(c+=":"+e.port)),o&&"object"==typeof o&&(o=String(l.urlQueryToSearchParams(o)));let d=e.search||o&&`?${o}`||"";return a&&!a.endsWith(":")&&(a+=":"),e.slashes||(!a||n.test(a))&&!1!==c?(c="//"+(c||""),s&&"/"!==s[0]&&(s="/"+s)):c||(c=""),i&&"#"!==i[0]&&(i="#"+i),d&&"?"!==d[0]&&(d="?"+d),s=s.replace(/[?#]/g,encodeURIComponent),d=d.replace("#","%23"),`${a}${c}${s}${d}${i}`}let o=["auth","hash","host","hostname","href","path","pathname","port","protocol","query","search","slashes"];function c(e){return i(e)}},17055,(e,r,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return s}});let a=e.r(87312);function s(e,r){let t=(0,a.useRef)(null),s=(0,a.useRef)(null);return(0,a.useCallback)(a=>{if(null===a){let e=t.current;e&&(t.current=null,e());let r=s.current;r&&(s.current=null,r())}else e&&(t.current=l(e,a)),r&&(s.current=l(r,a))},[e,r])}function l(e,r){if("function"!=typeof e)return e.current=r,()=>{e.current=null};{let t=e(r);return"function"==typeof t?t:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),r.exports=t.default)},41519,(e,r,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={DecodeError:function(){return g},MiddlewareNotFoundError:function(){return j},MissingStaticPage:function(){return v},NormalizeError:function(){return b},PageNotFoundError:function(){return y},SP:function(){return f},ST:function(){return p},WEB_VITALS:function(){return l},execOnce:function(){return n},getDisplayName:function(){return u},getLocationOrigin:function(){return c},getURL:function(){return d},isAbsoluteUrl:function(){return o},isResSent:function(){return h},loadGetInitialProps:function(){return m},normalizeRepeatedSlashes:function(){return x},stringifyError:function(){return w}};for(var s in a)Object.defineProperty(t,s,{enumerable:!0,get:a[s]});let l=["CLS","FCP","FID","INP","LCP","TTFB"];function n(e){let r,t=!1;return(...a)=>(t||(t=!0,r=e(...a)),r)}let i=/^[a-zA-Z][a-zA-Z\d+\-.]*?:/,o=e=>i.test(e);function c(){let{protocol:e,hostname:r,port:t}=window.location;return`${e}//${r}${t?":"+t:""}`}function d(){let{href:e}=window.location,r=c();return e.substring(r.length)}function u(e){return"string"==typeof e?e:e.displayName||e.name||"Unknown"}function h(e){return e.finished||e.headersSent}function x(e){let r=e.split("?");return r[0].replace(/\\/g,"/").replace(/\/\/+/g,"/")+(r[1]?`?${r.slice(1).join("?")}`:"")}async function m(e,r){let t=r.res||r.ctx&&r.ctx.res;if(!e.getInitialProps)return r.ctx&&r.Component?{pageProps:await m(r.Component,r.ctx)}:{};let a=await e.getInitialProps(r);if(t&&h(t))return a;if(!a)throw Object.defineProperty(Error(`"${u(e)}.getInitialProps()" should resolve to an object. But found "${a}" instead.`),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return a}let f="undefined"!=typeof performance,p=f&&["mark","measure","getEntriesByName"].every(e=>"function"==typeof performance[e]);class g extends Error{}class b extends Error{}class y extends Error{constructor(e){super(),this.code="ENOENT",this.name="PageNotFoundError",this.message=`Cannot find module for page: ${e}`}}class v extends Error{constructor(e,r){super(),this.message=`Failed to load static file for page: ${e} ${r}`}}class j extends Error{constructor(){super(),this.code="ENOENT",this.message="Cannot find the middleware module"}}function w(e){return JSON.stringify({message:e.message,stack:e.stack})}},63090,(e,r,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"isLocalURL",{enumerable:!0,get:function(){return l}});let a=e.r(41519),s=e.r(32323);function l(e){if(!(0,a.isAbsoluteUrl)(e))return!0;try{let r=(0,a.getLocationOrigin)(),t=new URL(e,r);return t.origin===r&&(0,s.hasBasePath)(t.pathname)}catch(e){return!1}}},60239,(e,r,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"errorOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},44176,(e,r,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={default:function(){return g},useLinkStatus:function(){return y}};for(var s in a)Object.defineProperty(t,s,{enumerable:!0,get:a[s]});let l=e.r(5691),n=e.r(9964),i=l._(e.r(87312)),o=e.r(58393),c=e.r(9175),d=e.r(17055),u=e.r(41519),h=e.r(66534);e.r(32600);let x=e.r(69234),m=e.r(63090),f=e.r(46573);function p(e){return"string"==typeof e?e:(0,o.formatUrl)(e)}function g(r){var t;let a,s,l,[o,g]=(0,i.useOptimistic)(x.IDLE_LINK_STATUS),y=(0,i.useRef)(null),{href:v,as:j,children:w,prefetch:N=null,passHref:E,replace:S,shallow:k,scroll:_,onClick:C,onMouseEnter:$,onTouchStart:M,legacyBehavior:R=!1,onNavigate:O,ref:I,unstable_dynamicOnHover:P,...F}=r;a=w,R&&("string"==typeof a||"number"==typeof a)&&(a=(0,n.jsx)("a",{children:a}));let A=i.default.useContext(c.AppRouterContext),D=!1!==N,T=!1!==N?null===(t=N)||"auto"===t?f.FetchStrategy.PPR:f.FetchStrategy.Full:f.FetchStrategy.PPR,{href:q,as:L}=i.default.useMemo(()=>{let e=p(v);return{href:e,as:j?p(j):e}},[v,j]);if(R){if(a?.$$typeof===Symbol.for("react.lazy"))throw Object.defineProperty(Error("`<Link legacyBehavior>` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's `<a>` tag."),"__NEXT_ERROR_CODE",{value:"E863",enumerable:!1,configurable:!0});s=i.default.Children.only(a)}let z=R?s&&"object"==typeof s&&s.ref:I,B=i.default.useCallback(e=>(null!==A&&(y.current=(0,x.mountLinkInstance)(e,q,A,T,D,g)),()=>{y.current&&((0,x.unmountLinkForCurrentNavigation)(y.current),y.current=null),(0,x.unmountPrefetchableInstance)(e)}),[D,q,A,T,g]),U={ref:(0,d.useMergedRef)(B,z),onClick(r){R||"function"!=typeof C||C(r),R&&s.props&&"function"==typeof s.props.onClick&&s.props.onClick(r),!A||r.defaultPrevented||function(r,t,a,s,l,n,o){if("undefined"!=typeof window){let c,{nodeName:d}=r.currentTarget;if("A"===d.toUpperCase()&&((c=r.currentTarget.getAttribute("target"))&&"_self"!==c||r.metaKey||r.ctrlKey||r.shiftKey||r.altKey||r.nativeEvent&&2===r.nativeEvent.which)||r.currentTarget.hasAttribute("download"))return;if(!(0,m.isLocalURL)(t)){l&&(r.preventDefault(),location.replace(t));return}if(r.preventDefault(),o){let e=!1;if(o({preventDefault:()=>{e=!0}}),e)return}let{dispatchNavigateAction:u}=e.r(19506);i.default.startTransition(()=>{u(a||t,l?"replace":"push",n??!0,s.current)})}}(r,q,L,y,S,_,O)},onMouseEnter(e){R||"function"!=typeof $||$(e),R&&s.props&&"function"==typeof s.props.onMouseEnter&&s.props.onMouseEnter(e),A&&D&&(0,x.onNavigationIntent)(e.currentTarget,!0===P)},onTouchStart:function(e){R||"function"!=typeof M||M(e),R&&s.props&&"function"==typeof s.props.onTouchStart&&s.props.onTouchStart(e),A&&D&&(0,x.onNavigationIntent)(e.currentTarget,!0===P)}};return(0,u.isAbsoluteUrl)(L)?U.href=L:R&&!E&&("a"!==s.type||"href"in s.props)||(U.href=(0,h.addBasePath)(L)),l=R?i.default.cloneElement(s,U):(0,n.jsx)("a",{...F,...U,children:a}),(0,n.jsx)(b.Provider,{value:o,children:l})}e.r(60239);let b=(0,i.createContext)(x.IDLE_LINK_STATUS),y=()=>(0,i.useContext)(b);("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),r.exports=t.default)},99857,e=>{"use strict";let r=(0,e.i(71434).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);e.s(["Users",()=>r],99857)},27214,e=>{"use strict";let r=(0,e.i(71434).default)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);e.s(["Sparkles",()=>r],27214)},80694,28661,e=>{"use strict";var r=e.i(9964),t=e.i(87312),a=e.i(74786);let s=(0,e.i(71434).default)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);var l=e.i(99857);function n({mes:e,anio:n,especialidad:i}){let[o,c]=(0,t.useState)([]),[d,u]=(0,t.useState)(!0),[h,x]=(0,t.useState)(0);async function m(){try{u(!0);let{error:r}=await a.supabase.rpc("sincronizar_estadisticas_obra_social",{p_mes:e,p_anio:n,p_especialidad:i});r&&console.error("Error sincronizando estadÃ­sticas:",r);let{data:t,error:s}=await a.supabase.from("v_estadisticas_obra_social_consolidado").select("obra_social, cantidad_consultas, porcentaje_del_total, total_consultas_mes").eq("mes",e).eq("anio",n).eq("especialidad",i).order("cantidad_consultas",{ascending:!1});if(s)throw s;t&&t.length>0?(c(t),x(t[0]?.total_consultas_mes||0)):(c([]),x(0))}catch(e){console.error("Error cargando estadÃ­sticas:",e)}finally{u(!1)}}if((0,t.useEffect)(()=>{m()},[e,n,i]),d)return(0,r.jsx)("div",{className:"p-6 text-center text-gray-400",children:"Cargando estadÃ­sticas..."});if(0===o.length)return(0,r.jsx)("div",{className:"p-6 rounded-xl",style:{background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:(0,r.jsxs)("div",{className:"text-center text-gray-400",children:[(0,r.jsx)(s,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,r.jsx)("p",{children:"No hay estadÃ­sticas disponibles para este perÃ­odo"})]})});let f=Math.max(...o.map(e=>e.cantidad_consultas));return(0,r.jsxs)("div",{className:"p-6 rounded-xl space-y-4",style:{background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"p-2 bg-green-500/20 rounded-lg",children:(0,r.jsx)(s,{className:"h-5 w-5 text-green-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white",children:"EstadÃ­sticas por Obra Social"}),(0,r.jsxs)("p",{className:"text-sm text-gray-400",children:[e,"/",n," - ",i]})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-400",children:h}),(0,r.jsx)("div",{className:"text-xs text-gray-400",children:"Total consultas"})]})]}),(0,r.jsx)("div",{className:"space-y-2",children:o.map((e,t)=>{let a=e.porcentaje_del_total||0,s=e.cantidad_consultas/f*100,n=e.obra_social.includes("042")||e.obra_social.includes("PARTICULARES");return(0,r.jsxs)("div",{className:"p-3 rounded-lg",style:{background:n?"rgba(251, 191, 36, 0.1)":"rgba(255, 255, 255, 0.03)",border:n?"1px solid rgba(251, 191, 36, 0.3)":"1px solid rgba(255, 255, 255, 0.05)"},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,r.jsx)(l.Users,{className:`h-4 w-4 flex-shrink-0 ${n?"text-yellow-400":"text-gray-400"}`}),(0,r.jsx)("span",{className:`font-medium truncate ${n?"text-yellow-300":"text-gray-300"}`,children:e.obra_social})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 flex-shrink-0",children:[(0,r.jsx)("span",{className:"text-sm font-semibold text-green-400",children:e.cantidad_consultas}),(0,r.jsxs)("span",{className:"text-xs text-gray-400 w-12 text-right",children:[a.toFixed(1),"%"]})]})]}),(0,r.jsx)("div",{className:"h-2 bg-gray-800 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full transition-all duration-500",style:{width:`${s}%`,background:n?"linear-gradient(90deg, rgba(251, 191, 36, 0.8), rgba(251, 191, 36, 0.6))":"linear-gradient(90deg, rgba(34, 197, 94, 0.8), rgba(34, 197, 94, 0.6))"}})})]},t)})}),(0,r.jsx)("div",{className:"pt-4 border-t border-white/10",children:(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lg font-bold text-green-400",children:o.length}),(0,r.jsx)("div",{className:"text-xs text-gray-400",children:"Obras Sociales"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lg font-bold text-blue-400",children:o.filter(e=>e.obra_social.includes("042")||e.obra_social.includes("PARTICULARES")).length}),(0,r.jsx)("div",{className:"text-xs text-gray-400",children:"Particulares"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lg font-bold text-yellow-400",children:o[0]?.cantidad_consultas||0}),(0,r.jsx)("div",{className:"text-xs text-gray-400",children:"Mayor cantidad"})]})]})})]})}e.s(["EstadisticasObraSocial",()=>n],80694);var i=e.i(38431);async function o(e){try{let r=await e.arrayBuffer(),t=i.read(r,{type:"array"}),a=t.SheetNames[0];if(!a)throw Error("El archivo Excel no contiene hojas");let s=t.Sheets[a],l=i.utils.decode_range(s["!ref"]||"A1"),n=[];for(let e=0;e<=Math.min(l.e.c,50);e++){let r=s[i.utils.encode_cell({r:1,c:e})];n.push(r?r.v:null)}let o=function(e){if(!e||0===e.length)return null;let r=e.map(e=>String(e||"")).join(" "),t=r.match(/Desde fecha:\s*(\d{1,2}\/\d{1,2}\/\d{4})/i),a=r.match(/Hasta fecha:\s*(\d{1,2}\/\d{1,2}\/\d{4})/i);return t&&a?{desde:t[1],hasta:a[1]}:null}(n),c=[],d=Math.min(l.e.c+1,50),u=-1;for(let e=0;e<d;e++){let r=s[i.utils.encode_cell({r:9,c:e})];if(r&&null!==r.v&&void 0!==r.v){let t=String(r.v).trim();""!==t&&(u=e)}}if(-1===u)throw Error("No se encontraron headers en la fila 10");for(let e=0;e<=u;e++){let r=s[i.utils.encode_cell({r:9,c:e})];if(r&&null!==r.v&&void 0!==r.v){let t=String(r.v).trim();c.push({name:t||`Columna ${e+1}`,colIndex:e})}else c.push({name:`Columna ${e+1}`,colIndex:e})}let h=c.map(e=>e.name).filter(e=>!e.startsWith("Columna")),x=[];for(let e=10;e<=l.e.r;e++){let r={},t=!1;c.forEach(a=>{let l=s[i.utils.encode_cell({r:e,c:a.colIndex})];if(l&&null!==l.v&&void 0!==l.v){let e=l.v;if(a.name.toLowerCase().includes("duraciÃ³n")||a.name.toLowerCase().includes("duracion")){if("number"==typeof e)e=Math.round(e);else if("string"==typeof e){let r=parseFloat(e.replace(",","."));e=isNaN(r)?e:Math.round(r)}}else if("d"===l.t&&e instanceof Date){let r=e.getDate(),t=e.getMonth()+1,a=e.getFullYear();e=`${r}/${t}/${a}`}else if("n"===l.t&&"number"==typeof e&&e>1&&e<1e5)try{let r=i.SSF.parse_date_code(e);r&&(e=`${r.d}/${r.m}/${r.y}`)}catch{}a.name.startsWith("Columna")||(r[a.name]=e,t=!0)}else a.name.startsWith("Columna")||(r[a.name]=null)}),t&&x.push(r)}return{periodo:o,headers:h,rows:x}}catch(e){if(e instanceof Error)throw e;throw Error("Error al leer el archivo Excel: "+String(e))}}e.s(["readExcelFile",()=>o],28661)},19029,e=>{"use strict";let r=(0,e.i(71434).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>r],19029)},34754,e=>{"use strict";let r=(0,e.i(71434).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>r],34754)},41253,60554,e=>{"use strict";var r=e.i(9964),t=e.i(87312),a=e.i(7987),s=e.i(83643),l=e.i(71434);let n=(0,l.default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var i=e.i(68499);let o=(0,l.default)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var c=e.i(97451);function d({value:e,type:l="text",onSave:d,className:u,isEditable:h=!0,columnName:x}){let[m,f]=(0,t.useState)(!1),[p,g]=(0,t.useState)(e??""),[b,y]=(0,t.useState)(!1),v=(0,t.useRef)(null),j=(0,t.useMemo)(()=>x?.toLowerCase().trim()==="cliente",[x]),w=(0,t.useMemo)(()=>j?(0,c.obtenerSugerenciasObraSocial)(String(e)):[],[j,e]);(0,t.useEffect)(()=>{g(e??"")},[e]),(0,t.useEffect)(()=>{m&&v.current&&v.current.focus()},[m]);let N=(0,t.useCallback)(async()=>{if(p===e)return void f(!1);y(!0);try{await d(p),f(!1)}catch(e){console.error("Error saving:",e)}finally{y(!1)}},[p,e,d]),E=(0,t.useCallback)(()=>{g(e??""),f(!1)},[e]),S=(0,t.useCallback)(e=>{"Enter"===e.key?N():"Escape"===e.key&&E()},[N,E]);if(!h)return(0,r.jsx)("div",{className:(0,c.cn)("px-2 py-1",u),children:e});if(m)return(0,r.jsxs)("div",{className:"flex flex-col gap-1 animate-in fade-in zoom-in-95 duration-200",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(a.Input,{ref:v,type:l,value:p,onChange:e=>g("number"===l?Number(e.target.value):e.target.value),onKeyDown:S,disabled:b,className:"h-8 min-w-[100px] bg-gray-800 border-green-500/50 focus:border-green-400 text-white",placeholder:j?"Ingrese obra social o cÃ³digo":void 0}),(0,r.jsx)(s.Button,{size:"icon",variant:"ghost",className:"h-8 w-8 text-green-400 hover:text-green-300 hover:bg-green-500/20",onClick:N,disabled:b,children:(0,r.jsx)(n,{className:"h-4 w-4"})}),(0,r.jsx)(s.Button,{size:"icon",variant:"ghost",className:"h-8 w-8 text-red-400 hover:text-red-300 hover:bg-red-500/20",onClick:E,disabled:b,children:(0,r.jsx)(i.X,{className:"h-4 w-4"})})]}),j&&w.length>0&&(0,r.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:w.map((e,t)=>(0,r.jsx)("button",{type:"button",onClick:()=>{g(e),v.current?.focus()},className:"text-[10px] px-2 py-0.5 bg-blue-500/20 text-blue-400 border border-blue-500/30 rounded hover:bg-blue-500/30 transition-colors",children:e},t))})]});let k=(0,t.useCallback)(()=>{f(!0)},[]),_=(0,t.useMemo)(()=>null===e||""===e?(0,r.jsx)("span",{className:"text-gray-500 italic text-xs",children:"VacÃ­o"}):"number"===l&&"number"==typeof e?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(e):e,[e,l]);return(0,r.jsxs)("div",{className:(0,c.cn)("group flex items-center justify-between px-2 py-1 rounded hover:bg-white/5 cursor-pointer transition-colors min-h-[32px]",u),onClick:k,children:[(0,r.jsx)("span",{className:"truncate",children:_}),(0,r.jsx)(o,{className:"h-3 w-3 text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity"})]})}e.s(["InlineEditCell",()=>d],41253);let u=(0,l.default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>u],60554)},87914,95325,e=>{"use strict";var r=e.i(9964),t=e.i(87312),a=e.i(71434);let s=(0,a.default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),l=(0,a.default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var n=e.i(5097),i=e.i(83643),o=e.i(41253),c=e.i(60922),d=e.i(68499),u=e.i(60554);function h({isOpen:e,onClose:a,onConfirm:s,title:l,message:n,confirmText:o="Aceptar",cancelText:h="Cancelar",type:x="danger"}){let[m,f]=(0,t.useState)(!1);if((0,t.useEffect)(()=>(f(!0),()=>f(!1)),[]),!e||!m)return null;let p=()=>{switch(x){case"danger":return"text-red-400";case"warning":return"text-yellow-400";default:return"text-blue-400"}},g=(0,r.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",style:{background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",zIndex:9999,position:"fixed",top:0,left:0,right:0,bottom:0},onClick:a,children:(0,r.jsxs)("div",{className:"relative w-full max-w-md rounded-2xl p-6 shadow-2xl",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:`1px solid ${(()=>{switch(x){case"danger":return"border-red-500/50";case"warning":return"border-yellow-500/50";default:return"border-blue-500/50"}})().replace("/50","/30")}`,boxShadow:"0 8px 32px 0 rgba(34, 197, 94, 0.3)",animation:"fadeIn 0.2s ease-in-out"},onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("button",{onClick:a,className:"absolute top-4 right-4 p-2 rounded-lg hover:bg-white/10 transition-colors text-gray-400 hover:text-white",children:(0,r.jsx)(d.X,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-1",children:(0,r.jsx)(u.AlertTriangle,{className:`h-6 w-6 ${p()}`})}),(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,r.jsx)("h3",{className:`text-lg font-semibold ${p()}`,children:l}),(0,r.jsx)("p",{className:"text-gray-300 text-sm leading-relaxed",children:n})]})]}),(0,r.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,r.jsx)(i.Button,{onClick:a,variant:"outline",className:"border-gray-500/50 text-gray-300 hover:bg-gray-500/20",children:h}),(0,r.jsx)(i.Button,{onClick:()=>{s(),a()},className:(()=>{switch(x){case"danger":return"bg-red-600 hover:bg-red-500 text-white";case"warning":return"bg-yellow-600 hover:bg-yellow-500 text-white";default:return"bg-blue-600 hover:bg-blue-500 text-white"}})(),children:o})]})]})});return(0,c.createPortal)(g,document.body)}function x({title:e,count:a,description:c,icon:d,bgColor:u,borderColor:x,textColor:m,rows:f,data:p,onCellUpdate:g,onDeleteRow:b,onDeleteAll:y,allowEdit:v=!1,allowDelete:j=!1,mes:w,anio:N,sectionKey:E,esParticularRow:S,esSinHorarioRow:k,esDuplicadoRow:_,esResidenteFormativoRow:C}){let[$,M]=(0,t.useState)(!1),[R,O]=(0,t.useState)(new Set),[I,P]=(0,t.useState)(!1),[F,A]=(0,t.useState)(null);(0,t.useEffect)(()=>{w&&N&&"true"===localStorage.getItem(`expandable_${E}_${w}_${N}`)&&M(!0)},[w,N,E]);let D=e=>{let r=e.toLowerCase().trim();return r.includes("cliente")||r.includes("obra")};return 0===a?null:(0,r.jsxs)("div",{className:"w-full space-y-2",children:[(0,r.jsx)("div",{className:"p-4 rounded-xl border-2 cursor-pointer transition-all hover:opacity-90",style:{background:u,backdropFilter:"blur(20px)",borderColor:x},onClick:()=>{let e=!$;M(e),w&&N&&localStorage.setItem(`expandable_${E}_${w}_${N}`,String(e)),e||O(new Set)},children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",style:{color:m},children:[d,(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"font-bold text-lg mb-1",children:e}),(0,r.jsx)("div",{className:"text-sm",style:{color:m,opacity:.8},children:c})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[j&&$&&(0,r.jsxs)(r.Fragment,{children:[R.size>0&&(0,r.jsxs)(i.Button,{onClick:e=>{e.stopPropagation(),A({type:"multiple",count:R.size}),P(!0)},size:"sm",variant:"destructive",className:"mr-2",children:[(0,r.jsx)(n.Trash2,{className:"h-4 w-4 mr-1"}),"Eliminar seleccionados (",R.size,")"]}),y&&(0,r.jsxs)(i.Button,{onClick:e=>{e.stopPropagation(),A({type:"all",count:a}),P(!0)},size:"sm",variant:"destructive",className:"mr-2",children:[(0,r.jsx)(n.Trash2,{className:"h-4 w-4 mr-1"}),"Eliminar todos"]})]}),$?(0,r.jsx)(l,{className:"h-6 w-6",style:{color:m}}):(0,r.jsx)(s,{className:"h-6 w-6",style:{color:m}})]})]})}),$&&(0,r.jsx)("div",{className:"rounded-xl overflow-hidden",style:{background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full border-collapse text-xs",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-white/10",children:[j&&(0,r.jsx)("th",{className:"px-2 py-2 text-center text-xs font-semibold text-gray-300 bg-white/5 whitespace-nowrap sticky left-0",style:{position:"sticky",top:0,zIndex:12,minWidth:"50px",maxWidth:"50px",background:"rgba(0, 0, 0, 0.8)"},children:(0,r.jsx)("input",{type:"checkbox",checked:R.size===f.length&&f.length>0,onChange:e=>{e.target.checked?O(new Set(f.map((e,r)=>p.rows.findIndex(e=>e===f[r])).filter(e=>-1!==e))):O(new Set)},className:"w-4 h-4 rounded border-gray-500 bg-gray-800 text-green-500 focus:ring-green-500 focus:ring-2",onClick:e=>e.stopPropagation()})}),p.headers.map((e,t)=>(0,r.jsx)("th",{className:"px-2 py-2 text-left text-xs font-semibold text-gray-300 bg-white/5 whitespace-nowrap",style:{position:"sticky",top:0,zIndex:10,minWidth:"120px",maxWidth:"200px"},children:(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("span",{className:"truncate",children:e}),D(e)&&v&&(0,r.jsx)("span",{className:"text-[10px] text-green-400 bg-green-400/20 px-1.5 py-0.5 rounded flex-shrink-0",children:"Editable"})]})},t)),j&&(0,r.jsx)("th",{className:"px-2 py-2 text-left text-xs font-semibold text-gray-300 bg-white/5 whitespace-nowrap sticky right-0",style:{position:"sticky",top:0,zIndex:11,minWidth:"60px",maxWidth:"60px"},children:"Acciones"})]})}),(0,r.jsx)("tbody",{children:f.map((e,t)=>{let a=p.rows.findIndex(r=>r===e),s=R.has(a),l="detalle_completo"===E,c=!!l&&!!S&&S(a),d=!!l&&!!k&&k(a),u=!!l&&!!_&&_(a),h=!!l&&!!C&&C(a),x="transparent";return d?x="rgba(239, 68, 68, 0.15)":u?x="rgba(168, 85, 247, 0.15)":c?x="rgba(251, 191, 36, 0.15)":h&&(x="rgba(59, 130, 246, 0.15)"),s&&(x="transparent"===x?"rgba(34, 197, 94, 0.2)":x.replace("0.15","0.25")),(0,r.jsxs)("tr",{className:"border-b transition-colors border-white/5 hover:bg-white/5",style:{backgroundColor:x,borderLeft:s?"3px solid rgba(34, 197, 94, 0.8)":void 0},children:[j&&(0,r.jsx)("td",{className:"px-2 py-1.5 text-center sticky left-0 z-10",style:{minWidth:"50px",maxWidth:"50px",background:"transparent"!==x?x:"rgba(0, 0, 0, 0.5)"},onClick:e=>e.stopPropagation(),children:(0,r.jsx)("input",{type:"checkbox",checked:s,onChange:e=>{let r=new Set(R);e.target.checked?r.add(a):r.delete(a),O(r)},className:"w-4 h-4 rounded border-gray-500 bg-gray-800 text-green-500 focus:ring-green-500 focus:ring-2"})}),p.headers.map((t,s)=>{let l=e[t]??null,n=D(t)&&v;return(0,r.jsx)("td",{className:"px-2 py-1.5 text-xs text-gray-300",style:{minWidth:"120px",maxWidth:"200px"},children:n&&g?(0,r.jsx)(o.InlineEditCell,{value:l||"",onSave:async e=>{await g(a,t,e)},columnName:t}):(0,r.jsx)("span",{className:"truncate block",children:l||"-"})},s)}),j&&b&&(0,r.jsx)("td",{className:"px-2 py-1.5 text-center sticky right-0",style:{background:"transparent"!==x?x:"rgba(0, 0, 0, 0.5)"},children:(0,r.jsx)(i.Button,{onClick:async e=>{e.stopPropagation(),A({type:"single",rowIndex:a}),P(!0)},size:"sm",variant:"ghost",className:"text-red-400 hover:text-red-300 hover:bg-red-500/20",children:(0,r.jsx)(n.Trash2,{className:"h-4 w-4"})})})]},a)})})]})})}),(0,r.jsx)(h,{isOpen:I,onClose:()=>{P(!1),A(null)},onConfirm:async()=>{if(F)try{if("all"===F.type&&y)await y(),O(new Set);else if("multiple"===F.type&&b){for(let e of Array.from(R).sort((e,r)=>r-e))await b(e);O(new Set)}else if("single"===F.type&&void 0!==F.rowIndex&&b){await b(F.rowIndex);let e=new Set(R);e.delete(F.rowIndex),O(e)}}catch(e){console.error("Error eliminando filas:",e)}},title:"Confirmar eliminaciÃ³n",message:F?.type==="all"?`\xbfEst\xe1 seguro de que desea eliminar todos los ${F.count} registros? Esta acci\xf3n no se puede deshacer.`:F?.type==="multiple"?`\xbfEst\xe1 seguro de que desea eliminar los ${F.count} registros seleccionados? Esta acci\xf3n no se puede deshacer.`:"Â¿EstÃ¡ seguro de que desea eliminar esta fila? Esta acciÃ³n no se puede deshacer.",confirmText:"Eliminar",cancelText:"Cancelar",type:"danger"})]})}var m=e.i(19029),f=e.i(58427);let p=(0,a.default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Clock",()=>p],95325);let g=(0,a.default)("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),b=(0,a.default)("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);var y=e.i(97451),v=e.i(74786);function j({data:e,especialidad:a,onCellUpdate:s,onDeleteRow:l,liquidacionId:n,mes:i,anio:o}){let[c,d]=(0,t.useState)(e.rows),[u,h]=(0,t.useState)({}),[j,w]=(0,t.useState)([]),[N,E]=(0,t.useState)(!1),S=(0,t.useRef)(e.rows.length);(0,t.useEffect)(()=>{e.rows.length!==S.current&&(S.current=e.rows.length,d(e.rows))},[e.rows.length]),(0,t.useEffect)(()=>{if(!a){w([]),E(!1);return}!async function(){try{if(E(!0),!a)return;let{data:e,error:r}=await v.supabase.from("medicos").select("*").eq("especialidad",a).eq("activo",!0);if(r)throw r;w(e||[])}catch(e){console.error("Error loading mÃ©dicos:",e)}finally{E(!1)}}()},[a]);let k=(0,t.useMemo)(()=>{let e=new Map;return j.forEach(r=>{let t=r.nombre.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();e.set(t,r);let a=r.nombre.split(",").map(e=>e.trim());if(a.length>0){let t=a[0].toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();t&&!e.has(t)&&e.set(t,r)}}),e},[j]),_=(0,t.useCallback)(e=>{if(!e||"string"!=typeof e)return null;let r=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();if(k.has(r))return k.get(r)||null;for(let[e,t]of k.entries())if(r.includes(e)||e.includes(r))return t;return null},[k]),C=(0,t.useMemo)(()=>{let r=new Set,t=e.headers.findIndex(e=>{let r=e.toLowerCase().trim();return"cliente"===r||r.includes("obra social")||"obra social"===r||"obra"===r||r.includes("obra")&&r.includes("social")});if(-1===t)return console.warn("[ExcelDataTable] No se encontrÃ³ columna de Cliente/Obra Social"),r;let a=e.headers[t];return c.forEach((e,t)=>{let s=e[a];(0,y.esParticular)(s)&&r.add(t)}),console.log(`[ExcelDataTable] Filas sin obra social detectadas: ${r.size}`),r},[c,e.headers]),$=(0,t.useMemo)(()=>{let r=new Set;return c.forEach((t,a)=>{(0,y.tieneHorario)(t,e.headers)||r.add(a)}),r},[c,e.headers]),M=(0,t.useMemo)(()=>(0,y.obtenerIndicesDuplicados)(c,e.headers),[c,e.headers]),R=(0,t.useMemo)(()=>{let r=new Set;if(!a||0===j.length||N)return r;let t=e.headers.findIndex(e=>{let r=e.toLowerCase().trim();return"responsable"===r||r.includes("responsable")||r.includes("medico")}),s=e.headers.findIndex(e=>{let r=e.toLowerCase().trim();return"fecha"===r||r.includes("fecha")||r.includes("fecha visita")}),l=e.headers.findIndex(e=>{let r=e.toLowerCase().trim();return r.includes("hora")||r.includes("horario")||r.includes("inicio")});return -1===t||-1===s||-1===l||c.forEach((a,n)=>{let i=a[e.headers[t]],o=a[e.headers[s]],c=a[e.headers[l]],d=_(i);d&&d.es_residente&&(0,y.esResidenteHorarioFormativo)(o,c,d.es_residente)&&r.add(n)}),r},[c,e.headers,a,j,N,_]),O=C.size,I=$.size,P=M.size,F=R.size,A=(0,t.useCallback)(async r=>{if(l){await l(r);let t=c.filter((e,t)=>t!==r);d(t),e.rows=t}else{let t=c.filter((e,t)=>t!==r);d(t),e.rows=t}},[c,e,l]),D=(0,t.useCallback)(async r=>{if(l)for(let e of Array.from(r).sort((e,r)=>r-e))await l(e);else{let t=c.filter((e,t)=>!r.has(t));d(t),e.rows=t}},[c,e,l]),T=(0,t.useMemo)(()=>c.filter((e,r)=>C.has(r)),[c,C]),q=(0,t.useMemo)(()=>c.filter((e,r)=>$.has(r)),[c,$]),L=(0,t.useMemo)(()=>c.filter((e,r)=>M.has(r)),[c,M]),z=(0,t.useMemo)(()=>c.filter((e,r)=>R.has(r)),[c,R]),B=(0,t.useCallback)(async()=>{await D($)},[$,D]),U=(0,t.useCallback)(async()=>{await D(M)},[M,D]),H=(0,t.useCallback)(async()=>{await D(R)},[R,D]);return(0,r.jsxs)("div",{className:"w-full space-y-4",children:[e.periodo&&(0,r.jsx)("div",{className:"p-4 rounded-xl",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(34, 197, 94, 0.3)"},children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-400",children:[(0,r.jsx)(m.CheckCircle2,{className:"h-5 w-5"}),(0,r.jsx)("span",{className:"font-semibold",children:"PerÃ­odo analizado:"}),(0,r.jsxs)("span",{className:"text-white",children:[e.periodo.desde," - ",e.periodo.hasta]})]})}),(0,r.jsx)(x,{title:`âš ï¸ ${O} registro${O>1?"s":""} sin obra social detectado${O>1?"s":""}`,count:O,description:'Estos registros deben ser revisados. Si son pacientes particulares, edite la columna "Cliente" y agregue: "042 - PARTICULARES"',icon:(0,r.jsx)(f.AlertCircle,{className:"h-6 w-6 flex-shrink-0"}),bgColor:"rgba(251, 191, 36, 0.15)",borderColor:"rgba(251, 191, 36, 0.5)",textColor:"#fbbf24",rows:T,data:e,onCellUpdate:s,allowEdit:!0,mes:i,anio:o,sectionKey:"sin_obra_social"}),(0,r.jsx)(x,{title:`âš ï¸ ${I} registro${I>1?"s":""} sin horario de inicio detectado${I>1?"s":""}`,count:I,description:"Estos registros indican que el paciente no se atendiÃ³. Deben ser eliminados.",icon:(0,r.jsx)(p,{className:"h-6 w-6 flex-shrink-0"}),bgColor:"rgba(239, 68, 68, 0.15)",borderColor:"rgba(239, 68, 68, 0.5)",textColor:"#ef4444",rows:q,data:e,onDeleteRow:A,onDeleteAll:B,allowDelete:!0,mes:i,anio:o,sectionKey:"sin_horario"}),(0,r.jsx)(x,{title:`âš ï¸ ${P} registro${P>1?"s":""} duplicado${P>1?"s":""} detectado${P>1?"s":""}`,count:P,description:"Se detectaron filas completamente iguales (misma fecha, misma hora, mismo todo). Revise y elimine los duplicados si es necesario.",icon:(0,r.jsx)(f.AlertCircle,{className:"h-6 w-6 flex-shrink-0"}),bgColor:"rgba(168, 85, 247, 0.15)",borderColor:"rgba(168, 85, 247, 0.5)",textColor:"#a855f7",rows:L,data:e,onDeleteRow:A,onDeleteAll:U,allowDelete:!0,mes:i,anio:o,sectionKey:"duplicados"}),(0,r.jsx)(x,{title:`â„¹ï¸ ${F} consulta${F>1?"s":""} de residente${F>1?"s":""} en horario formativo detectada${F>1?"s":""}`,count:F,description:"Estas consultas son de residentes realizadas entre lunes a sÃ¡bado de 07:00 a 15:00. NO se deben pagar segÃºn las reglas del sistema.",icon:(0,r.jsx)(g,{className:"h-6 w-6 flex-shrink-0"}),bgColor:"rgba(59, 130, 246, 0.15)",borderColor:"rgba(59, 130, 246, 0.5)",textColor:"#3b82f6",rows:z,data:e,onDeleteRow:A,onDeleteAll:H,allowDelete:!0,mes:i,anio:o,sectionKey:"residente_formativo"}),(0,r.jsx)(x,{title:`ðŸ“Š Ver detalle completo (${c.length} registros)`,count:c.length,description:"Muestra todos los registros del Excel para revisiÃ³n completa con colores segÃºn reglas.",icon:(0,r.jsx)(b,{className:"h-6 w-6 flex-shrink-0"}),bgColor:"rgba(34, 197, 94, 0.15)",borderColor:"rgba(34, 197, 94, 0.5)",textColor:"#22c55e",rows:c,data:e,onCellUpdate:s,onDeleteRow:A,allowEdit:!0,allowDelete:!0,mes:i,anio:o,sectionKey:"detalle_completo",esParticularRow:e=>C.has(e),esSinHorarioRow:e=>$.has(e),esDuplicadoRow:e=>M.has(e),esResidenteFormativoRow:e=>R.has(e)}),(0,r.jsxs)("div",{className:"text-sm text-gray-400",children:["Total de filas: ",(0,r.jsx)("span",{className:"text-green-400 font-semibold",children:c.length})," â€¢ ","Columnas: ",(0,r.jsx)("span",{className:"text-green-400 font-semibold",children:e.headers.length}),O>0&&(0,r.jsxs)(r.Fragment,{children:[" â€¢ ","Sin obra social: ",(0,r.jsx)("span",{className:"text-yellow-400 font-semibold",children:O})]}),I>0&&(0,r.jsxs)(r.Fragment,{children:[" â€¢ ","Sin horario: ",(0,r.jsx)("span",{className:"text-red-400 font-semibold",children:I})]}),P>0&&(0,r.jsxs)(r.Fragment,{children:[" â€¢ ","Duplicados: ",(0,r.jsx)("span",{className:"text-purple-400 font-semibold",children:P})]}),F>0&&(0,r.jsxs)(r.Fragment,{children:[" â€¢ ","Residente formativo: ",(0,r.jsx)("span",{className:"text-blue-400 font-semibold",children:F})]})]})]})}e.s(["ExcelDataTable",()=>j],87914)},43227,e=>{"use strict";async function r(e,r,t){try{let{data:a,error:s}=await r.from("detalle_guardia").select("id, fecha, hora, paciente, obra_social, medico_nombre, fila_excel").eq("liquidacion_id",e).order("fila_excel",{ascending:!0,nullsFirst:!1});if(s)return console.error("Error cargando detalles:",s),null;if(!a||0===a.length)return null;return function(e,r){if(0===e.length)return{periodo:null,headers:r||[],rows:[]};let t=[...e].sort((e,r)=>(e.fila_excel||0)-(r.fila_excel||0)),a=r||["Fecha","Hora","Paciente","Obra Social","Responsable"],s=t.map(e=>{let r={};return a.forEach(t=>{let a=t.toLowerCase().trim();if(a.includes("fecha")||a.includes("date"))if(e.fecha){let a=new Date(e.fecha);if(isNaN(a.getTime()))r[t]=e.fecha;else{let e=String(a.getDate()).padStart(2,"0"),s=String(a.getMonth()+1).padStart(2,"0"),l=a.getFullYear();r[t]=`${e}/${s}/${l}`}}else r[t]=null;else a.includes("hora")||a.includes("horario")?r[t]=e.hora||null:a.includes("paciente")?r[t]=e.paciente||null:a.includes("obra")||a.includes("cliente")?r[t]=e.obra_social||null:a.includes("responsable")||a.includes("medico")?r[t]=e.medico_nombre||null:r[t]=null}),r}),l=null;if(t.length>0){let e=t.map(e=>e.fecha?new Date(e.fecha):null).filter(e=>null!==e&&!isNaN(e.getTime())).sort((e,r)=>e.getTime()-r.getTime());if(e.length>0){let r=e[0],t=e[e.length-1],a=e=>{let r=String(e.getDate()).padStart(2,"0"),t=String(e.getMonth()+1).padStart(2,"0"),a=e.getFullYear();return`${r}/${t}/${a}`};l={desde:a(r),hasta:a(t)}}}return{periodo:l,headers:a,rows:s}}(a,t)}catch(e){return console.error("Error en cargarExcelDataDesdeBD:",e),null}}e.s(["cargarExcelDataDesdeBD",()=>r])},74841,e=>{"use strict";var r=e.i(9964),t=e.i(87312),a=e.i(7735),s=e.i(8674),l=e.i(87914),n=e.i(80694),i=e.i(83643),o=e.i(68499);let c=[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiembre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}];function d({isOpen:e,onClose:a,onConfirm:s,mesDetectado:l,anioDetectado:n,mesActual:d,anioActual:u}){let[h,x]=(0,t.useState)(l||d),[m,f]=(0,t.useState)(n||u);return((0,t.useEffect)(()=>{e&&(x(l||d),f(n||u))},[e,l,n,d,u]),e)?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:a}),(0,r.jsxs)("div",{className:"relative z-10 w-full max-w-md mx-4 rounded-2xl p-6",style:{background:"rgba(17, 24, 39, 0.95)",backdropFilter:"blur(20px)",border:"1px solid rgba(34, 197, 94, 0.3)",boxShadow:"0 8px 32px 0 rgba(34, 197, 94, 0.3)"},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-green-400",children:"Seleccionar PerÃ­odo"}),(0,r.jsx)("button",{onClick:a,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors",children:(0,r.jsx)(o.X,{className:"h-5 w-5"})})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[l&&n&&(0,r.jsxs)("div",{className:"p-4 rounded-lg",style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)"},children:[(0,r.jsx)("p",{className:"text-sm text-green-400 mb-2",children:"âœ“ Mes detectado automÃ¡ticamente"}),(0,r.jsxs)("p",{className:"text-sm text-gray-300",children:[c[l-1].label," ",n]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Mes"}),(0,r.jsx)("select",{value:h,onChange:e=>x(Number(e.target.value)),className:"w-full px-4 py-2 bg-gray-800 border border-green-500/50 rounded-lg text-white focus:border-green-400 focus:outline-none",children:c.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"AÃ±o"}),(0,r.jsx)("input",{type:"number",value:m,onChange:e=>f(Number(e.target.value)),min:2020,max:2100,className:"w-full px-4 py-2 bg-gray-800 border border-green-500/50 rounded-lg text-white focus:border-green-400 focus:outline-none"})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsx)(i.Button,{onClick:a,variant:"outline",className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-700",children:"Cancelar"}),(0,r.jsx)(i.Button,{onClick:()=>{s(h,m),a()},className:"flex-1 bg-green-600 hover:bg-green-500 text-white",children:"Confirmar"})]})]})]})]}):null}var u=e.i(23229),h=e.i(28661),x=e.i(74786),m=e.i(97451);function f(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()}function p(e,r){let t=Object.keys(e);if(0===t.length)return null;for(let a of r)for(let r of t)if(r.toLowerCase().trim()===a.toLowerCase().trim()){let t=e[r];if(null!=t){if("string"==typeof t&&""!==t.trim())return t.trim();if("string"!=typeof t)return t}}let a=r.map(f);for(let r of t){let t=f(r);if(a.includes(t)){let t=e[r];if(null!=t){if("string"==typeof t&&""!==t.trim())return t.trim();if("string"!=typeof t)return t}}}for(let a of r){let r=f(a).split(/\s+/).filter(e=>e.length>2);if(0!==r.length)for(let a of t){let t=f(a);if(r.every(e=>t.includes(e))){let r=e[a];if(null!=r){if("string"==typeof r&&""!==r.trim())return r.trim();if("string"!=typeof r)return r}}}}return null}function g(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim()}async function b(e,r,t,a){let s={liquidacionId:"",totalFilas:0,procesadas:0,errores:[],advertencias:[]};try{let l,{data:n,error:i}=await x.supabase.from("medicos").select("*").eq("especialidad","GinecologÃ­a");if(i)return s.errores.push(`Error cargando m\xe9dicos: ${i.message}`),s;let o=n||[];console.log(`[Ginecolog\xeda] M\xe9dicos cargados: ${o.length}`),console.log(`[Ginecolog\xeda] Residentes: ${o.filter(e=>null===e.matricula_provincial).length}`),console.log(`[Ginecolog\xeda] No residentes: ${o.filter(e=>null!==e.matricula_provincial).length}`),console.log(`[Ginecolog\xeda] Nombres de m\xe9dicos:`,o.map(e=>`${e.nombre} (${null===e.matricula_provincial?"RESIDENTE":"NO RESIDENTE"})`).slice(0,10));let{data:c}=await x.supabase.from("valores_consultas_obra_social").select("*").eq("tipo_consulta","CONSULTA GINECOLOGICA").eq("mes",r).eq("anio",t),d=new Map;(c||[]).forEach(e=>{d.set(e.obra_social,e.valor)});let u=(0,m.calcularNumeroLiquidacion)(r,t),{data:h}=await x.supabase.from("liquidaciones_guardia").select("id").eq("especialidad","GinecologÃ­a").eq("mes",r).eq("anio",t).single();if(h&&h.id)l=h.id,await x.supabase.from("detalle_guardia").delete().eq("liquidacion_id",l);else{let{data:e,error:n}=await x.supabase.from("liquidaciones_guardia").insert({mes:r,anio:t,especialidad:"GinecologÃ­a",estado:"borrador",total_consultas:0,total_bruto:0,total_retenciones:0,total_adicionales:0,total_neto:0,archivo_nombre:a,numero_liquidacion:u}).select("id").single();if(n)return s.errores.push(`Error creando liquidaci\xf3n: ${n.message||"Error desconocido"}. Detalles: ${JSON.stringify(n)}`),console.error("Error creando liquidaciÃ³n:",n),s;if(!e||!e.id)return s.errores.push(`Error: No se pudo crear la liquidaci\xf3n. Respuesta: ${JSON.stringify(e)}`),console.error("LiquidaciÃ³n no creada:",e),s;l=e.id}s.liquidacionId=l;let f=new Set,b=new Map;for(let r of(console.log(`Extrayendo nombres \xfanicos de ${e.rows.length} filas del Excel`),e.rows)){let e=p(r,["Responsable","responsable","RESPONSABLE","MÃ©dico","medico","MEDICO","Medico","Profesional","profesional","PROFESIONAL","MÃ©dico responsable","MÃ©dico Responsable","Medico Responsable","MÃ‰DICO RESPONSABLE"]);if(e&&"string"==typeof e&&""!==e.trim()){let r=g(e.trim());""!==r&&(f.add(r),b.has(r)||b.set(r,e.trim()))}}console.log(`[Mapeo] Nombres \xfanicos encontrados en Excel: ${f.size}`),console.log(`[Mapeo] Nombres \xfanicos:`,Array.from(f).slice(0,10));let y=new Map;for(let e of f){let r=function(e,r){if(!e||"string"!=typeof e)return null;let t=g(e);if(""===t)return null;for(let e of r)if(g(e.nombre)===t)return e;let a=t.split(",").map(e=>e.trim()),s=t.split(/\s+/).filter(e=>e.length>2);for(let e of r){let r=g(e.nombre);r.split(",").map(e=>e.trim());let t=r.split(/\s+/).filter(e=>e.length>2);if(s.length>0&&t.length>0){let r=new Set(s),a=new Set(t);if(r.size===a.size&&Array.from(r).every(e=>a.has(e)))return e}}let l=a.length>1?a[0].trim():s.length>0?s[0]:t,n=null,i=0;for(let e of r){let r=g(e.nombre),t=r.split(",").map(e=>e.trim()),a=r.split(/\s+/).filter(e=>e.length>2);if(l===(t.length>1?t[0].trim():a.length>0?a[0]:r)&&l.length>2){let r=s.filter(e=>a.some(r=>r===e||r.includes(e)||e.includes(r))).length;r>i&&(i=r,n=e)}}if(n&&i>0)return n;for(let e of r){let r=g(e.nombre),t=r.split(",").map(e=>e.trim()),a=r.split(/\s+/).filter(e=>e.length>2),o=t.length>1?t[0].trim():a.length>0?a[0]:r;if(l.length>2&&o.length>2&&(l.includes(o)||o.includes(l))){let r=s.filter(e=>a.some(r=>r===e||r.includes(e)||e.includes(r))).length;r>=i&&(i=r,n=e)}}if(n)return n;if(s.length>0)for(let e of r){let r=g(e.nombre),a=r.split(/\s+/).filter(e=>e.length>2);if(s.every(e=>r.includes(e))||a.length>0&&a.every(e=>t.includes(e)))return e}if(s.length>=2){let e=null,t=0;for(let a of r){let r=g(a.nombre).split(/\s+/).filter(e=>e.length>2),l=s.filter(e=>r.some(r=>r.includes(e)||e.includes(r))).length;l>=2&&l>t&&(t=l,e=a)}if(e)return e}return null}(b.get(e)||e,o);r&&y.set(e,r)}let v=Array.from(y.keys()),j=Array.from(f).filter(e=>!y.has(e));console.log(`[Mapeo] M\xe9dicos encontrados: ${v.length}/${f.size}`),console.log(`[Mapeo] M\xe9dicos NO encontrados: ${j.length}`),v.length>0&&(console.log(`[Mapeo] M\xe9dicos encontrados:`),v.forEach(e=>{let r=y.get(e),t=b.get(e)||e;console.log(`  - "${t}" -> "${r.nombre}" (${null===r.matricula_provincial?"RESIDENTE":"NO RESIDENTE"})`)})),j.length>0&&(console.log(`[Mapeo] M\xe9dicos NO encontrados:`),j.forEach(e=>{let r=b.get(e)||e;console.log(`  - "${r}" (normalizado: "${e}")`)}),s.advertencias.push(`M\xe9dicos no encontrados en BD (${j.length}): ${j.slice(0,5).map(e=>b.get(e)||e).join(", ")}${j.length>5?"...":""}`));let w=[];if(s.totalFilas=e.rows.length,0===e.rows.length)return s.errores.push("El Excel no contiene filas de datos"),s;console.log(`Procesando ${e.rows.length} filas del Excel`),console.log("Headers disponibles:",e.headers);let N=0,E=0,S=0;for(let r=0;r<e.rows.length;r++){let t=e.rows[r];try{let e=p(t,["Fecha","fecha","FECHA","Fecha visita","Fecha Visita","Fecha de visita","Fecha de Visita","Fecha De Visita","Fecha de atenciÃ³n","Fecha AtenciÃ³n","Fecha de AtenciÃ³n","Fecha de la consulta","Fecha Consulta","Fecha de Consulta","FECHA VISITA","FECHA DE VISITA","Fecha Visita","Fecha visita"]),a=p(t,["Hora","hora","HORA","Horario","horario","HORARIO","Hora inicio","Hora Inicio","Hora de inicio","Hora de Inicio","HORA INICIO"]),n=p(t,["Paciente","paciente","PACIENTE","Nombre paciente","Nombre Paciente","Nombre del paciente","NOMBRE PACIENTE"]),i=p(t,["Obra Social","obra social","Obra social","ObraSocial","Cliente","Obra","Obra Social / Cliente","Obra Social/Cliente","OBRA SOCIAL","CLIENTE"]),o=p(t,["Responsable","responsable","RESPONSABLE","MÃ©dico","medico","MEDICO","Medico","Profesional","profesional","PROFESIONAL","MÃ©dico responsable","MÃ©dico Responsable","Medico Responsable","MÃ‰DICO RESPONSABLE"]),c=null;if(e&&!(c=function(e){if(!e)return null;let r=String(e).trim();if(""===r)return null;let t=r.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(t){let e=t[1].padStart(2,"0"),r=t[2].padStart(2,"0"),a=t[3];return`${a}-${r}-${e}`}let a=r.match(/(\d{4})-(\d{1,2})-(\d{1,2})/);if(a){let e=a[1],r=a[2].padStart(2,"0"),t=a[3].padStart(2,"0");return`${e}-${r}-${t}`}try{let e=new Date(r);if(!isNaN(e.getTime())){let r=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${r}-${t}-${a}`}}catch{}return null}(e)))if(String(e).match(/(\d{4})-(\d{1,2})-(\d{1,2})/))c=e;else try{let r=new Date(e);if(!isNaN(r.getTime())){let e=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0");c=`${e}-${t}-${a}`}}catch{}if(!c){N++,s.advertencias.push(`Fila ${r+1}: Sin fecha v\xe1lida (${e||"vacÃ­a"}), se omite`);continue}let u=parseInt(c.split("-")[0]);if(u<2020||u>2100){E++,s.advertencias.push(`Fila ${r+1}: Fecha fuera de rango (${c}), se omite`);continue}let h=null;if(o&&"string"==typeof o&&""!==o.trim()){let e=g(o.trim());h=y.get(e)||null}let x=!!h&&null===h.matricula_provincial;if(!h&&o){let e=g(o.trim());y.has(e)}let f=i||"PARTICULARES",b=d.get(f)||0;0===b&&"PARTICULARES"!==f&&s.advertencias.push(`Fila ${r+1}: No hay valor configurado para obra social: ${f}`);let v=function(e){if(!e)return null;if("string"==typeof e){let r=e.match(/(\d{1,2}):(\d{2})(?::(\d{2}))?/);if(r){let e=r[1].padStart(2,"0"),t=r[2].padStart(2,"0"),a=r[3]||"00";return`${e}:${t}:${a}`}}else if("number"==typeof e){let r=Math.round(86400*e),t=Math.floor(r/3600),a=Math.floor(r%3600/60);return`${String(t).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String(r%60).padStart(2,"0")}`}return null}(a),j=(0,m.esResidenteHorarioFormativo)(c,v,x),k=b,_=b;j&&(k=0,_=0);let C={liquidacion_id:l,medico_id:h?.id||null,fecha:c,hora:v,paciente:n||null,obra_social:f,medico_nombre:o||h?.nombre||"Desconocido",medico_matricula:h?.matricula_provincial||null,medico_es_residente:x,monto_facturado:k,porcentaje_retencion:null,monto_retencion:null,monto_adicional:0,importe_calculado:_,aplica_adicional:!1,es_horario_formativo:j,estado_revision:"pendiente",fila_excel:r+1};w.push(C),S++,s.procesadas++}catch(a){let e=a.message||"Error desconocido";s.errores.push(`Fila ${r+1}: ${e}`),console.error(`Error procesando fila ${r+1}:`,a),console.error("Datos de la fila:",t)}}if(console.log(`Resumen: ${S} procesadas, ${N} sin fecha, ${E} fecha inv\xe1lida`),(N>0||E>0)&&s.advertencias.push(`Total omitidas: ${N+E} (${N} sin fecha, ${E} fecha inv\xe1lida)`),0===w.length)return s.errores.push("No se procesÃ³ ninguna fila vÃ¡lida. Verifique que el Excel tenga fechas vÃ¡lidas."),s;console.log(`Guardando ${w.length} detalles en la base de datos`);for(let e=0;e<w.length;e+=100){let r=w.slice(e,e+100),{error:t}=await x.supabase.from("detalle_guardia").insert(r);if(t)return s.errores.push(`Error guardando detalles (lote ${Math.floor(e/100)+1}): ${t.message}. Detalles: ${JSON.stringify(t)}`),console.error("Error guardando detalles:",t),console.error("Primer detalle del lote:",r[0]),s}let k=w.length,_=w.reduce((e,r)=>e+(r.monto_facturado||0),0),C=w.reduce((e,r)=>e+(r.importe_calculado||0),0),{error:$}=await x.supabase.from("liquidaciones_guardia").update({total_consultas:k,total_bruto:_,total_neto:C,estado:"finalizada"}).eq("id",l);$&&s.errores.push(`Error actualizando totales: ${$.message}`)}catch(e){s.errores.push(`Error general: ${e.message||"Error desconocido"}`)}return s}var y=e.i(43227),v=e.i(58427),j=e.i(19029),w=e.i(27214),N=e.i(34754),E=e.i(95325),S=e.i(44176);function k(){let e=(0,a.useRouter)(),[o,c]=(0,t.useState)(!1),[m,f]=(0,t.useState)(null),[p,g]=(0,t.useState)(null),[k,_]=(0,t.useState)(!1),[C,$]=(0,t.useState)(null),[M,R]=(0,t.useState)(null),[O,I]=(0,t.useState)(new Date().getMonth()+1),[P,F]=(0,t.useState)(new Date().getFullYear()),[A,D]=(0,t.useState)(null),[T,q]=(0,t.useState)(!1),[L,z]=(0,t.useState)(null),[B,U]=(0,t.useState)(!1),[H,G]=(0,t.useState)({isOpen:!1,type:"info",message:""});function V(e,r,t){G({isOpen:!0,type:e,message:r,title:t}),setTimeout(()=>{G(e=>({...e,isOpen:!1}))},5e3)}let W=async e=>{c(!0),f(null),g(null),$(null),R(null),D(e);try{let r=await (0,h.readExcelFile)(e);f(r);let{mes:t,anio:a}=(e=>{if(e.periodo?.desde){let r=e.periodo.desde.split("/");if(3===r.length){let e=parseInt(r[1],10),t=parseInt(r[2],10);if(e>=1&&e<=12&&t>=2020)return{mes:e,anio:t}}}let r=e.headers.find(e=>e.toLowerCase().includes("fecha")||e.toLowerCase().includes("date"));if(r&&e.rows.length>0){let t=[];if(e.rows.forEach(e=>{let a=e[r];if(a&&"string"==typeof a){let e=a.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(e){let r=parseInt(e[2],10),a=parseInt(e[3],10);r>=1&&r<=12&&a>=2020&&t.push(r)}}}),t.length>0){let a=t[0];if(t.every(e=>e===a)){let t=e.rows[0][r];if("string"==typeof t){let e=t.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(e)return{mes:a,anio:parseInt(e[3],10)}}}}}return{mes:null,anio:null}})(r);t&&a&&($(t),R(a),I(t),F(a)),_(!0)}catch(e){console.error("Error processing file:",e),g(e.message||"OcurriÃ³ un error inesperado al procesar el archivo.")}finally{c(!1)}},K=async(e,r)=>{if(I(e),F(r),_(!1),m&&A){q(!0);try{let t=await b(m,e,r,A.name);if(t.errores.length>0){let e=t.errores.length>0?`Se procesaron ${t.procesadas} filas. Errores: ${t.errores.slice(0,3).join("; ")}${t.errores.length>3?"...":""}`:`Se procesaron ${t.procesadas} filas. Errores: ${t.errores.length}`;V("error",e,"Procesamiento con errores"),console.error("Errores completos:",t.errores)}else{if(t.liquidacionId){let{data:e}=await x.supabase.from("liquidaciones_guardia").select("*").eq("id",t.liquidacionId).single();e&&z(e)}t.advertencias.length>0?V("warning",`Se procesaron ${t.procesadas} de ${t.totalFilas} filas. ${t.advertencias.length} advertencias. Revisa los datos en la tabla.`,"Procesamiento completado"):V("success",`Se procesaron y guardaron ${t.procesadas} consultas. Revisa y edita los datos en la tabla.`,"Guardado exitoso")}}catch(e){console.error("Error guardando datos:",e),V("error",`Error al guardar: ${e.message||"Error desconocido"}`,"Error")}finally{q(!1)}}};(0,t.useEffect)(()=>{!async function(){try{let{data:e,error:r}=await x.supabase.from("liquidaciones_guardia").select("*").eq("especialidad","GinecologÃ­a").in("estado",["pendiente_revision","revisado","listo_para_liquidar","finalizada"]).order("created_at",{ascending:!1}).limit(1).single();if(r&&"PGRST116"!==r.code)return void console.error("Error cargando liquidaciÃ³n:",r);if(e){z(e),I(e.mes),F(e.anio);let r=await (0,y.cargarExcelDataDesdeBD)(e.id,x.supabase);r&&f(r)}}catch(e){console.error("Error cargando liquidaciÃ³n:",e)}}()},[]);let J=(0,t.useRef)(new Map),X=(0,t.useRef)(null),[Y,Q]=(0,t.useState)("idle"),Z=async(e,r,t)=>{if(!L||!m)return;let a=e+1;m.rows[e]&&(m.rows[e][r]=t,f({...m}));let s=`${L.id}-${a}-${r}`;J.current.set(s,{liquidacionId:L.id,filaExcel:a,columna:r,valor:t}),X.current&&clearTimeout(X.current),X.current=setTimeout(async()=>{await er()},500)},ee=(0,t.useCallback)(async e=>{if(L&&m)try{let{error:r}=await x.supabase.from("detalle_guardia").delete().eq("liquidacion_id",L.id).eq("fila_excel",e+1);if(r){console.error("Error eliminando fila:",r),V("error","Error al eliminar la fila","Error");return}let t=m.rows.filter((r,t)=>t!==e),a={...m,rows:t};f(a);let s=async()=>{let{data:e}=await x.supabase.from("detalle_guardia").select("importe_calculado, monto_facturado").eq("liquidacion_id",L.id);if(e){let r=e.length,t=e.reduce((e,r)=>e+(r.monto_facturado||0),0),a=e.reduce((e,r)=>e+(r.importe_calculado||0),0);await x.supabase.from("liquidaciones_guardia").update({total_consultas:r,total_bruto:t,total_neto:a}).eq("id",L.id),z(e=>e?{...e,total_consultas:r,total_bruto:t,total_neto:a}:null)}};"requestIdleCallback"in window?requestIdleCallback(s,{timeout:1e3}):setTimeout(s,100)}catch(e){console.error("Error eliminando fila:",e),V("error","Error al eliminar la fila","Error")}},[L,m]),er=async()=>{if(0===J.current.size)return;Q("saving");let e=Array.from(J.current.values());try{let r=new Map;e.forEach(e=>{r.has(e.filaExcel)||r.set(e.filaExcel,new Map);let t=r.get(e.filaExcel);e.columna.toLowerCase().includes("cliente")||e.columna.toLowerCase().includes("obra")?t.set("obra_social",e.valor):e.columna.toLowerCase().includes("responsable")||e.columna.toLowerCase().includes("medico")?t.set("medico_nombre",e.valor):e.columna.toLowerCase().includes("paciente")&&t.set("paciente",e.valor)});let t=Array.from(r.entries()).map(async([e,r])=>{let t={};r.forEach((e,r)=>{t[r]=e}),t.updated_at=new Date().toISOString();let{error:a}=await x.supabase.from("detalle_guardia").update(t).eq("liquidacion_id",L.id).eq("fila_excel",e);if(a)throw a});await Promise.all(t),J.current.clear(),Q("saved"),setTimeout(()=>{Q("idle")},2e3)}catch(e){console.error("Error guardando cambios:",e),Q("error"),setTimeout(()=>{J.current.size>0&&er()},3e3)}};return(0,t.useEffect)(()=>()=>{X.current&&clearTimeout(X.current),J.current.size>0&&er()},[]),(0,t.useEffect)(()=>{let e=e=>{J.current.size>0&&(e.preventDefault(),e.returnValue="Tienes cambios sin guardar. Â¿EstÃ¡s seguro de que quieres salir?",er())};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[]),(0,t.useEffect)(()=>{let e=setInterval(()=>{J.current.size>0&&er()},1e4);return()=>clearInterval(e)},[]),(0,r.jsxs)("div",{className:"min-h-screen relative p-8 pb-20 overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute top-20 left-20 w-96 h-96 bg-green-500/20 rounded-full blur-3xl animate-pulse"}),(0,r.jsx)("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-green-400/20 rounded-full blur-3xl animate-pulse delay-1000"}),(0,r.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8 relative z-10",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsxs)(i.Button,{onClick:()=>e.push("/"),variant:"outline",className:"border-green-500/50 text-green-400 hover:bg-green-500/20",children:[(0,r.jsx)(N.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Volver"]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,r.jsx)(S.default,{href:"/",className:"hover:opacity-80 transition-opacity",children:(0,r.jsx)("img",{src:"/logogrow.png",alt:"Grow Labs",className:"h-16 w-auto drop-shadow-2xl",style:{filter:"drop-shadow(0 0 20px rgba(34, 197, 94, 0.5))"}})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-4xl font-bold mb-2 tracking-tight",children:(0,r.jsx)("span",{className:"bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent",children:"MÃ³dulo GinecologÃ­a"})}),(0,r.jsxs)("p",{className:"text-gray-400 flex items-center gap-2",children:[(0,r.jsx)(w.Sparkles,{className:"h-4 w-4 text-blue-400"}),"Procesamiento de liquidaciones por hora"]})]})]})})]}),(0,r.jsxs)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:[(0,r.jsx)("div",{className:"absolute inset-0 rounded-2xl",style:{background:"linear-gradient(45deg, transparent, rgba(59, 130, 246, 0.3), transparent)",animation:"borderGlow 3s ease-in-out infinite"}}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-blue-400",children:"ðŸ“¤ Cargar LiquidaciÃ³n"}),(0,r.jsx)(i.Button,{onClick:()=>e.push("/ginecologia/resumenes"),variant:"outline",className:"border-blue-500/50 text-blue-400 hover:bg-blue-500/20",children:"Ver ResÃºmenes"})]}),(0,r.jsx)(s.UploadExcel,{onUpload:W,isProcessing:o}),p&&(0,r.jsxs)("div",{className:"mt-6 bg-red-500/10 border border-red-500/30 rounded-lg p-4 flex items-start gap-3 text-red-400",children:[(0,r.jsx)(v.AlertCircle,{className:"w-5 h-5 mt-0.5 shrink-0"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold",children:"Error de Procesamiento"}),(0,r.jsx)("p",{className:"text-sm opacity-90",children:p})]})]})]})]}),L&&(0,r.jsx)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-6",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:["saving"===Y&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(E.Clock,{className:"h-4 w-4 text-yellow-400 animate-spin"}),(0,r.jsx)("span",{className:"text-sm text-yellow-400",children:"Guardando..."})]}),"saved"===Y&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.CheckCircle2,{className:"h-4 w-4 text-green-400"}),(0,r.jsx)("span",{className:"text-sm text-green-400",children:"Guardado"})]}),"error"===Y&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v.AlertCircle,{className:"h-4 w-4 text-red-400"}),(0,r.jsx)("span",{className:"text-sm text-red-400",children:"Error al guardar. Reintentando..."})]}),"idle"===Y&&J.current.size>0&&(0,r.jsxs)("span",{className:"text-sm text-gray-400",children:[J.current.size," cambio(s) pendiente(s)"]})]})}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm text-gray-300",children:"Estado:"}),(0,r.jsxs)("select",{value:L.estado,onChange:async e=>{let r=e.target.value;try{let{error:e}=await x.supabase.from("liquidaciones_guardia").update({estado:r}).eq("id",L.id);if(e)throw e;z(e=>e?{...e,estado:r}:null)}catch(e){console.error("Error actualizando estado:",e),V("error","Error al actualizar el estado","Error")}},className:"px-3 py-1 bg-gray-700 border border-gray-600 rounded text-white text-sm focus:border-green-400 focus:outline-none",children:[(0,r.jsx)("option",{value:"borrador",children:"Borrador"}),(0,r.jsx)("option",{value:"procesando",children:"Procesando"}),(0,r.jsx)("option",{value:"pendiente_revision",children:"Pendiente de RevisiÃ³n"}),(0,r.jsx)("option",{value:"revisado",children:"Revisado"}),(0,r.jsx)("option",{value:"listo_para_liquidar",children:"Listo para Liquidar"}),(0,r.jsx)("option",{value:"finalizada",children:"Finalizada"})]})]}),J.current.size>0&&(0,r.jsx)(i.Button,{onClick:()=>er(),size:"sm",className:"bg-green-600 hover:bg-green-500",children:"Guardar ahora"})]})]})}),m&&(0,r.jsx)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-blue-400 mb-6",children:"ðŸ“Š Datos del Excel - RevisiÃ³n y EdiciÃ³n"}),L&&(0,r.jsx)("p",{className:"text-gray-400 mb-4 text-sm",children:"Los cambios se guardan automÃ¡ticamente. Revisa duplicados, filas sin obra social y sin horario."}),(0,r.jsx)(l.ExcelDataTable,{data:m,especialidad:"GinecologÃ­a",onCellUpdate:Z,onDeleteRow:ee,liquidacionId:L?.id,mes:O,anio:P})]})}),m&&m.periodo&&(()=>{let{mes:e,anio:t}={mes:O,anio:P};return(0,r.jsx)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:(0,r.jsx)(n.EstadisticasObraSocial,{mes:e,anio:t,especialidad:"GinecologÃ­a"})})})(),(0,r.jsxs)("div",{className:"p-6 rounded-xl",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.2)"},children:[(0,r.jsx)("h3",{className:"text-xl font-semibold text-gray-200 mb-4",children:"ðŸ“‹ Reglas Vigentes"}),(0,r.jsxs)("div",{className:"space-y-4 text-sm text-gray-300",children:[(0,r.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Pago por Hora"}),(0,r.jsx)("div",{className:"font-semibold text-white",children:"SegÃºn Tarifa"}),(0,r.jsx)("div",{className:"text-xs text-gray-400",children:"Valor hora vigente por obra social"})]}),(0,r.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"ðŸ‘¨â€âš•ï¸ Regla de Residentes en Horario Formativo"}),(0,r.jsxs)("div",{className:"text-sm mt-2 space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-red-400 font-semibold",children:"NO SE PAGA"}),(0,r.jsx)("span",{className:"text-xs text-gray-400",children:"si se cumplen todas las condiciones:"})]}),(0,r.jsxs)("ul",{className:"text-xs space-y-1 ml-2 text-gray-300",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-blue-400",children:"â€¢"}),(0,r.jsxs)("span",{children:["MÃ©dico es ",(0,r.jsx)("strong",{children:"RESIDENTE"})," (verificado en BD)"]})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-blue-400",children:"â€¢"}),(0,r.jsxs)("span",{children:["DÃ­a: ",(0,r.jsx)("strong",{children:"Lunes a SÃ¡bado"})," (no domingo)"]})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-blue-400",children:"â€¢"}),(0,r.jsxs)("span",{children:["Horario: ",(0,r.jsx)("strong",{className:"text-blue-400",children:"07:00 a 15:00"})]})]}),(0,r.jsx)("li",{className:"text-xs text-gray-400 mt-1 ml-4",children:"(Incluye 07:00, excluye 15:00)"})]})]})]}),(0,r.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"âœ… Casos que SÃ se Pagan"}),(0,r.jsxs)("ul",{className:"text-xs space-y-1 mt-2 text-gray-300",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-green-400",children:"âœ“"}),(0,r.jsx)("span",{children:"Residente fuera del horario formativo (ej: 16:00, 20:00)"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-green-400",children:"âœ“"}),(0,r.jsxs)("span",{children:["Residente en ",(0,r.jsx)("strong",{children:"Domingo"})," (cualquier hora)"]})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-green-400",children:"âœ“"}),(0,r.jsxs)("span",{children:["MÃ©dico de ",(0,r.jsx)("strong",{children:"Planta"})," (no residente) - siempre se paga"]})]})]})]}),(0,r.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"ðŸ“Š Ejemplos de Horarios"}),(0,r.jsxs)("div",{className:"text-xs space-y-1 mt-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-300",children:"07:00 (Residente, L-S)"}),(0,r.jsx)("span",{className:"text-red-400",children:"$0"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-300",children:"14:59 (Residente, L-S)"}),(0,r.jsx)("span",{className:"text-red-400",children:"$0"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-300",children:"15:00 (Residente, L-S)"}),(0,r.jsx)("span",{className:"text-green-400",children:"Se paga"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-300",children:"10:00 (Residente, Domingo)"}),(0,r.jsx)("span",{className:"text-green-400",children:"Se paga"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-300",children:"10:00 (Planta, cualquier dÃ­a)"}),(0,r.jsx)("span",{className:"text-green-400",children:"Se paga"})]})]})]})]})]})]}),(0,r.jsx)(d,{isOpen:k,onClose:()=>_(!1),onConfirm:K,mesDetectado:C,anioDetectado:M,mesActual:new Date().getMonth()+1,anioActual:new Date().getFullYear()}),(0,r.jsx)(u.NotificationModal,{isOpen:H.isOpen,onClose:()=>G(e=>({...e,isOpen:!1})),type:H.type,title:H.title,message:H.message}),T&&(0,r.jsx)("div",{className:"fixed bottom-4 right-4 p-4 rounded-lg bg-blue-500/20 border border-blue-500/50 text-blue-400",children:"Guardando datos en la base de datos..."})]})}e.s(["default",()=>k],74841)}]);