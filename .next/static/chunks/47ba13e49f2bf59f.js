(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32600,(e,r,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},41253,e=>{"use strict";var r=e.i(9964),a=e.i(87312),s=e.i(7987),t=e.i(83643),l=e.i(71434);let i=(0,l.default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var n=e.i(68499);let o=(0,l.default)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var c=e.i(97451);function d({value:e,type:l="text",onSave:d,className:u,isEditable:x=!0,columnName:m}){let[g,h]=(0,a.useState)(!1),[p,f]=(0,a.useState)(e??""),[b,v]=(0,a.useState)(!1),j=(0,a.useRef)(null),N=(0,a.useMemo)(()=>m?.toLowerCase().trim()==="cliente",[m]),y=(0,a.useMemo)(()=>N?(0,c.obtenerSugerenciasObraSocial)(String(e)):[],[N,e]);(0,a.useEffect)(()=>{f(e??"")},[e]),(0,a.useEffect)(()=>{g&&j.current&&j.current.focus()},[g]);let w=(0,a.useCallback)(async()=>{if(p===e)return void h(!1);v(!0);try{await d(p),h(!1)}catch(e){console.error("Error saving:",e)}finally{v(!1)}},[p,e,d]),E=(0,a.useCallback)(()=>{f(e??""),h(!1)},[e]),S=(0,a.useCallback)(e=>{"Enter"===e.key?w():"Escape"===e.key&&E()},[w,E]);if(!x)return(0,r.jsx)("div",{className:(0,c.cn)("px-2 py-1",u),children:e});if(g)return(0,r.jsxs)("div",{className:"flex flex-col gap-1 animate-in fade-in zoom-in-95 duration-200",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(s.Input,{ref:j,type:l,value:p,onChange:e=>f("number"===l?Number(e.target.value):e.target.value),onKeyDown:S,disabled:b,className:"h-8 min-w-[100px] bg-gray-800 border-green-500/50 focus:border-green-400 text-white",placeholder:N?"Ingrese obra social o c√≥digo":void 0}),(0,r.jsx)(t.Button,{size:"icon",variant:"ghost",className:"h-8 w-8 text-green-400 hover:text-green-300 hover:bg-green-500/20",onClick:w,disabled:b,children:(0,r.jsx)(i,{className:"h-4 w-4"})}),(0,r.jsx)(t.Button,{size:"icon",variant:"ghost",className:"h-8 w-8 text-red-400 hover:text-red-300 hover:bg-red-500/20",onClick:E,disabled:b,children:(0,r.jsx)(n.X,{className:"h-4 w-4"})})]}),N&&y.length>0&&(0,r.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:y.map((e,a)=>(0,r.jsx)("button",{type:"button",onClick:()=>{f(e),j.current?.focus()},className:"text-[10px] px-2 py-0.5 bg-blue-500/20 text-blue-400 border border-blue-500/30 rounded hover:bg-blue-500/30 transition-colors",children:e},a))})]});let $=(0,a.useCallback)(()=>{h(!0)},[]),C=(0,a.useMemo)(()=>null===e||""===e?(0,r.jsx)("span",{className:"text-gray-500 italic text-xs",children:"Vac√≠o"}):"number"===l&&"number"==typeof e?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(e):e,[e,l]);return(0,r.jsxs)("div",{className:(0,c.cn)("group flex items-center justify-between px-2 py-1 rounded hover:bg-white/5 cursor-pointer transition-colors min-h-[32px]",u),onClick:$,children:[(0,r.jsx)("span",{className:"truncate",children:C}),(0,r.jsx)(o,{className:"h-3 w-3 text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity"})]})}e.s(["InlineEditCell",()=>d],41253)},23229,e=>{"use strict";var r=e.i(9964),a=e.i(87312),s=e.i(71375),t=e.i(68499),l=e.i(58427),i=e.i(71434);let n=(0,i.default)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),o=(0,i.default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var c=e.i(83643);function d({isOpen:e,onClose:i,title:d,message:u,type:x="info",duration:m=0}){return((0,a.useEffect)(()=>{if(e&&m>0){let e=setTimeout(()=>{i()},m);return()=>clearTimeout(e)}},[e,m,i]),e)?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"},onClick:i,children:(0,r.jsxs)("div",{className:"relative w-full max-w-md rounded-2xl p-6 shadow-2xl",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:`1px solid ${(()=>{switch(x){case"success":return"border-green-500/50";case"error":return"border-red-500/50";case"warning":return"border-yellow-500/50";default:return"border-blue-500/50"}})().replace("/50","/30")}`,boxShadow:"0 8px 32px 0 rgba(34, 197, 94, 0.3)",animation:"fadeIn 0.2s ease-in-out"},onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("button",{onClick:i,className:"absolute top-4 right-4 p-2 rounded-lg hover:bg-white/10 transition-colors text-gray-400 hover:text-white",children:(0,r.jsx)(t.X,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-1",children:(()=>{switch(x){case"success":return(0,r.jsx)(s.CheckCircle,{className:"h-6 w-6 text-green-400"});case"error":return(0,r.jsx)(l.AlertCircle,{className:"h-6 w-6 text-red-400"});case"warning":return(0,r.jsx)(o,{className:"h-6 w-6 text-yellow-400"});default:return(0,r.jsx)(n,{className:"h-6 w-6 text-blue-400"})}})()}),(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[d&&(0,r.jsx)("h3",{className:`text-lg font-semibold ${(()=>{switch(x){case"success":return"text-green-400";case"error":return"text-red-400";case"warning":return"text-yellow-400";default:return"text-blue-400"}})()}`,children:d}),(0,r.jsx)("p",{className:"text-gray-300 text-sm leading-relaxed",children:u})]})]}),(0,r.jsx)("div",{className:"mt-6 flex justify-end",children:(0,r.jsx)(c.Button,{onClick:i,className:`${"success"===x?"bg-green-600 hover:bg-green-500":"error"===x?"bg-red-600 hover:bg-red-500":"warning"===x?"bg-yellow-600 hover:bg-yellow-500":"bg-blue-600 hover:bg-blue-500"} text-white`,children:"Aceptar"})})]})}):null}e.s(["NotificationModal",()=>d],23229)},74841,e=>{"use strict";var r=e.i(9964),a=e.i(87312),s=e.i(7735),t=e.i(8674),l=e.i(87914),i=e.i(80694),n=e.i(83643),o=e.i(68499);let c=[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiembre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}];function d({isOpen:e,onClose:s,onConfirm:t,mesDetectado:l,anioDetectado:i,mesActual:d,anioActual:u}){let[x,m]=(0,a.useState)(l||d),[g,h]=(0,a.useState)(i||u);return((0,a.useEffect)(()=>{e&&(m(l||d),h(i||u))},[e,l,i,d,u]),e)?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:s}),(0,r.jsxs)("div",{className:"relative z-10 w-full max-w-md mx-4 rounded-2xl p-6",style:{background:"rgba(17, 24, 39, 0.95)",backdropFilter:"blur(20px)",border:"1px solid rgba(34, 197, 94, 0.3)",boxShadow:"0 8px 32px 0 rgba(34, 197, 94, 0.3)"},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-green-400",children:"Seleccionar Per√≠odo"}),(0,r.jsx)("button",{onClick:s,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors",children:(0,r.jsx)(o.X,{className:"h-5 w-5"})})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[l&&i&&(0,r.jsxs)("div",{className:"p-4 rounded-lg",style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)"},children:[(0,r.jsx)("p",{className:"text-sm text-green-400 mb-2",children:"‚úì Mes detectado autom√°ticamente"}),(0,r.jsxs)("p",{className:"text-sm text-gray-300",children:[c[l-1].label," ",i]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Mes"}),(0,r.jsx)("select",{value:x,onChange:e=>m(Number(e.target.value)),className:"w-full px-4 py-2 bg-gray-800 border border-green-500/50 rounded-lg text-white focus:border-green-400 focus:outline-none",children:c.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"A√±o"}),(0,r.jsx)("input",{type:"number",value:g,onChange:e=>h(Number(e.target.value)),min:2020,max:2100,className:"w-full px-4 py-2 bg-gray-800 border border-green-500/50 rounded-lg text-white focus:border-green-400 focus:outline-none"})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsx)(n.Button,{onClick:s,variant:"outline",className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-700",children:"Cancelar"}),(0,r.jsx)(n.Button,{onClick:()=>{t(x,g),s()},className:"flex-1 bg-green-600 hover:bg-green-500 text-white",children:"Confirmar"})]})]})]})]}):null}var u=e.i(23229),x=e.i(28661),m=e.i(74786),g=e.i(97451);function h(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()}function p(e,r){let a=Object.keys(e);if(0===a.length)return null;for(let s of r)for(let r of a)if(r.toLowerCase().trim()===s.toLowerCase().trim()){let a=e[r];if(null!=a){if("string"==typeof a&&""!==a.trim())return a.trim();if("string"!=typeof a)return a}}let s=r.map(h);for(let r of a){let a=h(r);if(s.includes(a)){let a=e[r];if(null!=a){if("string"==typeof a&&""!==a.trim())return a.trim();if("string"!=typeof a)return a}}}for(let s of r){let r=h(s).split(/\s+/).filter(e=>e.length>2);if(0!==r.length)for(let s of a){let a=h(s);if(r.every(e=>a.includes(e))){let r=e[s];if(null!=r){if("string"==typeof r&&""!==r.trim())return r.trim();if("string"!=typeof r)return r}}}}return null}function f(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim()}async function b(e,r,a,s){let t={liquidacionId:"",totalFilas:0,procesadas:0,errores:[],advertencias:[]};try{let l,{data:i,error:n}=await m.supabase.from("medicos").select("*").eq("especialidad","Ginecolog√≠a");if(n)return t.errores.push(`Error cargando m\xe9dicos: ${n.message}`),t;let o=i||[];console.log(`[Ginecolog\xeda] M\xe9dicos cargados: ${o.length}`),console.log(`[Ginecolog\xeda] Residentes: ${o.filter(e=>null===e.matricula_provincial).length}`),console.log(`[Ginecolog\xeda] No residentes: ${o.filter(e=>null!==e.matricula_provincial).length}`),console.log(`[Ginecolog\xeda] Nombres de m\xe9dicos:`,o.map(e=>`${e.nombre} (${null===e.matricula_provincial?"RESIDENTE":"NO RESIDENTE"})`).slice(0,10));let{data:c}=await m.supabase.from("valores_consultas_obra_social").select("*").eq("tipo_consulta","CONSULTA GINECOLOGICA").eq("mes",r).eq("anio",a),d=new Map;(c||[]).forEach(e=>{d.set(e.obra_social,e.valor)});let u=(0,g.calcularNumeroLiquidacion)(r,a),{data:x}=await m.supabase.from("liquidaciones_guardia").select("id").eq("especialidad","Ginecolog√≠a").eq("mes",r).eq("anio",a).single();if(x&&x.id)l=x.id,await m.supabase.from("detalle_guardia").delete().eq("liquidacion_id",l);else{let{data:e,error:i}=await m.supabase.from("liquidaciones_guardia").insert({mes:r,anio:a,especialidad:"Ginecolog√≠a",estado:"borrador",total_consultas:0,total_bruto:0,total_retenciones:0,total_adicionales:0,total_neto:0,archivo_nombre:s,numero_liquidacion:u}).select("id").single();if(i)return t.errores.push(`Error creando liquidaci\xf3n: ${i.message||"Error desconocido"}. Detalles: ${JSON.stringify(i)}`),console.error("Error creando liquidaci√≥n:",i),t;if(!e||!e.id)return t.errores.push(`Error: No se pudo crear la liquidaci\xf3n. Respuesta: ${JSON.stringify(e)}`),console.error("Liquidaci√≥n no creada:",e),t;l=e.id}t.liquidacionId=l;let h=new Set,b=new Map;for(let r of(console.log(`Extrayendo nombres \xfanicos de ${e.rows.length} filas del Excel`),e.rows)){let e=p(r,["Responsable","responsable","RESPONSABLE","M√©dico","medico","MEDICO","Medico","Profesional","profesional","PROFESIONAL","M√©dico responsable","M√©dico Responsable","Medico Responsable","M√âDICO RESPONSABLE"]);if(e&&"string"==typeof e&&""!==e.trim()){let r=f(e.trim());""!==r&&(h.add(r),b.has(r)||b.set(r,e.trim()))}}console.log(`[Mapeo] Nombres \xfanicos encontrados en Excel: ${h.size}`),console.log(`[Mapeo] Nombres \xfanicos:`,Array.from(h).slice(0,10));let v=new Map;for(let e of h){let r=function(e,r){if(!e||"string"!=typeof e)return null;let a=f(e);if(""===a)return null;for(let e of r)if(f(e.nombre)===a)return e;let s=a.split(",").map(e=>e.trim()),t=a.split(/\s+/).filter(e=>e.length>2);for(let e of r){let r=f(e.nombre);r.split(",").map(e=>e.trim());let a=r.split(/\s+/).filter(e=>e.length>2);if(t.length>0&&a.length>0){let r=new Set(t),s=new Set(a);if(r.size===s.size&&Array.from(r).every(e=>s.has(e)))return e}}let l=s.length>1?s[0].trim():t.length>0?t[0]:a,i=null,n=0;for(let e of r){let r=f(e.nombre),a=r.split(",").map(e=>e.trim()),s=r.split(/\s+/).filter(e=>e.length>2);if(l===(a.length>1?a[0].trim():s.length>0?s[0]:r)&&l.length>2){let r=t.filter(e=>s.some(r=>r===e||r.includes(e)||e.includes(r))).length;r>n&&(n=r,i=e)}}if(i&&n>0)return i;for(let e of r){let r=f(e.nombre),a=r.split(",").map(e=>e.trim()),s=r.split(/\s+/).filter(e=>e.length>2),o=a.length>1?a[0].trim():s.length>0?s[0]:r;if(l.length>2&&o.length>2&&(l.includes(o)||o.includes(l))){let r=t.filter(e=>s.some(r=>r===e||r.includes(e)||e.includes(r))).length;r>=n&&(n=r,i=e)}}if(i)return i;if(t.length>0)for(let e of r){let r=f(e.nombre),s=r.split(/\s+/).filter(e=>e.length>2);if(t.every(e=>r.includes(e))||s.length>0&&s.every(e=>a.includes(e)))return e}if(t.length>=2){let e=null,a=0;for(let s of r){let r=f(s.nombre).split(/\s+/).filter(e=>e.length>2),l=t.filter(e=>r.some(r=>r.includes(e)||e.includes(r))).length;l>=2&&l>a&&(a=l,e=s)}if(e)return e}return null}(b.get(e)||e,o);r&&v.set(e,r)}let j=Array.from(v.keys()),N=Array.from(h).filter(e=>!v.has(e));console.log(`[Mapeo] M\xe9dicos encontrados: ${j.length}/${h.size}`),console.log(`[Mapeo] M\xe9dicos NO encontrados: ${N.length}`),j.length>0&&(console.log(`[Mapeo] M\xe9dicos encontrados:`),j.forEach(e=>{let r=v.get(e),a=b.get(e)||e;console.log(`  - "${a}" -> "${r.nombre}" (${null===r.matricula_provincial?"RESIDENTE":"NO RESIDENTE"})`)})),N.length>0&&(console.log(`[Mapeo] M\xe9dicos NO encontrados:`),N.forEach(e=>{let r=b.get(e)||e;console.log(`  - "${r}" (normalizado: "${e}")`)}),t.advertencias.push(`M\xe9dicos no encontrados en BD (${N.length}): ${N.slice(0,5).map(e=>b.get(e)||e).join(", ")}${N.length>5?"...":""}`));let y=[];if(t.totalFilas=e.rows.length,0===e.rows.length)return t.errores.push("El Excel no contiene filas de datos"),t;console.log(`Procesando ${e.rows.length} filas del Excel`),console.log("Headers disponibles:",e.headers);let w=0,E=0,S=0;for(let r=0;r<e.rows.length;r++){let a=e.rows[r];try{let e=p(a,["Fecha","fecha","FECHA","Fecha visita","Fecha Visita","Fecha de visita","Fecha de Visita","Fecha De Visita","Fecha de atenci√≥n","Fecha Atenci√≥n","Fecha de Atenci√≥n","Fecha de la consulta","Fecha Consulta","Fecha de Consulta","FECHA VISITA","FECHA DE VISITA","Fecha Visita","Fecha visita"]),s=p(a,["Hora","hora","HORA","Horario","horario","HORARIO","Hora inicio","Hora Inicio","Hora de inicio","Hora de Inicio","HORA INICIO"]),i=p(a,["Paciente","paciente","PACIENTE","Nombre paciente","Nombre Paciente","Nombre del paciente","NOMBRE PACIENTE"]),n=p(a,["Obra Social","obra social","Obra social","ObraSocial","Cliente","Obra","Obra Social / Cliente","Obra Social/Cliente","OBRA SOCIAL","CLIENTE"]),o=p(a,["Responsable","responsable","RESPONSABLE","M√©dico","medico","MEDICO","Medico","Profesional","profesional","PROFESIONAL","M√©dico responsable","M√©dico Responsable","Medico Responsable","M√âDICO RESPONSABLE"]),c=null;if(e&&!(c=function(e){if(!e)return null;let r=String(e).trim();if(""===r)return null;let a=r.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(a){let e=a[1].padStart(2,"0"),r=a[2].padStart(2,"0"),s=a[3];return`${s}-${r}-${e}`}let s=r.match(/(\d{4})-(\d{1,2})-(\d{1,2})/);if(s){let e=s[1],r=s[2].padStart(2,"0"),a=s[3].padStart(2,"0");return`${e}-${r}-${a}`}try{let e=new Date(r);if(!isNaN(e.getTime())){let r=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${r}-${a}-${s}`}}catch{}return null}(e)))if(String(e).match(/(\d{4})-(\d{1,2})-(\d{1,2})/))c=e;else try{let r=new Date(e);if(!isNaN(r.getTime())){let e=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),s=String(r.getDate()).padStart(2,"0");c=`${e}-${a}-${s}`}}catch{}if(!c){w++,t.advertencias.push(`Fila ${r+1}: Sin fecha v\xe1lida (${e||"vac√≠a"}), se omite`);continue}let u=parseInt(c.split("-")[0]);if(u<2020||u>2100){E++,t.advertencias.push(`Fila ${r+1}: Fecha fuera de rango (${c}), se omite`);continue}let x=null;if(o&&"string"==typeof o&&""!==o.trim()){let e=f(o.trim());x=v.get(e)||null}let m=!!x&&null===x.matricula_provincial;if(!x&&o){let e=f(o.trim());v.has(e)}let h=n||"PARTICULARES",b=d.get(h)||0;0===b&&"PARTICULARES"!==h&&t.advertencias.push(`Fila ${r+1}: No hay valor configurado para obra social: ${h}`);let j=function(e){if(!e)return null;if("string"==typeof e){let r=e.match(/(\d{1,2}):(\d{2})(?::(\d{2}))?/);if(r){let e=r[1].padStart(2,"0"),a=r[2].padStart(2,"0"),s=r[3]||"00";return`${e}:${a}:${s}`}}else if("number"==typeof e){let r=Math.round(86400*e),a=Math.floor(r/3600),s=Math.floor(r%3600/60);return`${String(a).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(r%60).padStart(2,"0")}`}return null}(s),N=(0,g.esResidenteHorarioFormativo)(c,j,m),$=b,C=b;N&&($=0,C=0);let k={liquidacion_id:l,medico_id:x?.id||null,fecha:c,hora:j,paciente:i||null,obra_social:h,medico_nombre:o||x?.nombre||"Desconocido",medico_matricula:x?.matricula_provincial||null,medico_es_residente:m,monto_facturado:$,porcentaje_retencion:null,monto_retencion:null,monto_adicional:0,importe_calculado:C,aplica_adicional:!1,es_horario_formativo:N,estado_revision:"pendiente",fila_excel:r+1};y.push(k),S++,t.procesadas++}catch(s){let e=s.message||"Error desconocido";t.errores.push(`Fila ${r+1}: ${e}`),console.error(`Error procesando fila ${r+1}:`,s),console.error("Datos de la fila:",a)}}if(console.log(`Resumen: ${S} procesadas, ${w} sin fecha, ${E} fecha inv\xe1lida`),(w>0||E>0)&&t.advertencias.push(`Total omitidas: ${w+E} (${w} sin fecha, ${E} fecha inv\xe1lida)`),0===y.length)return t.errores.push("No se proces√≥ ninguna fila v√°lida. Verifique que el Excel tenga fechas v√°lidas."),t;console.log(`Guardando ${y.length} detalles en la base de datos`);for(let e=0;e<y.length;e+=100){let r=y.slice(e,e+100),{error:a}=await m.supabase.from("detalle_guardia").insert(r);if(a)return t.errores.push(`Error guardando detalles (lote ${Math.floor(e/100)+1}): ${a.message}. Detalles: ${JSON.stringify(a)}`),console.error("Error guardando detalles:",a),console.error("Primer detalle del lote:",r[0]),t}let $=y.length,C=y.reduce((e,r)=>e+(r.monto_facturado||0),0),k=y.reduce((e,r)=>e+(r.importe_calculado||0),0),{error:_}=await m.supabase.from("liquidaciones_guardia").update({total_consultas:$,total_bruto:C,total_neto:k,estado:"finalizada"}).eq("id",l);_&&t.errores.push(`Error actualizando totales: ${_.message}`)}catch(e){t.errores.push(`Error general: ${e.message||"Error desconocido"}`)}return t}var v=e.i(58427),j=e.i(19029),N=e.i(27214),y=e.i(34754),w=e.i(95325),E=e.i(44176);function S(){let e=(0,s.useRouter)(),[o,c]=(0,a.useState)(!1),[g,h]=(0,a.useState)(null),[p,f]=(0,a.useState)(null),[S,$]=(0,a.useState)(!1),[C,k]=(0,a.useState)(null),[_,M]=(0,a.useState)(null),[R,O]=(0,a.useState)(new Date().getMonth()+1),[F,q]=(0,a.useState)(new Date().getFullYear()),[A,I]=(0,a.useState)(null),[L,D]=(0,a.useState)(!1),[P,z]=(0,a.useState)(null),[T,G]=(0,a.useState)(!1),[B,H]=(0,a.useState)({isOpen:!1,type:"info",message:""});function V(e,r,a){H({isOpen:!0,type:e,message:r,title:a}),setTimeout(()=>{H(e=>({...e,isOpen:!1}))},5e3)}let U=async e=>{c(!0),h(null),f(null),k(null),M(null),I(e);try{let r=await (0,x.readExcelFile)(e);h(r);let{mes:a,anio:s}=(e=>{if(e.periodo?.desde){let r=e.periodo.desde.split("/");if(3===r.length){let e=parseInt(r[1],10),a=parseInt(r[2],10);if(e>=1&&e<=12&&a>=2020)return{mes:e,anio:a}}}let r=e.headers.find(e=>e.toLowerCase().includes("fecha")||e.toLowerCase().includes("date"));if(r&&e.rows.length>0){let a=[];if(e.rows.forEach(e=>{let s=e[r];if(s&&"string"==typeof s){let e=s.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(e){let r=parseInt(e[2],10),s=parseInt(e[3],10);r>=1&&r<=12&&s>=2020&&a.push(r)}}}),a.length>0){let s=a[0];if(a.every(e=>e===s)){let a=e.rows[0][r];if("string"==typeof a){let e=a.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(e)return{mes:s,anio:parseInt(e[3],10)}}}}}return{mes:null,anio:null}})(r);a&&s&&(k(a),M(s),O(a),q(s)),$(!0)}catch(e){console.error("Error processing file:",e),f(e.message||"Ocurri√≥ un error inesperado al procesar el archivo.")}finally{c(!1)}},J=async(e,r)=>{if(O(e),q(r),$(!1),g&&A){D(!0);try{let a=await b(g,e,r,A.name);if(a.errores.length>0){let e=a.errores.length>0?`Se procesaron ${a.procesadas} filas. Errores: ${a.errores.slice(0,3).join("; ")}${a.errores.length>3?"...":""}`:`Se procesaron ${a.procesadas} filas. Errores: ${a.errores.length}`;V("error",e,"Procesamiento con errores"),console.error("Errores completos:",a.errores)}else{if(a.liquidacionId){let{data:e}=await m.supabase.from("liquidaciones_guardia").select("*").eq("id",a.liquidacionId).single();e&&z(e)}a.advertencias.length>0?V("warning",`Se procesaron ${a.procesadas} de ${a.totalFilas} filas. ${a.advertencias.length} advertencias. Revisa los datos en la tabla.`,"Procesamiento completado"):V("success",`Se procesaron y guardaron ${a.procesadas} consultas. Revisa y edita los datos en la tabla.`,"Guardado exitoso")}}catch(e){console.error("Error guardando datos:",e),V("error",`Error al guardar: ${e.message||"Error desconocido"}`,"Error")}finally{D(!1)}}};(0,a.useEffect)(()=>{!async function(){try{let{data:e,error:r}=await m.supabase.from("liquidaciones_guardia").select("*").eq("especialidad","Ginecolog√≠a").in("estado",["pendiente_revision","revisado","listo_para_liquidar","finalizada"]).order("created_at",{ascending:!1}).limit(1).single();if(r&&"PGRST116"!==r.code)return void console.error("Error cargando liquidaci√≥n:",r);e&&(z(e),O(e.mes),q(e.anio))}catch(e){console.error("Error cargando liquidaci√≥n:",e)}}()},[]);let Y=(0,a.useRef)(new Map),K=(0,a.useRef)(null),[X,Q]=(0,a.useState)("idle"),W=async(e,r,a)=>{if(!P||!g)return;let s=e+1,t=`${P.id}-${s}-${r}`;Y.current.set(t,{liquidacionId:P.id,filaExcel:s,columna:r,valor:a}),K.current&&clearTimeout(K.current),K.current=setTimeout(async()=>{await Z()},500)},Z=async()=>{if(0===Y.current.size)return;Q("saving");let e=Array.from(Y.current.values());try{let r=new Map;e.forEach(e=>{r.has(e.filaExcel)||r.set(e.filaExcel,new Map);let a=r.get(e.filaExcel);e.columna.toLowerCase().includes("cliente")||e.columna.toLowerCase().includes("obra")?a.set("obra_social",e.valor):e.columna.toLowerCase().includes("responsable")||e.columna.toLowerCase().includes("medico")?a.set("medico_nombre",e.valor):e.columna.toLowerCase().includes("paciente")&&a.set("paciente",e.valor)});let a=Array.from(r.entries()).map(async([e,r])=>{let a={};r.forEach((e,r)=>{a[r]=e}),a.updated_at=new Date().toISOString();let{error:s}=await m.supabase.from("detalle_guardia").update(a).eq("liquidacion_id",P.id).eq("fila_excel",e);if(s)throw s});await Promise.all(a),Y.current.clear(),Q("saved"),setTimeout(()=>{Q("idle")},2e3)}catch(e){console.error("Error guardando cambios:",e),Q("error"),setTimeout(()=>{Y.current.size>0&&Z()},3e3)}};return(0,a.useEffect)(()=>()=>{K.current&&clearTimeout(K.current),Y.current.size>0&&Z()},[]),(0,a.useEffect)(()=>{let e=e=>{Y.current.size>0&&(e.preventDefault(),e.returnValue="Tienes cambios sin guardar. ¬øEst√°s seguro de que quieres salir?",Z())};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[]),(0,a.useEffect)(()=>{let e=setInterval(()=>{Y.current.size>0&&Z()},1e4);return()=>clearInterval(e)},[]),(0,r.jsxs)("div",{className:"min-h-screen relative p-8 pb-20 overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute top-20 left-20 w-96 h-96 bg-green-500/20 rounded-full blur-3xl animate-pulse"}),(0,r.jsx)("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-green-400/20 rounded-full blur-3xl animate-pulse delay-1000"}),(0,r.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8 relative z-10",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsxs)(n.Button,{onClick:()=>e.push("/"),variant:"outline",className:"border-green-500/50 text-green-400 hover:bg-green-500/20",children:[(0,r.jsx)(y.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Volver"]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,r.jsx)(E.default,{href:"/",className:"hover:opacity-80 transition-opacity",children:(0,r.jsx)("img",{src:"/logogrow.png",alt:"Grow Labs",className:"h-16 w-auto drop-shadow-2xl",style:{filter:"drop-shadow(0 0 20px rgba(34, 197, 94, 0.5))"}})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-4xl font-bold mb-2 tracking-tight",children:(0,r.jsx)("span",{className:"bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent",children:"M√≥dulo Ginecolog√≠a"})}),(0,r.jsxs)("p",{className:"text-gray-400 flex items-center gap-2",children:[(0,r.jsx)(N.Sparkles,{className:"h-4 w-4 text-blue-400"}),"Procesamiento de liquidaciones por hora"]})]})]})})]}),(0,r.jsxs)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:[(0,r.jsx)("div",{className:"absolute inset-0 rounded-2xl",style:{background:"linear-gradient(45deg, transparent, rgba(59, 130, 246, 0.3), transparent)",animation:"borderGlow 3s ease-in-out infinite"}}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-blue-400",children:"üì§ Cargar Liquidaci√≥n"}),(0,r.jsx)(n.Button,{onClick:()=>e.push("/ginecologia/resumenes"),variant:"outline",className:"border-blue-500/50 text-blue-400 hover:bg-blue-500/20",children:"Ver Res√∫menes"})]}),(0,r.jsx)(t.UploadExcel,{onUpload:U,isProcessing:o}),p&&(0,r.jsxs)("div",{className:"mt-6 bg-red-500/10 border border-red-500/30 rounded-lg p-4 flex items-start gap-3 text-red-400",children:[(0,r.jsx)(v.AlertCircle,{className:"w-5 h-5 mt-0.5 shrink-0"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold",children:"Error de Procesamiento"}),(0,r.jsx)("p",{className:"text-sm opacity-90",children:p})]})]})]})]}),P&&(0,r.jsx)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-6",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:["saving"===X&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w.Clock,{className:"h-4 w-4 text-yellow-400 animate-spin"}),(0,r.jsx)("span",{className:"text-sm text-yellow-400",children:"Guardando..."})]}),"saved"===X&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.CheckCircle2,{className:"h-4 w-4 text-green-400"}),(0,r.jsx)("span",{className:"text-sm text-green-400",children:"Guardado"})]}),"error"===X&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v.AlertCircle,{className:"h-4 w-4 text-red-400"}),(0,r.jsx)("span",{className:"text-sm text-red-400",children:"Error al guardar. Reintentando..."})]}),"idle"===X&&Y.current.size>0&&(0,r.jsxs)("span",{className:"text-sm text-gray-400",children:[Y.current.size," cambio(s) pendiente(s)"]})]})}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm text-gray-300",children:"Estado:"}),(0,r.jsxs)("select",{value:P.estado,onChange:async e=>{let r=e.target.value;try{let{error:e}=await m.supabase.from("liquidaciones_guardia").update({estado:r}).eq("id",P.id);if(e)throw e;z(e=>e?{...e,estado:r}:null)}catch(e){console.error("Error actualizando estado:",e),V("error","Error al actualizar el estado","Error")}},className:"px-3 py-1 bg-gray-700 border border-gray-600 rounded text-white text-sm focus:border-green-400 focus:outline-none",children:[(0,r.jsx)("option",{value:"borrador",children:"Borrador"}),(0,r.jsx)("option",{value:"procesando",children:"Procesando"}),(0,r.jsx)("option",{value:"pendiente_revision",children:"Pendiente de Revisi√≥n"}),(0,r.jsx)("option",{value:"revisado",children:"Revisado"}),(0,r.jsx)("option",{value:"listo_para_liquidar",children:"Listo para Liquidar"}),(0,r.jsx)("option",{value:"finalizada",children:"Finalizada"})]})]}),Y.current.size>0&&(0,r.jsx)(n.Button,{onClick:()=>Z(),size:"sm",className:"bg-green-600 hover:bg-green-500",children:"Guardar ahora"})]})]})}),g&&(0,r.jsx)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-blue-400 mb-6",children:"üìä Datos del Excel - Revisi√≥n y Edici√≥n"}),P&&(0,r.jsx)("p",{className:"text-gray-400 mb-4 text-sm",children:"Los cambios se guardan autom√°ticamente. Revisa duplicados, filas sin obra social y sin horario."}),(0,r.jsx)(l.ExcelDataTable,{data:g,especialidad:"Ginecolog√≠a",onCellUpdate:W})]})}),g&&g.periodo&&(()=>{let{mes:e,anio:a}={mes:R,anio:F};return(0,r.jsx)("div",{className:"relative rounded-2xl shadow-2xl overflow-hidden p-8",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(59, 130, 246, 0.3)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.3)"},children:(0,r.jsx)(i.EstadisticasObraSocial,{mes:e,anio:a,especialidad:"Ginecolog√≠a"})})})(),(0,r.jsxs)("div",{className:"p-6 rounded-xl",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 8px 32px 0 rgba(59, 130, 246, 0.2)"},children:[(0,r.jsx)("h3",{className:"text-xl font-semibold text-gray-200 mb-4",children:"üìã Reglas Vigentes"}),(0,r.jsxs)("div",{className:"space-y-4 text-sm text-gray-300",children:[(0,r.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Pago por Hora"}),(0,r.jsx)("div",{className:"font-semibold text-white",children:"Seg√∫n Tarifa"}),(0,r.jsx)("div",{className:"text-xs text-gray-400",children:"Valor hora vigente por obra social"})]}),(0,r.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"üë®‚Äç‚öïÔ∏è Regla de Residentes en Horario Formativo"}),(0,r.jsxs)("div",{className:"text-sm mt-2 space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-red-400 font-semibold",children:"NO SE PAGA"}),(0,r.jsx)("span",{className:"text-xs text-gray-400",children:"si se cumplen todas las condiciones:"})]}),(0,r.jsxs)("ul",{className:"text-xs space-y-1 ml-2 text-gray-300",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-blue-400",children:"‚Ä¢"}),(0,r.jsxs)("span",{children:["M√©dico es ",(0,r.jsx)("strong",{children:"RESIDENTE"})," (verificado en BD)"]})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-blue-400",children:"‚Ä¢"}),(0,r.jsxs)("span",{children:["D√≠a: ",(0,r.jsx)("strong",{children:"Lunes a S√°bado"})," (no domingo)"]})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-blue-400",children:"‚Ä¢"}),(0,r.jsxs)("span",{children:["Horario: ",(0,r.jsx)("strong",{className:"text-blue-400",children:"07:00 a 15:00"})]})]}),(0,r.jsx)("li",{className:"text-xs text-gray-400 mt-1 ml-4",children:"(Incluye 07:00, excluye 15:00)"})]})]})]}),(0,r.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"‚úÖ Casos que S√ç se Pagan"}),(0,r.jsxs)("ul",{className:"text-xs space-y-1 mt-2 text-gray-300",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-green-400",children:"‚úì"}),(0,r.jsx)("span",{children:"Residente fuera del horario formativo (ej: 16:00, 20:00)"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-green-400",children:"‚úì"}),(0,r.jsxs)("span",{children:["Residente en ",(0,r.jsx)("strong",{children:"Domingo"})," (cualquier hora)"]})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-green-400",children:"‚úì"}),(0,r.jsxs)("span",{children:["M√©dico de ",(0,r.jsx)("strong",{children:"Planta"})," (no residente) - siempre se paga"]})]})]})]}),(0,r.jsxs)("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"üìä Ejemplos de Horarios"}),(0,r.jsxs)("div",{className:"text-xs space-y-1 mt-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-300",children:"07:00 (Residente, L-S)"}),(0,r.jsx)("span",{className:"text-red-400",children:"$0"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-300",children:"14:59 (Residente, L-S)"}),(0,r.jsx)("span",{className:"text-red-400",children:"$0"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-300",children:"15:00 (Residente, L-S)"}),(0,r.jsx)("span",{className:"text-green-400",children:"Se paga"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-300",children:"10:00 (Residente, Domingo)"}),(0,r.jsx)("span",{className:"text-green-400",children:"Se paga"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-300",children:"10:00 (Planta, cualquier d√≠a)"}),(0,r.jsx)("span",{className:"text-green-400",children:"Se paga"})]})]})]})]})]})]}),(0,r.jsx)(d,{isOpen:S,onClose:()=>$(!1),onConfirm:J,mesDetectado:C,anioDetectado:_,mesActual:new Date().getMonth()+1,anioActual:new Date().getFullYear()}),(0,r.jsx)(u.NotificationModal,{isOpen:B.isOpen,onClose:()=>H(e=>({...e,isOpen:!1})),type:B.type,title:B.title,message:B.message}),L&&(0,r.jsx)("div",{className:"fixed bottom-4 right-4 p-4 rounded-lg bg-blue-500/20 border border-blue-500/50 text-blue-400",children:"Guardando datos en la base de datos..."})]})}e.s(["default",()=>S],74841)}]);